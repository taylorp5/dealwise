"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3434],{3434:function(e,t,a){a.d(t,{Z:function(){return u}});var r=a(7437),s=a(2265),n=a(9376),l=a(9178),i=a(4226),o=a(6281),c=a(911),d=a(8976);function u(){let{initialVariant:e="free"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,n.useRouter)(),{user:a,loading:u}=(0,o.a)(),{hasFirstTime:m,hasInPerson:x,loading:g,entitlements:h}=(0,d.m)(),[p]=(0,s.useState)(e);(0,s.useEffect)(()=>{localStorage.setItem("selected_pack_id",p)},[p,e]),(0,s.useEffect)(()=>{if(!g&&!u){if("first_time"===p){if(!m){t.replace("/packs?upgrade=first_time");return}}else if("in_person"===p&&!x){t.replace("/packs?upgrade=in_person");return}}},[p,t,m,x,g,u]),(0,s.useEffect)(()=>{},[p,a,h,m,x,g,u]);let b="first_time"===p,f="in_person"===p,[y,v]=(0,s.useState)("basics"),[j,N]=(0,s.useState)(""),[w,S]=(0,s.useState)(""),[k,C]=(0,s.useState)(""),[_,I]=(0,s.useState)("used"),[A,D]=(0,s.useState)("dealer"),[T,O]=(0,s.useState)(""),[M,E]=(0,s.useState)(!1),[F,R]=(0,s.useState)(null),[P,L]=(0,s.useState)(!1),[Z,B]=(0,s.useState)(null),[V,z]=(0,s.useState)(""),[U,Y]=(0,s.useState)(""),[J,$]=(0,s.useState)(""),[W,X]=(0,s.useState)(""),[G,H]=(0,s.useState)([]),[q,K]=(0,s.useState)(""),[Q,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)(""),[er,es]=(0,s.useState)([]),[en,el]=(0,s.useState)(""),[ei,eo]=(0,s.useState)([]),[ec,ed]=(0,s.useState)(0),[eu,em]=(0,s.useState)(0),[ex,eg]=(0,s.useState)(0),[eh,ep]=(0,s.useState)(!1),[eb,ef]=(0,s.useState)(!1),[ey,ev]=(0,s.useState)(""),[ej,eN]=(0,s.useState)(""),[ew,eS]=(0,s.useState)(""),[ek,eC]=(0,s.useState)("");(0,s.useEffect)(()=>{{let e=localStorage.getItem("otd_builder_price"),t=localStorage.getItem("otd_builder_state"),a=localStorage.getItem("otd_builder_tax_rate");e&&(C(e),console.log("OTD Builder: Loaded price from localStorage:",e)),t&&(N(t),console.log("OTD Builder: Loaded state from localStorage:",t)),a&&(O(a),console.log("OTD Builder: Loaded tax rate from localStorage:",a))}},[]),(0,s.useEffect)(()=>{if(f){let e=localStorage.getItem("in_person_dealer_current_otd"),t=localStorage.getItem("in_person_target_otd"),a=localStorage.getItem("in_person_walkaway_ceiling"),r=localStorage.getItem("copilot_in_person_prepare_state");if(e&&ev(e),t&&eN(t),a&&eS(a),r)try{let e=JSON.parse(r);e.targetOTD&&!ej&&eN(e.targetOTD),e.walkAwayOTD&&!ew&&eS(e.walkAwayOTD)}catch(e){}}},[f,ej,ew]),(0,s.useEffect)(()=>{if(f){if(ey?localStorage.setItem("in_person_dealer_current_otd",ey):localStorage.removeItem("in_person_dealer_current_otd"),ej){localStorage.setItem("in_person_target_otd",ej);let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.targetOTD=ej,localStorage.setItem("copilot_in_person_prepare_state",JSON.stringify(t))}catch(e){}}else localStorage.removeItem("in_person_target_otd");if(ew){localStorage.setItem("in_person_walkaway_ceiling",ew);let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.walkAwayOTD=ew,localStorage.setItem("copilot_in_person_prepare_state",JSON.stringify(t))}catch(e){}}else localStorage.removeItem("in_person_walkaway_ceiling")}},[ey,ej,ew,f]),(0,s.useEffect)(()=>{if(b){let e=localStorage.getItem("first_time_dealer_quoted_otd");e&&eC(e)}},[b]),(0,s.useEffect)(()=>{b&&(ek?localStorage.setItem("first_time_dealer_quoted_otd",ek):localStorage.removeItem("first_time_dealer_quoted_otd"))},[ek,b]),(0,s.useEffect)(()=>{if(j&&!M){L(!0),B(null);let e=(0,c.R4)(j);e&&(O(e.toString()),R({stateBaseRate:e,combinedRate:e,confidence:"low",source:"state_estimate",provider:"fallback"})),L(!1)}},[j,M]),(0,s.useEffect)(()=>{F&&"zip_lookup"===F.source&&B(null)},[F]);let e_=async()=>{if(!j||!w){alert("Please enter both state and ZIP code");return}L(!0);try{let e=await fetch("/api/tax-lookup?state=".concat(encodeURIComponent(j),"&zip=").concat(encodeURIComponent(w)));if(!e.ok)throw Error("HTTP ".concat(e.status));let t=await e.json();if(t.success&&t.data){let e=t.data;if(void 0!==e.combinedRate)O(e.combinedRate.toString());else if(e.combinedRateRange){let t=(e.combinedRateRange.low+e.combinedRateRange.high)/2;O(t.toString())}else O(e.stateBaseRate.toString());R(e),E(!1)}else throw Error(t.error||"Tax lookup unavailable")}catch(t){console.warn("Tax lookup error:",t);let e=(0,c.R4)(j);null!==e&&(O(e.toString()),R({stateBaseRate:e,combinedRate:e,confidence:"low",source:"state_estimate",provider:"fallback"})),B("Tax lookup unavailable right now. Using state estimate. Please verify tax with dealer/DMV.")}finally{L(!1)}},eI=()=>{if(!q||!Q){alert("Please enter both fee name and amount");return}let e=parseFloat(Q);if(isNaN(e)||e<=0){alert("Please enter a valid amount");return}H([...G,{id:Date.now().toString(),name:q,amount:e,isCustom:!0}]),K(""),ee("")},eA=e=>{H(G.filter(t=>t.id!==e))},eD=e=>{if(!e.trim())return!1;if(e.split(/[\n,]/).filter(e=>e.trim()).length>=2)return!0;let t=e.match(/\$[\d,]+\.?\d*/g);return!!(t&&t.length>=2||e.length>=25&&(e.includes("$")||/\d{3,}/.test(e)))},eT=e=>{let t=e.toLowerCase();return t.includes("nitrogen")||t.includes("n2")?"nitrogen":t.includes("vin etch")||t.includes("etching")?"vinEtch":t.includes("wheel lock")?"wheelLocks":t.includes("paint protection")||t.includes("ceramic")||t.includes("coating")||t.includes("ppf")?"paintProtection":t.includes("tint")||t.includes("window tint")?"tint":t.includes("warranty")||t.includes("service contract")||t.includes("vsc")?"warranty":t.includes("gap")?"gap":t.includes("lojack")||t.includes("theft")||t.includes("security")||t.includes("tracker")?"theftSecurity":"unknown"},eO={nitrogen:{normalMax:199,highMax:399},vinEtch:{normalMax:199,highMax:399},wheelLocks:{normalMax:199,highMax:399},paintProtection:{normalMax:999,highMax:1999},tint:{normalMax:599,highMax:899},warranty:{normalMax:2e3,highMax:3e3},gap:{normalMax:900,highMax:1200},theftSecurity:{normalMax:900,highMax:1500},unknown:{normalMax:499,highMax:999}},eM=e=>({nitrogen:"Nitrogen",vinEtch:"VIN Etch",wheelLocks:"Wheel Locks",paintProtection:"Paint Protection",tint:"Window Tint",warranty:"Warranty",gap:"GAP Insurance",theftSecurity:"Theft/Security",unknown:"Other"})[e]||"Other",eE=(e,t,a)=>"normal"===e?b?"This price is within the typical range for this add-on type.":"Within typical range.":"maybe"===e?b?"This price is higher than typical. Consider asking if this add-on is optional or can be negotiated.":"Higher than typical — consider negotiating.":b?"This price is significantly above typical market rates. This add-on is likely optional and can often be removed or negotiated down.":"Significantly above typical — likely optional, negotiate removal or reduction.",eF=()=>{let e=parseFloat(k)||0,t=parseFloat(T)||0,a=parseFloat(V)||0,r=parseFloat(U)||0,s=parseFloat(J)||0,n=parseFloat(W)||0,l=G.reduce((e,t)=>e+t.amount,0),i="free"===p?parseFloat(en)||0:er.reduce((e,t)=>e+t.price,0);ed(e+e*t/100+(a+r+s)),em(e+e*t/100+(a+r+s+(n+l+i)*.5)),eg(e+e*t/100+(a+r+s+n+l)+i);let o=[];i>2e3&&o.push("High add-on costs detected. Review each item carefully."),n>500&&o.push("Unusually high dealer fees. Request itemized breakdown."),l>1e3&&o.push("Multiple custom fees detected. Verify each is necessary."),eo(o),v("results")};return u?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[!1,(0,r.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)(l.Z,{className:"p-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Smart OTD Builder"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Calculate your out-the-door price with all fees, taxes, and add-ons"}),(0,r.jsxs)("div",{className:"flex space-x-2 mb-6 border-b border-gray-200",children:[(0,r.jsx)("button",{onClick:()=>v("basics"),className:"px-4 py-2 font-medium ".concat("basics"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:b?"Step 1: Verify Your Location & Price":"Step 1: Basics"}),(0,r.jsx)("button",{onClick:()=>v("fees"),className:"px-4 py-2 font-medium ".concat("fees"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:b?"Step 2: Common Fees to Expect":"Step 2: Fees"}),(0,r.jsx)("button",{onClick:()=>v("addons"),className:"px-4 py-2 font-medium ".concat("addons"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),children:b?"Step 3: Identify Optional Add-Ons":"Step 3: Add-on Detector"}),(0,r.jsx)("button",{onClick:()=>"results"===y&&v("results"),className:"px-4 py-2 font-medium ".concat("results"===y?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"),disabled:"results"!==y,children:b?"OTD Reality Check":"Your OTD Estimate"})]}),"basics"===y&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:b?"Step 1: Verify Your Location & Price":"Step 1: Basics"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Price (Listed Price)"}),(0,r.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"25000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Registration State"}),(0,r.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"Select state"}),Object.keys(c.X6).map(e=>(0,r.jsx)("option",{value:e,children:(0,c.pt)(e)},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Registration ZIP Code (optional, for accurate tax rate)"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:w,onChange:e=>S(e.target.value),placeholder:"90210",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)(i.Z,{onClick:e_,disabled:P,children:P?"Looking up...":"Lookup Tax Rate"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tax Rate (%)",!b&&!M&&(0,r.jsx)("button",{type:"button",onClick:()=>E(!0),className:"ml-2 text-xs text-blue-600 hover:text-blue-700",children:"Override"})]}),(0,r.jsx)("input",{type:"number",value:T,onChange:e=>O(e.target.value),placeholder:"7.5",step:"0.01",disabled:P||b,readOnly:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),F&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["zip_lookup"===F.source?"Looked up: ".concat(F.combinedRate||F.stateBaseRate,"%"):"Estimated: ".concat(F.combinedRate||F.stateBaseRate,"%"),!b&&' Click "Override" to manually adjust.']}),Z&&(0,r.jsx)("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-xs text-blue-800",children:Z})}),(0,r.jsx)("div",{className:"mt-2 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,r.jsx)("strong",{children:"⚠️ Tax rates are estimates only."})," Vehicle tax rules vary by state and locality. Always verify the actual tax rate with the dealer or your state DMV before finalizing."]})})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(i.Z,{onClick:()=>v("fees"),children:"Continue to Fees"})})]})]}),"fees"===y&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:b?"Step 2: Common Fees to Expect":"Step 2: Fees"}),b&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-800 mb-4",children:[(0,r.jsx)("strong",{children:"\uD83D\uDCA1 Guardrail:"})," If the dealer hasn't provided a fee in writing, don't assume it applies. Ask for an itemized OTD worksheet."]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Documentation Fee (Doc Fee)"}),(0,r.jsx)("input",{type:"text",value:V,onChange:e=>z(e.target.value),placeholder:"500",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Title Fee"}),(0,r.jsx)("input",{type:"text",value:U,onChange:e=>Y(e.target.value),placeholder:"50",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Registration Fee"}),(0,r.jsx)("input",{type:"text",value:J,onChange:e=>$(e.target.value),placeholder:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),!b||eb?(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Dealer Fees (optional)"}),(0,r.jsx)("input",{type:"text",value:W,onChange:e=>X(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Z,{type:"button",variant:"secondary",size:"sm",onClick:()=>ef(!eb),children:eb?"Hide other dealer fees":"Add other dealer fees (optional)"}),eb&&(0,r.jsx)("input",{type:"text",value:W,onChange:e=>X(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mt-2"})]}),!b||eh?(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Custom Fees (from dealer worksheet)"}),G.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-700",children:[e.name,": $",e.amount.toLocaleString()]}),(0,r.jsx)(i.Z,{size:"sm",variant:"secondary",onClick:()=>eA(e.id),children:"Remove"})]},e.id)),(0,r.jsxs)("div",{className:"flex space-x-2 mt-2",children:[(0,r.jsx)("input",{type:"text",value:q,onChange:e=>K(e.target.value),placeholder:"Fee name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("input",{type:"text",value:Q,onChange:e=>ee(e.target.value),placeholder:"Amount",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)(i.Z,{onClick:eI,children:"Add"})]})]}):(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,r.jsx)(i.Z,{type:"button",variant:"secondary",size:"sm",onClick:()=>ep(!eh),children:eh?"Hide custom fees":"Add fees from dealer worksheet (optional)"}),eh&&(0,r.jsxs)("div",{className:"mt-2",children:[G.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-700",children:[e.name,": $",e.amount.toLocaleString()]}),(0,r.jsx)(i.Z,{size:"sm",variant:"secondary",onClick:()=>eA(e.id),children:"Remove"})]},e.id)),(0,r.jsxs)("div",{className:"flex space-x-2 mt-2",children:[(0,r.jsx)("input",{type:"text",value:q,onChange:e=>K(e.target.value),placeholder:"Fee name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("input",{type:"text",value:Q,onChange:e=>ee(e.target.value),placeholder:"Amount",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)(i.Z,{onClick:eI,children:"Add"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(i.Z,{variant:"secondary",onClick:()=>v("basics"),children:"Back"}),(0,r.jsx)(i.Z,{onClick:()=>v("addons"),children:"Continue to Add-ons"})]})]})]}),"addons"===y&&(0,r.jsx)("div",{children:"free"===p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Step 3: Add-ons (Optional)"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add-ons Total"}),(0,r.jsx)("input",{type:"number",value:en,onChange:e=>el(e.target.value),placeholder:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the total cost of add-ons from the dealer worksheet. The free version does not auto-detect individual add-ons."})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(i.Z,{variant:"secondary",onClick:()=>v("fees"),children:"Back"}),(0,r.jsx)(i.Z,{onClick:eF,children:"Calculate OTD"})]})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:b?"Step 3: Identify Optional Add-Ons":"Step 3: Add-on Detector"}),b&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-800 mb-4",children:[(0,r.jsx)("strong",{children:"\uD83D\uDCA1 Guardrail:"})," Most add-ons are optional. Paste the worksheet line items to identify what can be removed before agreeing to OTD."]}),b&&(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[(0,r.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"About these ranges"}),(0,r.jsx)("p",{className:"text-xs text-gray-700 mb-2",children:"Add-on price ranges are based on typical dealer pricing and common buyer reports. Actual pricing can vary by vehicle, coverage, and location."}),(0,r.jsx)("p",{className:"text-xs text-gray-700",children:'These labels ("Typical range," "High," "Likely inflated") are meant to help you spot potential overcharges and decide what to question or remove — not to replace reviewing the written out-the-door breakdown from the dealer.'})]}),(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Format your add-ons using a new line or commas."}),(0,r.jsx)("p",{className:"text-xs text-gray-700 mb-2",children:"Example:"}),(0,r.jsxs)("div",{className:"bg-white border border-gray-300 rounded p-2 text-xs font-mono text-gray-800 mb-2",children:["Nitrogen $299",(0,r.jsx)("br",{}),"Paint protection $899"]}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"—or—"}),(0,r.jsx)("div",{className:"bg-white border border-gray-300 rounded p-2 text-xs font-mono text-gray-800 mt-2",children:"Nitrogen $299, Paint protection $899"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paste add-ons from dealer worksheet"}),(0,r.jsx)("textarea",{value:et,onChange:e=>ea(e.target.value),placeholder:"Extended Warranty - $2,500 GAP Insurance: $500 Paint Protection $300",rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),!eD(et)&&et.trim()&&(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Add at least one full line item with a price (e.g., 'Nitrogen $299')."})]}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Z,{onClick:()=>{if(!et.trim()){es([]);return}let e=et.split(/[\n,]/).filter(e=>e.trim()),t=[];for(let a of e){let e=a.match(/[\$]?([\d,]+\.?\d*)/),r=e?parseFloat(e[1].replace(/,/g,"")):0,s=a.replace(/[\$][\d,]+\.?\d*/g,"").replace(/[:-]\s*$/,"").trim();if(s&&r>0){let e=eT(s),a=eO[e]||eO.unknown,n="normal";r>a.highMax?n="inflated":r>a.normalMax&&(n="maybe");let l=eE(n,e,p);t.push({name:s,price:r,classification:n,category:e,guidance:l})}}es(t)},disabled:!eD(et),className:"w-full",children:"Classify Add-ons"})}),er.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Detected Add-ons:"}),(0,r.jsx)("div",{className:"space-y-2",children:er.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 rounded-lg border ".concat("inflated"===e.classification?"bg-red-50 border-red-200":"maybe"===e.classification?"bg-yellow-50 border-yellow-200":"bg-gray-50 border-gray-200"),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["$",e.price.toLocaleString()]}),e.category&&(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Category: ",eM(e.category)]})]}),(0,r.jsxs)("div",{children:["inflated"===e.classification&&(0,r.jsx)("span",{className:"text-xs font-medium text-red-700 bg-red-100 px-2 py-1 rounded",children:"⚠️ Likely inflated"}),"maybe"===e.classification&&(0,r.jsx)("span",{className:"text-xs font-medium text-yellow-700 bg-yellow-100 px-2 py-1 rounded",children:"⚠️ High"}),"normal"===e.classification&&(0,r.jsx)("span",{className:"text-xs font-medium text-gray-700 bg-gray-100 px-2 py-1 rounded",children:"✓ Typical range"})]})]}),e.guidance&&(0,r.jsx)("p",{className:"text-xs mt-2 ".concat("inflated"===e.classification?"text-red-700":"maybe"===e.classification?"text-yellow-700":"text-gray-600"),children:e.guidance})]},t))})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(i.Z,{variant:"secondary",onClick:()=>v("fees"),children:"Back"}),(0,r.jsx)(i.Z,{onClick:eF,children:"Calculate OTD"})]})]})]})}),"results"===y&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:b?"OTD Reality Check":"Your OTD Estimate"}),(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"OTD Price Range"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Low Estimate"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["$",ec.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Expected"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["$",eu.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"High Estimate"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["$",ex.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),b&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dealer-Quoted OTD (optional)"}),(0,r.jsx)("input",{type:"number",value:ek,onChange:e=>eC(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Paste the OTD the dealer sent you (from email or worksheet)."})]}),ek&&parseFloat(ek)>0&&(()=>{let e=parseFloat(ek),t=null;return t=e<=ex?{icon:"✅",color:"green",title:"Within expected range",nextStep:"Confirm everything in writing before agreeing."}:e>ex&&e<=1.05*ex?{icon:"⚠️",color:"yellow",title:"Slightly high — ask for itemized breakdown",nextStep:"Request a written itemized OTD breakdown and clarify optional add-ons."}:{icon:"❌",color:"red",title:"Inflated — add-ons/fees likely",nextStep:"Request a written itemized OTD breakdown and clarify optional add-ons."},(0,r.jsxs)("div",{className:"bg-white border-2 rounded-lg p-4 ".concat("green"===t.color?"border-green-300":"yellow"===t.color?"border-yellow-300":"border-red-300"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("span",{className:"text-xl",children:t.icon}),(0,r.jsx)("h4",{className:"font-semibold ".concat("green"===t.color?"text-green-900":"yellow"===t.color?"text-yellow-900":"text-red-900"),children:t.title})]}),(0,r.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,r.jsx)("strong",{children:"Next step:"})," ",t.nextStep]})})]})})()]}),f&&(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-6 mb-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Dealer vs Target"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dealer Current OTD"}),(0,r.jsx)("input",{type:"number",value:ey,onChange:e=>ev(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Target OTD"}),(0,r.jsx)("input",{type:"number",value:ej,onChange:e=>eN(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Walk-Away Ceiling"}),(0,r.jsx)("input",{type:"number",value:ew,onChange:e=>eS(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]})]}),(0,r.jsx)("div",{className:"bg-white border border-orange-300 rounded-lg p-4 mb-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Gap to Target:"}),(0,r.jsx)("span",{className:"ml-2 font-semibold text-gray-900",children:ey&&ej?(()=>{let e=parseFloat(ey)-parseFloat(ej);return e>=0?"+$".concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})):"-$".concat(Math.abs(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))})():"—"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Gap to Ceiling:"}),(0,r.jsx)("span",{className:"ml-2 font-semibold text-gray-900",children:ey&&ew?(()=>{let e=parseFloat(ey)-parseFloat(ew);return e>=0?"+$".concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})):"-$".concat(Math.abs(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))})():"—"})]})]})}),ey&&ej&&(0,r.jsx)("div",{className:"bg-white border border-orange-300 rounded-lg p-3 mb-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-700",children:parseFloat(ey)-parseFloat(ej)>0?"You're above target. Don't agree until OTD is at or below your number.":"You're at/under target. Confirm the written OTD breakdown before signing."})}),(0,r.jsx)(i.Z,{type:"button",variant:"secondary",onClick:()=>t.push("/copilot/in-person/live"),className:"w-full",children:"Open Deal Decision Advisor"})]}),ei.length>0&&(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[(0,r.jsx)("h3",{className:"font-semibold text-yellow-900 mb-2",children:"⚠️ Warnings"}),(0,r.jsx)("ul",{className:"list-disc list-inside space-y-1 text-sm text-yellow-800",children:ei.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(i.Z,{variant:"secondary",onClick:()=>v("addons"),children:"Back"}),(0,r.jsx)(i.Z,{onClick:()=>v("basics"),children:"Start Over"})]})]})]})})]})}},4226:function(e,t,a){a.d(t,{Z:function(){return s}});var r=a(7437);function s(e){let{variant:t="primary",size:a="md",className:s="",children:n,...l}=e;return(0,r.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[a]," ").concat(s),...l,children:n})}a(2265)},9178:function(e,t,a){a.d(t,{Z:function(){return s}});var r=a(7437);function s(e){let{children:t,className:a=""}=e;return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 ".concat(a),children:t})}a(2265)},6281:function(e,t,a){a.d(t,{AuthProvider:function(){return o},a:function(){return c}});var r=a(7437),s=a(2265);let n=(0,a(9997).B)(),l=()=>{{let e="https://vabikejehdmpfcyqrgrs.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";return!!(e&&t&&e.length>10&&t.length>10&&!e.includes("placeholder"))}},i=(0,s.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!l()){console.warn("Supabase not configured. Running in unauthenticated mode."),o(null),d(!1);return}let e=!0,t=null;(async()=>{try{let{data:{session:a},error:r}=await n.auth.getSession();if(!e)return;if(r)console.error("[AuthContext] Error getting initial session:",r),o(null);else{var t;console.log("[AuthContext] Initial session:",a?"User: ".concat(a.user.email):"No session"),o(null!==(t=null==a?void 0:a.user)&&void 0!==t?t:null)}d(!1)}catch(t){if(!e)return;console.error("[AuthContext] Error initializing auth:",t),o(null),d(!1)}})();let{data:{subscription:a}}=n.auth.onAuthStateChange(async(t,a)=>{var r;e&&(console.log("[AuthContext] Auth state changed:",t,a?"User: ".concat(a.user.email):"No session"),o(null!==(r=null==a?void 0:a.user)&&void 0!==r?r:null),d(!1))});return t=a,()=>{e=!1,t&&t.unsubscribe()}},[]);let u=async()=>{l()&&await n.auth.signOut(),o(null)};return(0,r.jsx)(i.Provider,{value:{user:a,loading:c,signOut:u},children:t})}function c(){let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8976:function(e,t,a){a.d(t,{m:function(){return n}});var r=a(2265);let s=(0,a(9997).B)();function n(){let[e,t]=(0,r.useState)(!0),[a,n]=(0,r.useState)({first_time:!1,in_person:!1,bundle:!1}),l=(0,r.useCallback)(async()=>{try{t(!0);let{data:{user:e}}=await s.auth.getUser();if(!e){n({first_time:!1,in_person:!1,bundle:!1}),t(!1);return}let{data:a,error:r}=await s.from("user_entitlements").select("first_time, in_person, bundle").eq("user_id",e.id).single();r?"PGRST116"===r.code?n({first_time:!1,in_person:!1,bundle:!1}):console.error("[useEntitlements] Error fetching entitlements:",r):n({first_time:(null==a?void 0:a.first_time)||!1,in_person:(null==a?void 0:a.in_person)||!1,bundle:(null==a?void 0:a.bundle)||!1})}catch(e){console.error("[useEntitlements] Error:",e)}finally{t(!1)}},[]);(0,r.useEffect)(()=>{l();let{data:{subscription:e}}=s.auth.onAuthStateChange(()=>{l()});return()=>{e.unsubscribe()}},[l]);let i=a.first_time||a.bundle,o=a.in_person||a.bundle,c=a.bundle;return{loading:e,entitlements:a,hasFirstTime:i,hasInPerson:o,hasBundle:c,refreshEntitlements:l}}},9997:function(e,t,a){a.d(t,{B:function(){return l}});var r=a(4033);let s="https://vabikejehdmpfcyqrgrs.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!s||!n){let e=[];throw s||e.push("NEXT_PUBLIC_SUPABASE_URL"),n||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Missing required Supabase environment variables: ".concat(e.join(", "),". ")+"These must be set in Vercel environment variables and available at build time.")}if(s.includes("placeholder")||n.includes("placeholder")){let e=[];throw s.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_URL"),n.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables. "+"Found placeholder in: ".concat(e.join(" and ")))}if(s.length<10||n.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function l(){return(0,r.createBrowserClient)(s,n)}},911:function(e,t,a){a.d(t,{R4:function(){return s},X6:function(){return r},pt:function(){return n}});let r={AL:2,AK:0,AZ:5.6,AR:6.5,CA:7.25,CO:2.9,CT:6.35,DE:0,FL:6,GA:4,HI:4.17,ID:6,IL:6.25,IN:7,IA:6,KS:6.5,KY:6,LA:4.45,ME:5.5,MD:6,MA:6.25,MI:6,MN:6.875,MS:5,MO:4.225,MT:0,NE:5.5,NV:6.85,NH:0,NJ:6.625,NM:5.125,NY:4,NC:4.75,ND:5,OH:5.75,OK:4.5,OR:0,PA:6,RI:7,SC:6,SD:4.5,TN:7,TX:6.25,UT:4.85,VT:6,VA:4.3,WA:6.5,WV:6,WI:5,WY:4,DC:6};function s(e){var t;return null!==(t=r[e.toUpperCase().trim()])&&void 0!==t?t:null}function n(e){return({AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming",DC:"District of Columbia"})[e.toUpperCase()]||e}},9376:function(e,t,a){var r=a(5475);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})}}]);