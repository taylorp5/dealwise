(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[452],{3316:function(e,t,s){Promise.resolve().then(s.bind(s,1458))},1458:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7437),r=s(2265),l=s(9376),n=s(9997),i=s(9178),o=s(4226);function c(e){let{title:t="Financing & Terms Helper",className:s=""}=e;return(0,a.jsx)(i.Z,{className:"bg-blue-50/50 border border-blue-200 ".concat(s),children:(0,a.jsxs)("div",{className:"p-5 lg:p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:t}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"Understanding financing terms is crucial. Here's some educational guidance:"}),(0,a.jsxs)("ul",{className:"space-y-3 text-sm text-gray-700",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"APR (Annual Percentage Rate):"})," The annual cost of borrowing money, including interest and other fees. A lower APR means lower monthly payments and less total interest paid."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Term Length:"})," The duration of the loan (e.g., 36, 48, 60, 72 months). Longer terms mean lower monthly payments but more total interest paid over time."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Dealer Financing vs. Credit Union/Bank:"})," Dealers often offer financing, but it's wise to get pre-approved from your bank or credit union first to compare rates and leverage."]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:"Contingencies:"})," Sometimes a low APR is contingent on purchasing additional products (e.g., extended warranty, GAP insurance). Always clarify this."]})]}),(0,a.jsx)("p",{className:"mt-4 text-sm text-gray-700 font-medium",children:"Questions to ask:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700",children:[(0,a.jsx)("li",{children:'"Is this rate contingent on any dealer add-ons or products?"'}),(0,a.jsx)("li",{children:'"What is the exact APR and term length for this loan?"'}),(0,a.jsx)("li",{children:'"Can I see a breakdown of all fees included in the financing?"'})]})]})})}var d=s(8395);let u=(0,n.B)();function m(e){let{user:t,initialCarContext:s,prefilledDealId:n,onComplete:m,onCancel:x,activePackId:h,unlockedPackIds:p=[]}=e,g=(0,l.useRouter)(),[b,f]=(0,r.useState)("communication_method"),[y,v]=(0,r.useState)({carContext:s||""}),[j,N]=(0,r.useState)({}),[w,k]=(0,r.useState)(null),[C,_]=(0,r.useState)(!1),[P,S]=(0,r.useState)(null),[I,A]=(0,r.useState)(!1),[O,T]=(0,r.useState)([]),[q,Z]=(0,r.useState)(!1),[F,E]=(0,r.useState)(!1),R=h?d.l[h]:null,B=!!h&&p.includes(h),z=(0,r.useMemo)(()=>{let e=["communication_method","payment_method","experience_level","negotiation_stage","help_needed","car_context"];return B&&(null==R?void 0:R.questions)&&R.questions.length>0?["pack_questions",...e]:e},[B,R]);(0,r.useEffect)(()=>{"comparing_offers"===y.currentStage&&t&&D()},[y.currentStage,t]),(0,r.useEffect)(()=>{{let e=localStorage.getItem("competitiveOffers");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&t.length>0&&(T(t),localStorage.removeItem("competitiveOffers"))}catch(e){console.error("Error parsing competitive offers:",e)}}},[]);let D=async()=>{Z(!0);try{let{data:e}=await u.from("deals").select("id, title, created_at").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(10);if(e&&e.length>0){let t=e.map(e=>e.id),{data:s}=await u.from("analyses").select("*").in("deal_id",t).or("analysis_type.eq.offer_comparison,analysis_type.eq.listing_analyzer"),a=[];null==s||s.forEach(e=>{var t,s;(null===(t=e.ai_output)||void 0===t?void 0:t.offers)&&e.ai_output.offers.forEach(e=>{a.push({dealer:e.dealer||"Unknown Dealer",price:e.price||0,otdPrice:e.otdPrice,distance:e.distance,notes:e.notes})}),(null===(s=e.ai_output)||void 0===s?void 0:s.bestOffer)&&a.push({dealer:"Previous Best Offer",price:e.ai_output.bestOffer,notes:"From previous comparison"})}),a.length>0&&(T(a),E(!0))}}catch(e){console.error("Error fetching competitive offers:",e)}finally{Z(!1)}},M=(e,t)=>{v(s=>({...s,[e]:t}));let s=z.indexOf(b);s<z.length-1&&f(z[s+1])},U=()=>{let e=z.indexOf(b);e>0&&f(z[e-1])},G=async()=>{if(!y.carContext||!y.communicationMethod||!y.paymentMethod||!y.experienceLevel||!y.currentStage||!y.helpNeeded){S("Please complete all steps");return}_(!0),S(null);try{let{data:{session:e}}=await u.auth.getSession(),t={"Content-Type":"application/json"};(null==e?void 0:e.access_token)&&(t.Authorization="Bearer ".concat(e.access_token));let s=await fetch("/api/generate-script",{method:"POST",headers:t,body:JSON.stringify({wizardAnswers:y,carContext:y.carContext,dealId:n,competitiveOffers:O.length>0?O:void 0,packType:B?h:void 0,packAnswers:B?j:void 0})}),a=await s.json();if(!a.success)throw Error(a.error||"Failed to generate script");k(a.data),f("results"),m&&m(a.data),("financing_questions"===y.helpNeeded||"finance"===y.paymentMethod)&&A(!0)}catch(e){S(e.message||"Failed to generate script")}finally{_(!1)}},Y=z.indexOf(b),L="results"===b?100:(Y+1)/z.length*100;return(0,a.jsxs)(i.Z,{className:"p-6 lg:p-8",children:[h&&(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs font-semibold px-3 py-1 rounded-full bg-blue-100 text-blue-700",children:["Active Pack: ",(null==R?void 0:R.name)||h]}),!B&&(0,a.jsx)("span",{className:"text-xs font-semibold px-3 py-1 rounded-full bg-gray-100 text-gray-600",children:"Locked - unlock to enable pack questions & prompts"})]}),(0,a.jsx)(o.Z,{variant:"secondary",size:"sm",onClick:()=>g.push("/packs"),children:"Manage Packs"})]}),B&&(null==R?void 0:R.education)&&R.education.length>0&&(0,a.jsxs)(i.Z,{className:"mb-4 bg-blue-50 border-blue-200",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Pack Education"}),(0,a.jsx)("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-1",children:R.education.map(e=>(0,a.jsx)("li",{children:e},e))})]}),"results"!==b&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsxs)("span",{children:["Step ",Y+1," of ",z.length]}),(0,a.jsxs)("span",{children:[Math.round(L),"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(L,"%")}})})]}),P&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-700 text-sm",children:P})}),C&&"results"!==b?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Generating your personalized script..."})]}):(0,a.jsx)("div",{children:(()=>{switch(b){case"pack_questions":if(!R||!B||!R.questions||0===R.questions.length)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Pack Questions"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Pack questions unavailable."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.Z,{onClick:U,variant:"secondary",children:"Back"}),(0,a.jsx)(o.Z,{onClick:()=>f(z[z.indexOf("pack_questions")+1]||"communication_method"),children:"Continue"})]})]});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:[R.name," Questions"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Answer these to tailor your script for this pack."}),(0,a.jsx)("div",{className:"space-y-4",children:R.questions.map(e=>{var t,s,r,l;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-900",children:[e.label," ",e.required&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),e.helpText&&(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.helpText}),"select"===e.type&&e.options&&(0,a.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",value:null!==(t=j[e.id])&&void 0!==t?t:"",onChange:t=>N(s=>({...s,[e.id]:t.target.value})),children:[(0,a.jsx)("option",{value:"",children:"Select..."}),e.options.map(e=>(0,a.jsx)("option",{value:String(e.value),children:e.label},String(e.value)))]}),"number"===e.type&&(0,a.jsx)("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:e.placeholder,value:null!==(s=j[e.id])&&void 0!==s?s:"",onChange:t=>N(s=>({...s,[e.id]:t.target.value?Number(t.target.value):""}))}),"text"===e.type&&(0,a.jsx)("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:e.placeholder,value:null!==(r=j[e.id])&&void 0!==r?r:"",onChange:t=>N(s=>({...s,[e.id]:t.target.value}))}),"textarea"===e.type&&(0,a.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:4,placeholder:e.placeholder,value:null!==(l=j[e.id])&&void 0!==l?l:"",onChange:t=>N(s=>({...s,[e.id]:t.target.value}))}),"boolean"===e.type&&(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.Z,{type:"button",variant:!0===j[e.id]?"primary":"secondary",onClick:()=>N(t=>({...t,[e.id]:!0})),children:"Yes"}),(0,a.jsx)(o.Z,{type:"button",variant:!1===j[e.id]?"primary":"secondary",onClick:()=>N(t=>({...t,[e.id]:!1})),children:"No"})]})]},e.id)})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.Z,{onClick:U,variant:"secondary",children:"Back"}),(0,a.jsx)(o.Z,{onClick:()=>f(z[z.indexOf("pack_questions")+1]||"communication_method"),children:"Next"})]})]});case"communication_method":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"How are you negotiating?"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>M("communicationMethod","remote"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Remote (Email/Text)"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"I'm communicating via email or text message"})]}),(0,a.jsxs)("button",{onClick:()=>M("communicationMethod","in_person"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"In Person"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"I'm at the dealership negotiating face-to-face"})]})]})]});case"payment_method":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"How are you planning to pay?"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>M("paymentMethod","cash"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Cash"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Paying with cash"})]}),(0,a.jsxs)("button",{onClick:()=>M("paymentMethod","finance"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Financing"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Planning to finance the purchase"})]}),(0,a.jsxs)("button",{onClick:()=>M("paymentMethod","unsure"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Not Sure Yet"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Still deciding between cash and financing"})]})]})]});case"experience_level":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"What's your experience level?"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>M("experienceLevel","first_time"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"First-Time Buyer"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"This is my first time buying a car"})]}),(0,a.jsxs)("button",{onClick:()=>M("experienceLevel","experienced"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Experienced"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"I've bought cars before"})]})]})]});case"negotiation_stage":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"What stage are you at?"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>M("currentStage","just_starting"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Just Starting"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Just beginning to talk to dealers"})]}),(0,a.jsxs)("button",{onClick:()=>M("currentStage","comparing_offers"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Comparing Offers"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"I have multiple offers to compare"})]}),(0,a.jsxs)("button",{onClick:()=>M("currentStage","sitting_on_offer"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Sitting on an Offer"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"I have an offer and need to respond"})]}),(0,a.jsxs)("button",{onClick:()=>M("currentStage","ready_to_close"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Ready to Close"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Finalizing the deal"})]})]})]});case"help_needed":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"What do you need help with?"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","negotiate_price"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Negotiate Price"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Get a better price on the vehicle"})]}),(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","ask_otd"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Ask for OTD Price"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Get the out-the-door price breakdown"})]}),(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","push_back_fees"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Push Back on Fees"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Challenge unnecessary fees or add-ons"})]}),(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","trade_in_value"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Trade-In Value"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Negotiate trade-in value"})]}),(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","financing_questions"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"Financing Questions"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Ask about financing terms and options"})]}),(0,a.jsxs)("button",{onClick:()=>M("helpNeeded","general_guidance"),className:"w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:"General Guidance"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"General negotiation help"})]})]})]});case"car_context":return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Tell us about the car"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Provide details about the vehicle you're negotiating for (make, model, year, price, mileage, etc.)"}),(0,a.jsx)("textarea",{value:y.carContext||"",onChange:e=>v(t=>({...t,carContext:e.target.value})),placeholder:"e.g., 2020 Honda Civic, 45,000 miles, listed at $25,000...",className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[150px]"}),"comparing_offers"===y.currentStage&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Competitive Offers"}),(0,a.jsx)(o.Z,{size:"sm",variant:"secondary",onClick:()=>{T([...O,{dealer:"",price:0,notes:""}])},children:"+ Add Offer"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Add offers from other dealerships to leverage in your negotiation. The script will reference these to strengthen your position."}),q&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Loading your previous offers..."})]}),O.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:O.map((e,t)=>(0,a.jsxs)(i.Z,{className:"p-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Dealer Name"}),(0,a.jsx)("input",{type:"text",value:e.dealer,onChange:e=>{let s=[...O];s[t].dealer=e.target.value,T(s)},placeholder:"e.g., ABC Motors",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Price"}),(0,a.jsx)("input",{type:"number",value:e.price||"",onChange:e=>{let s=[...O];s[t].price=parseFloat(e.target.value)||0,T(s)},placeholder:"e.g., 22000",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"OTD Price (optional)"}),(0,a.jsx)("input",{type:"number",value:e.otdPrice||"",onChange:e=>{let s=[...O];s[t].otdPrice=parseFloat(e.target.value)||void 0,T(s)},placeholder:"e.g., 24500",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Distance/Notes (optional)"}),(0,a.jsx)("input",{type:"text",value:e.distance||e.notes||"",onChange:e=>{let s=[...O];s[t].distance=e.target.value,s[t].notes=e.target.value,T(s)},placeholder:"e.g., 15 miles away",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsx)(o.Z,{size:"sm",variant:"secondary",onClick:()=>{T(O.filter((e,s)=>s!==t))},className:"mt-2",children:"Remove"})]},t))}),0===O.length&&!q&&(0,a.jsx)(i.Z,{className:"p-4 bg-gray-50 border-dashed",children:(0,a.jsx)("p",{className:"text-sm text-gray-600 text-center",children:'No competitive offers added yet. Click "Add Offer" to include offers from other dealerships.'})})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.Z,{onClick:U,variant:"secondary",children:"Back"}),(0,a.jsx)(o.Z,{onClick:G,disabled:!y.carContext||C,children:C?"Generating...":"Generate Script"})]})]});case"results":if(!w)return null;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"pb-4 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Script"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Ready to use"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 lg:p-8",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:w.conversationFlow?"Your Talking Points":"Your Message"}),(0,a.jsx)("div",{className:"prose max-w-none",children:(0,a.jsx)("p",{className:"text-sm lg:text-base text-gray-700 whitespace-pre-wrap leading-relaxed",children:w.script})}),(0,a.jsx)(o.Z,{onClick:()=>{navigator.clipboard.writeText(w.script),alert("Script copied to clipboard!")},size:"sm",className:"mt-4",children:"Copy to Clipboard"})]}),w.conversationFlow&&(0,a.jsxs)("div",{className:"bg-blue-50/50 border border-blue-200 rounded-lg p-6 lg:p-8",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Conversation Flow Guide"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Use this guide to navigate the conversation. It shows what the dealer might say and how you can respond."}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"bg-white border-2 border-blue-300 rounded-lg p-4 mb-3",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-semibold text-sm",children:"You"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Your Opening"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:w.conversationFlow.userOpening})]})]})})}),(0,a.jsx)("div",{className:"space-y-6",children:w.conversationFlow.scenarios.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-semibold text-sm",children:"Dealer"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Dealer Might Say:"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:['"',e.dealerResponse,'"']})]})]})}),(0,a.jsxs)("div",{className:"ml-4 space-y-3",children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Your Response Options:"}),e.userOptions.map((e,t)=>(0,a.jsx)("div",{className:"bg-white border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"bg-blue-100 text-blue-700 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 font-semibold text-xs",children:t+1}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-900 font-medium mb-1",children:['"',e.response,'"']}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 italic",children:["When to use: ",e.whenToUse]})]}),(0,a.jsx)(o.Z,{size:"sm",variant:"secondary",onClick:()=>{navigator.clipboard.writeText(e.response),alert("Response copied to clipboard!")},children:"Copy"})]})},t))]}),e.notes&&(0,a.jsxs)("div",{className:"ml-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-yellow-900 mb-1",children:"⚠️ Watch For:"}),(0,a.jsx)("p",{className:"text-xs text-yellow-800",children:e.notes})]})]},t))})]}),w.followUps&&w.followUps.length>0&&!w.conversationFlow&&(0,a.jsxs)("div",{className:"bg-blue-50/50 border border-blue-200 rounded-lg p-5 lg:p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Follow-Up Responses"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"If the dealer pushes back, here are responses you can use:"}),(0,a.jsx)("div",{className:"space-y-4",children:w.followUps.map((e,t)=>(0,a.jsx)("div",{className:"bg-white border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm text-gray-700 flex-1 whitespace-pre-wrap",children:e}),(0,a.jsx)(o.Z,{size:"sm",variant:"secondary",onClick:()=>{navigator.clipboard.writeText(e),alert("Follow-up copied to clipboard!")},children:"Copy"})]})},t))})]}),w.educationalHints&&w.educationalHints.length>0&&(0,a.jsxs)("div",{className:"bg-yellow-50/50 border border-yellow-200 rounded-lg p-5 lg:p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"What to Watch For"}),(0,a.jsx)("ul",{className:"space-y-2.5",children:w.educationalHints.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-yellow-600 mr-2.5 mt-0.5",children:"⚠️"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 flex-1",children:e})]},t))})]}),w.keyPoints&&w.keyPoints.length>0&&(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-5 lg:p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Key Points"}),(0,a.jsx)("ul",{className:"space-y-2",children:w.keyPoints.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-blue-600 mr-2 mt-1",children:"•"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 flex-1",children:e})]},t))})]}),w.tips&&w.tips.length>0&&(0,a.jsxs)("div",{className:"bg-green-50/50 border border-green-200 rounded-lg p-5 lg:p-6",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Additional Tips"}),(0,a.jsx)("ul",{className:"space-y-2",children:w.tips.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-green-600 mr-2 mt-1",children:"\uD83D\uDCA1"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 flex-1",children:e})]},t))})]}),I&&(0,a.jsx)(c,{className:"mt-6"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(o.Z,{onClick:()=>f("communication_method"),variant:"secondary",children:"Start Over"}),x&&(0,a.jsx)(o.Z,{onClick:x,variant:"secondary",children:"Done"})]})]});default:return null}})()})]})}var x=s(6281);function h(){let{user:e,loading:t}=(0,x.a)(),s=(0,l.useRouter)(),[n,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)([]),[b,f]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null);return((0,r.useEffect)(()=>{{let e=localStorage.getItem("scriptCarContext"),t=localStorage.getItem("scriptDealId");e&&(d(e),localStorage.removeItem("scriptCarContext")),t&&(i(t),localStorage.removeItem("scriptDealId"))}},[]),(0,r.useEffect)(()=>{(async()=>{f(!0),v(null);try{let e=await fetch("/api/packs"),t=await e.json();if(!t.success)throw Error(t.error||"Failed to load packs");h(t.selectedPackId||null);let s=(t.userPacks||[]).filter(e=>e.isUnlocked).map(e=>e.packId||e.pack_id);g(s)}catch(e){v(e.message||"Failed to load packs")}finally{f(!1)}})()},[]),t)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)(o.Z,{variant:"secondary",size:"sm",onClick:()=>s.push("/"),className:"mb-4",children:"← Back to Home"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Negotiation Script Generator"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Generate personalized negotiation scripts tailored to your situation"})]}),c&&(0,a.jsx)("div",{className:"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Car details pre-filled from your analysis"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"The wizard will use this information to personalize your script."})]})]})}),y&&(0,a.jsx)("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:y}),(0,a.jsx)(m,{user:e,initialCarContext:c,prefilledDealId:n,onCancel:()=>s.push("/"),activePackId:u,unlockedPackIds:p})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Please sign in to use this feature"}),(0,a.jsx)("a",{href:"/login",className:"text-blue-600 hover:text-blue-700",children:"Sign In"})]})})}(0,n.B)()},4226:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{variant:t="primary",size:s="md",className:r="",children:l,...n}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[s]," ").concat(r),...n,children:l})}s(2265)},9178:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 ".concat(s),children:t})}s(2265)},6281:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return o},a:function(){return c}});var a=s(7437),r=s(2265);let l=(0,s(9997).B)(),n=()=>{{let e="https://vabikejehdmpfcyqrgrs.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";return!!(e&&t&&e.length>10&&t.length>10&&!e.includes("placeholder"))}},i=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!n()){console.warn("Supabase not configured. Running in unauthenticated mode."),o(null),d(!1);return}let e=!0,t=null;(async()=>{try{let{data:{session:s},error:a}=await l.auth.getSession();if(!e)return;if(a)console.error("[AuthContext] Error getting initial session:",a),o(null);else{var t;console.log("[AuthContext] Initial session:",s?"User: ".concat(s.user.email):"No session"),o(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null)}d(!1)}catch(t){if(!e)return;console.error("[AuthContext] Error initializing auth:",t),o(null),d(!1)}})();let{data:{subscription:s}}=l.auth.onAuthStateChange(async(t,s)=>{var a;e&&(console.log("[AuthContext] Auth state changed:",t,s?"User: ".concat(s.user.email):"No session"),o(null!==(a=null==s?void 0:s.user)&&void 0!==a?a:null),d(!1))});return t=s,()=>{e=!1,t&&t.unsubscribe()}},[]);let u=async()=>{n()&&await l.auth.signOut(),o(null)};return(0,a.jsx)(i.Provider,{value:{user:s,loading:c,signOut:u},children:t})}function c(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8395:function(e,t,s){"use strict";s.d(t,{Z:function(){return r},l:function(){return a}});let a={first_time:{id:"first_time",name:"First-Time Buyer Pack",description:"Guidance for first-time buyers: financing basics, affordability, clarity.",features:["Budget & credit band questions","APR & term definitions","OTD vs monthly education","First-time friendly scripts"],education:["OTD includes taxes, fees, and registration - focus on OTD, not monthly.","APR is the annualized cost of borrowing - compare against pre-approval if you have one.","Longer terms lower monthly payment but increase total interest paid."],questions:[{id:"budget",label:"Max OTD budget",type:"number",required:!0,placeholder:"e.g., 25000"},{id:"credit_band",label:"Credit range (approx)",type:"select",required:!1,options:[{value:"excellent",label:"Excellent (760+)"},{value:"good",label:"Good (700-759)"},{value:"fair",label:"Fair (640-699)"},{value:"new",label:"Limited/First-time"}]},{id:"down_payment_est",label:"Down payment estimate",type:"number",required:!1,placeholder:"e.g., 4000"},{id:"driving_needs",label:"Primary driving needs",type:"text",required:!1,placeholder:"e.g., commute 40 miles daily"}]},cash:{id:"cash",name:"Cash Buyer Pack",description:"Cash-specific tactics and proof-of-funds handling.",features:["Cash disclosure timing","Proof-of-funds guidance","OTD and fees focus","No monthly payment talk"],education:["Delay disclosing cash until you have negotiated price.","Have proof of funds ready, but share only when it helps close at your price.","Cash can justify lower price: simpler deal, no financing reserve for dealer."],questions:[{id:"proof_of_funds",label:"Do you have proof of funds?",type:"boolean",required:!1},{id:"disclose_cash",label:"When do you want to disclose cash?",type:"select",required:!1,options:[{value:"late",label:"Only after price is agreed"},{value:"mid",label:"After initial counter"},{value:"early",label:"I prefer to disclose early"}]},{id:"open_to_finance",label:"Open to financing if it reduces price?",type:"boolean",required:!1}],comingSoon:!0},financing:{id:"financing",name:"Financing Buyer Pack",description:"Financing coaching: APR, term, pre-approval leverage.",features:["Max monthly & OTD focus","Pre-approval leverage","APR/term questions","Payment anchoring avoidance"],education:["Negotiate OTD first, financing second - do not anchor on monthly payment.","Compare dealer APR against your pre-approval; ask if low APR is contingent on add-ons.","Shorter terms cost more monthly but less interest overall."],questions:[{id:"target_monthly",label:"Target monthly (optional)",type:"number",required:!1,placeholder:"e.g., 400"},{id:"max_otd",label:"Max OTD",type:"number",required:!0,placeholder:"e.g., 25000"},{id:"preferred_term",label:"Preferred term",type:"select",required:!1,options:[{value:"36",label:"36 mo"},{value:"48",label:"48 mo"},{value:"60",label:"60 mo"},{value:"72",label:"72 mo"}]},{id:"pre_approved",label:"Do you have pre-approval?",type:"boolean",required:!1},{id:"pre_approval_rate",label:"Pre-approval APR",type:"number",required:!1,placeholder:"e.g., 5.5"}],comingSoon:!0},in_person:{id:"in_person",name:"In-Person Negotiation Pack",description:"Dealership talk tracks and pressure handling.",features:["Short talk tracks","Manager/pressure tactics","If they say X → say Y","Closing script for OTD"],education:["Practice your talk track - don't rely on recording; use written notes instead.",'If "manager" pressure starts, slow down: ask for written OTD before deciding.',"Have 2-3 calm phrases ready for add-on upsells."],questions:[{id:"comfort_firm",label:"Comfort being firm?",type:"select",required:!1,options:[{value:"low",label:"Prefer soft approach"},{value:"medium",label:"Comfortable pushing back politely"},{value:"high",label:"Very firm when needed"}]},{id:"expected_objections",label:"Objections you expect",type:"textarea",required:!1,placeholder:'e.g., "Price is already low", "Manager approval needed".'},{id:"has_trade_in",label:"Trade-in?",type:"boolean",required:!1}]},bundle:{id:"bundle",name:"Complete Bundle",description:"Get both packs at a discounted price: First-Time Buyer Pack + In-Person Negotiation Pack.",features:["Everything in First-Time Buyer Pack","Everything in In-Person Negotiation Pack","Best value for comprehensive coverage","Unlock both packs with one purchase"],education:["The bundle includes all features from both individual packs.","Perfect if you want complete guidance from first contact through in-person negotiation.","Save money compared to buying packs separately."],questions:[]}};function r(e){return a[e]||a.first_time}},9997:function(e,t,s){"use strict";s.d(t,{B:function(){return n}});var a=s(4033);let r="https://vabikejehdmpfcyqrgrs.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!r||!l){let e=[];throw r||e.push("NEXT_PUBLIC_SUPABASE_URL"),l||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Missing required Supabase environment variables: ".concat(e.join(", "),". ")+"These must be set in Vercel environment variables and available at build time.")}if(r.includes("placeholder")||l.includes("placeholder")){let e=[];throw r.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_URL"),l.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables. "+"Found placeholder in: ".concat(e.join(" and ")))}if(r.length<10||l.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function n(){return(0,a.createBrowserClient)(r,l)}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[33,971,117,744],function(){return e(e.s=3316)}),_N_E=e.O()}]);