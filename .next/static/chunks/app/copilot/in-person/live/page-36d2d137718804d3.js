(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1884],{924:function(e,t,s){Promise.resolve().then(s.bind(s,7479))},7479:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=s(7437),r=s(2265),n=s(9376),l=s(6281),i=s(8976),c=s(9178),o=s(4226);function d(e){let{dealerOTD:t,targetOTD:s,walkAwayOTD:r,onDealerOTDChange:n,onUpdate:l,disabled:i=!1}=e,d=t?t-s:null,u=d&&s>0?(d/s*100).toFixed(1):null;return(0,a.jsxs)(c.Z,{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Update Deal State"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dealer Current OTD"}),(0,a.jsx)("input",{type:"number",value:t||"",onChange:e=>{let t=""===e.target.value?null:parseFloat(e.target.value);n(isNaN(t)?null:t)},placeholder:"Enter dealer's current OTD",disabled:i,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-gray-600 uppercase mb-1",children:"Your Target OTD"}),(0,a.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-sm font-bold text-gray-900",children:["$",s.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-gray-600 uppercase mb-1",children:"Gap"}),(0,a.jsxs)("div",{className:"px-3 py-2 border rounded-lg text-sm font-bold ".concat(null===d?"text-gray-400 border-gray-300 bg-gray-50":d<=0?"text-green-600 border-green-300 bg-green-50":d<=500?"text-yellow-600 border-yellow-300 bg-yellow-50":"text-red-600 border-red-300 bg-red-50"),children:[null===d?"—":d>=0?"+$".concat(Math.abs(d).toLocaleString()):"-$".concat(Math.abs(d).toLocaleString()),u&&null!==d&&d>0&&(0,a.jsxs)("span",{className:"text-xs ml-1",children:["(",u,"%)"]})]})]})]}),(0,a.jsx)(o.Z,{onClick:l,disabled:i||null===t,className:"w-full",children:"Update Deal State"})]})]})}let u=(0,s(9997).B)();function m(){let{user:e,loading:t}=(0,l.a)(),s=(0,n.useRouter)(),{loading:m,hasInPerson:x}=(0,i.m)();(0,r.useEffect)(()=>{t||m||x||s.push("/copilot/free")},[t,m,x,s]);let[h,b]=(0,r.useState)(""),[g,p]=(0,r.useState)(""),[f,y]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[S,I]=(0,r.useState)(""),[_,C]=(0,r.useState)(!1),[D,T]=(0,r.useState)(null),[A,k]=(0,r.useState)(null),[E,P]=(0,r.useState)(null);(0,r.useEffect)(()=>{{let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.vehiclePrice&&b(t.vehiclePrice),t.targetOTD&&p(t.targetOTD),t.walkAwayOTD&&y(t.walkAwayOTD),t.state&&N(t.state)}catch(e){console.error("Failed to parse saved state:",e)}}},[]),(0,r.useEffect)(()=>{(h||g||f||j)&&localStorage.setItem("copilot_in_person_prepare_state",JSON.stringify({vehiclePrice:h,targetOTD:g,walkAwayOTD:f,state:j,zip:v}))},[h,g,f,j,v]);let Z=async()=>{if(!S.trim()){k("Please describe what just happened");return}C(!0),k(null),T(null);try{let{data:{session:e}}=await u.auth.getSession(),t={"Content-Type":"application/json"};(null==e?void 0:e.access_token)&&(t.Authorization="Bearer ".concat(e.access_token));let s=parseFloat(g)||0,a=parseFloat(f)||(s>0?s+1e3:0),r=parseFloat(h)||0,n={mode:"between_rounds_advisor",userInput:S.trim(),context:{vehiclePrice:r,targetOTD:s,walkAwayOTD:a,dealerOTD:E||void 0,state:j.trim().toUpperCase()||void 0}},l=await fetch("/api/copilot/in-person/advisor",{method:"POST",headers:t,body:JSON.stringify(n)});if(!l.ok){let e=await l.text();throw Error("Failed to get advice: ".concat(l.status," ").concat(e))}let i=await l.json();if(!i.success)throw Error(i.error||"Failed to get advice");T(i.data)}catch(e){k(e.message||"Failed to get advice")}finally{C(!1)}},O=e=>{navigator.clipboard.writeText(e)};if(t||m)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})});if(!e)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Please sign in to use this feature"}),(0,a.jsx)("a",{href:"/login",className:"text-blue-600 hover:text-blue-700",children:"Sign In"})]})});if(!x)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"In-Person Negotiation Pack required"}),(0,a.jsx)("a",{href:"/packs",className:"text-blue-600 hover:text-blue-700",children:"View Packs"})]})});let U=parseFloat(g)||0;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-3",children:(0,a.jsx)(o.Z,{onClick:()=>s.push("/copilot/in-person"),variant:"secondary",size:"sm",children:"← Back to In-Person Pack"})})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Deal Decision Advisor"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Clear next steps after stepping away from the salesperson."})]}),(0,a.jsxs)(c.Z,{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Prepare Me"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Set your numbers before you negotiate. The advisor uses these silently to give you better guidance."}),(0,a.jsx)(d,{dealerOTD:E,targetOTD:U,walkAwayOTD:parseFloat(f)||U+1e3,onDealerOTDChange:e=>{P(e)},onUpdate:()=>{},disabled:_})]}),(0,a.jsxs)(c.Z,{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"What Just Happened?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Paste what the dealer said or describe the situation. Dollar amounts are optional."}),(0,a.jsx)("textarea",{value:S,onChange:e=>I(e.target.value),placeholder:"Example: 'They said the OTD is $28,500 but I need $27,000. They keep asking about monthly payments.'",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none",rows:5,disabled:_}),(0,a.jsx)(o.Z,{onClick:Z,disabled:_||!S.trim(),className:"w-full mt-4 text-lg py-6 font-semibold",children:_?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"animate-spin",children:"⏳"}),"Analyzing situation..."]}):"Get Decision"}),A&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-800",children:A})})]}),D&&!_&&(0,a.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-300",children:[(0,a.jsx)(c.Z,{className:"bg-blue-50 border-2 border-blue-300",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"\uD83D\uDD0D"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Situation Diagnosis"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed font-medium",children:D.whatsReallyHappening})]})]})}),(0,a.jsx)(c.Z,{className:"bg-red-50 border-2 border-red-300",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"⚠️"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Why This Matters"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed font-medium",children:D.whyThisMatters})]})]})}),(0,a.jsx)(c.Z,{className:"bg-gradient-to-br from-primary/20 to-accent/20 border-2 border-primary/40 shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white font-bold text-sm",children:"✅"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Correct Move"}),(0,a.jsx)("p",{className:"text-base text-gray-900 leading-relaxed font-semibold",children:D.yourBestMove})]})]})}),(0,a.jsxs)(c.Z,{className:"bg-white border-2 border-primary/30 shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white font-bold text-sm",children:"\uD83D\uDDE3️"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Say This (Exact Script)"})})]}),(0,a.jsxs)("div",{className:"bg-slate-50 border-2 border-slate-300 rounded-lg p-4 ml-11",children:[(0,a.jsx)("p",{className:"text-base text-gray-900 leading-relaxed whitespace-pre-wrap font-medium",children:D.exactlyWhatToSay}),(0,a.jsx)(o.Z,{onClick:()=>O(D.exactlyWhatToSay),variant:"primary",size:"sm",className:"mt-4",children:"\uD83D\uDCCB Copy Script"})]})]}),(0,a.jsx)(c.Z,{className:"bg-green-50 border-2 border-green-300",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"\uD83E\uDDE0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"Confidence Check"}),(0,a.jsx)("p",{className:"text-sm text-gray-800 leading-relaxed font-medium italic",children:D.confidenceSignal})]})]})}),(0,a.jsxs)(c.Z,{className:"bg-slate-100 border-2 border-slate-300 mt-6",children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-gray-900 mb-3",children:"Why this is different than asking ChatGPT"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary mt-0.5",children:"•"}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:"Uses your exact negotiation numbers"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary mt-0.5",children:"•"}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:"Applies dealership-specific tactics"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary mt-0.5",children:"•"}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:"Makes a single clear decision for you"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary mt-0.5",children:"•"}),(0,a.jsx)("p",{className:"text-xs text-gray-700",children:"Tells you exactly what to say — no prompt engineering"})]})]})]})]}),(0,a.jsx)("div",{className:"mt-8 p-4 bg-slate-50 border border-slate-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-xs text-slate-600 italic text-center",children:"\uD83D\uDCA1 This decision advisor is designed for between conversations, not live negotiation. Step away from the salesperson to use it."})})]})]})}},4226:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{variant:t="primary",size:s="md",className:r="",children:n,...l}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[s]," ").concat(r),...l,children:n})}s(2265)},9178:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 ".concat(s),children:t})}s(2265)},6281:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return c},a:function(){return o}});var a=s(7437),r=s(2265);let n=(0,s(9997).B)(),l=()=>{{let e="https://vabikejehdmpfcyqrgrs.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";return!!(e&&t&&e.length>10&&t.length>10&&!e.includes("placeholder"))}},i=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!l()){console.warn("Supabase not configured. Running in unauthenticated mode."),c(null),d(!1);return}let e=!0,t=null;(async()=>{try{let{data:{session:s},error:a}=await n.auth.getSession();if(!e)return;if(a)console.error("[AuthContext] Error getting initial session:",a),c(null);else{var t;console.log("[AuthContext] Initial session:",s?"User: ".concat(s.user.email):"No session"),c(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null)}d(!1)}catch(t){if(!e)return;console.error("[AuthContext] Error initializing auth:",t),c(null),d(!1)}})();let{data:{subscription:s}}=n.auth.onAuthStateChange(async(t,s)=>{var a;e&&(console.log("[AuthContext] Auth state changed:",t,s?"User: ".concat(s.user.email):"No session"),c(null!==(a=null==s?void 0:s.user)&&void 0!==a?a:null),d(!1))});return t=s,()=>{e=!1,t&&t.unsubscribe()}},[]);let u=async()=>{l()&&await n.auth.signOut(),c(null)};return(0,a.jsx)(i.Provider,{value:{user:s,loading:o,signOut:u},children:t})}function o(){let e=(0,r.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8976:function(e,t,s){"use strict";s.d(t,{m:function(){return n}});var a=s(2265);let r=(0,s(9997).B)();function n(){let[e,t]=(0,a.useState)(!0),[s,n]=(0,a.useState)({first_time:!1,in_person:!1,bundle:!1}),l=(0,a.useCallback)(async()=>{try{t(!0);let{data:{user:e}}=await r.auth.getUser();if(!e){n({first_time:!1,in_person:!1,bundle:!1}),t(!1);return}let{data:s,error:a}=await r.from("user_entitlements").select("first_time, in_person, bundle").eq("user_id",e.id).single();a?"PGRST116"===a.code?n({first_time:!1,in_person:!1,bundle:!1}):console.error("[useEntitlements] Error fetching entitlements:",a):n({first_time:(null==s?void 0:s.first_time)||!1,in_person:(null==s?void 0:s.in_person)||!1,bundle:(null==s?void 0:s.bundle)||!1})}catch(e){console.error("[useEntitlements] Error:",e)}finally{t(!1)}},[]);(0,a.useEffect)(()=>{l();let{data:{subscription:e}}=r.auth.onAuthStateChange(()=>{l()});return()=>{e.unsubscribe()}},[l]);let i=s.first_time||s.bundle,c=s.in_person||s.bundle,o=s.bundle;return{loading:e,entitlements:s,hasFirstTime:i,hasInPerson:c,hasBundle:o,refreshEntitlements:l}}},9997:function(e,t,s){"use strict";s.d(t,{B:function(){return l}});var a=s(4033);let r="https://vabikejehdmpfcyqrgrs.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!r||!n){let e=[];throw r||e.push("NEXT_PUBLIC_SUPABASE_URL"),n||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Missing required Supabase environment variables: ".concat(e.join(", "),". ")+"These must be set in Vercel environment variables and available at build time.")}if(r.includes("placeholder")||n.includes("placeholder")){let e=[];throw r.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_URL"),n.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables. "+"Found placeholder in: ".concat(e.join(" and ")))}if(r.length<10||n.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function l(){return(0,a.createBrowserClient)(r,n)}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[4033,2971,2117,1744],function(){return e(e.s=924)}),_N_E=e.O()}]);