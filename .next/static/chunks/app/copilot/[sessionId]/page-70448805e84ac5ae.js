(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2565],{9450:function(e,s,t){Promise.resolve().then(t.bind(t,1438))},1438:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(7437),a=t(2265),n=t(9376),i=t(6281),l=t(9178),c=t(4226);function o(e){let{user:s,loading:t}=(0,i.a)(),o=(0,n.useRouter)(),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)([]),[x,g]=(0,a.useState)(!0),[p,b]=(0,a.useState)(!1),[y,j]=(0,a.useState)(""),[f,N]=(0,a.useState)("dealer"),[v,_]=(0,a.useState)(null),w=e.params.sessionId;(0,a.useEffect)(()=>{s&&w&&I()},[s,w]);let I=async()=>{if(w)try{let e=await fetch("/api/copilot/sessions/".concat(w)),s=await e.json();if(!s.success)throw Error(s.error||"Failed to load session");u(s.session),h(s.messages||[])}catch(e){_(e.message||"Failed to load session")}finally{g(!1)}},C=async()=>{if(y.trim()&&(b(!0),_(null),w))try{let e=await fetch("/api/copilot/sessions/".concat(w,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:f,content:y})}),s=await e.json();if(!s.success)throw Error(s.error||"Failed to send message");await I(),j("")}catch(e){_(e.message||"Failed to send message")}finally{b(!1)}};if(t||x)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})});if(!s)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Please sign in to use this feature"}),(0,r.jsx)("a",{href:"/login",className:"text-blue-600 hover:text-blue-700",children:"Sign In"})]})});if(v&&!d)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)(l.Z,{className:"bg-red-50 border-red-200",children:[(0,r.jsx)("p",{className:"text-red-700",children:v}),(0,r.jsx)(c.Z,{onClick:()=>o.push("/copilot/new"),className:"mt-4",children:"Start New Session"})]})});let S=[...m].reverse().find(e=>"copilot"===e.role);return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(c.Z,{variant:"secondary",onClick:()=>o.push("/copilot/new"),className:"mb-4",children:"← New Session"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:(null==d?void 0:d.car_make)&&(null==d?void 0:d.car_model)?"".concat(d.car_make," ").concat(d.car_model):"Negotiation Session"}),d&&(0,r.jsxs)("p",{className:"text-gray-600",children:[d.pack_type," • ",d.communication_method," • ",d.current_stage]})]}),v&&(0,r.jsx)(l.Z,{className:"bg-red-50 border-red-200 mb-6",children:(0,r.jsx)("p",{className:"text-red-700",children:v})}),(null==d?void 0:d.initial_strategy)&&0===m.length&&(0,r.jsxs)(l.Z,{className:"mb-6 bg-blue-50 border-blue-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Your Strategy"}),(0,r.jsxs)("div",{className:"space-y-4",children:[d.initial_strategy.summary&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:"Overview"}),(0,r.jsx)("p",{className:"text-sm text-gray-700",children:d.initial_strategy.summary})]}),d.initial_strategy.key_points&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:"Key Points"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-sm text-gray-700 space-y-1",children:d.initial_strategy.key_points.map((e,s)=>(0,r.jsx)("li",{children:e},s))})]}),d.initial_script&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:"Your Initial Message"}),(0,r.jsxs)("div",{className:"bg-white border border-blue-200 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:d.initial_script}),(0,r.jsx)(c.Z,{size:"sm",className:"mt-2",onClick:()=>{navigator.clipboard.writeText(d.initial_script||""),alert("Copied to clipboard!")},children:"Copy"})]})]})]})]}),(0,r.jsx)("div",{className:"space-y-4 mb-6",children:m.map(e=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsxs)(l.Z,{className:"max-w-3xl ".concat("user"===e.role?"bg-blue-600 text-white":"dealer"===e.role?"bg-gray-200":"bg-green-50 border-green-200"),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium opacity-75",children:"user"===e.role?"You":"dealer"===e.role?"Dealer":"Co-Pilot"}),(0,r.jsx)("span",{className:"text-xs opacity-75",children:new Date(e.created_at).toLocaleTimeString()})]}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),"copilot"===e.role&&(0,r.jsxs)("div",{className:"mt-4 space-y-3 pt-4 border-t border-green-300",children:[e.tactic_explanation&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-1",children:"What the dealer is doing:"}),(0,r.jsx)("p",{className:"text-xs text-gray-700",children:e.tactic_explanation})]}),e.recommended_response&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-1",children:"Recommended Response:"}),(0,r.jsxs)("div",{className:"bg-white border border-green-200 rounded p-2",children:[(0,r.jsx)("p",{className:"text-xs text-gray-700 whitespace-pre-wrap",children:e.recommended_response}),(0,r.jsx)(c.Z,{size:"sm",variant:"secondary",className:"mt-2",onClick:()=>{navigator.clipboard.writeText(e.recommended_response||""),alert("Copied to clipboard!")},children:"Copy"})]})]}),e.suggested_counter_range&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-1",children:"Suggested Counter Range:"}),(0,r.jsxs)("p",{className:"text-xs text-gray-700",children:["$",e.suggested_counter_range.min.toLocaleString()," - $",e.suggested_counter_range.max.toLocaleString()]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1 italic",children:e.suggested_counter_range.rationale})]}),e.next_questions&&e.next_questions.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-1",children:"Next Questions to Ask:"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-xs text-gray-700 space-y-1",children:e.next_questions.map((e,s)=>(0,r.jsx)("li",{children:e},s))})]}),e.checklist_items&&e.checklist_items.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-xs font-semibold text-gray-900 mb-1",children:"Checklist:"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-xs text-gray-700 space-y-1",children:e.checklist_items.map((e,s)=>(0,r.jsx)("li",{children:e},s))})]})]})]})},e.id))}),S&&(0,r.jsxs)(l.Z,{className:"mb-6 bg-yellow-50 border-yellow-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Next Step"}),S.recommended_response&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:"Your recommended response:"}),(0,r.jsx)("div",{className:"bg-white border border-yellow-200 rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:S.recommended_response})})]})]}),(0,r.jsx)(l.Z,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"What happened? (Paste dealer message or describe in-person interaction)"}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,r.jsx)("button",{onClick:()=>N("dealer"),className:"px-4 py-2 rounded-lg text-sm font-medium transition ".concat("dealer"===f?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"Dealer Message"}),(0,r.jsx)("button",{onClick:()=>N("user"),className:"px-4 py-2 rounded-lg text-sm font-medium transition ".concat("user"===f?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"What I Said"})]}),(0,r.jsx)("textarea",{value:y,onChange:e=>j(e.target.value),placeholder:"dealer"===f?"Paste the dealer's message here...":"Describe what you said or what happened...",rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsx)(c.Z,{onClick:C,disabled:!y.trim()||p,className:"w-full",children:p?"Processing...":"Get Co-Pilot Response"})]})})]})})}},4226:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var r=t(7437);function a(e){let{variant:s="primary",size:t="md",className:a="",children:n,...i}=e;return(0,r.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500"}[s]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[t]," ").concat(a),...i,children:n})}t(2265)},9178:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});var r=t(7437);function a(e){let{children:s,className:t=""}=e;return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 ".concat(t),children:s})}t(2265)},6281:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return c},a:function(){return o}});var r=t(7437),a=t(2265);let n=(0,t(9997).B)(),i=()=>{{let e="https://vabikejehdmpfcyqrgrs.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";return!!(e&&s&&e.length>10&&s.length>10&&!e.includes("placeholder"))}},l=(0,a.createContext)(void 0);function c(e){let{children:s}=e,[t,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!i()){console.warn("Supabase not configured. Running in unauthenticated mode."),c(null),d(!1);return}let e=!0,s=null;(async()=>{try{let{data:{session:t},error:r}=await n.auth.getSession();if(!e)return;if(r)console.error("[AuthContext] Error getting initial session:",r),c(null);else{var s;console.log("[AuthContext] Initial session:",t?"User: ".concat(t.user.email):"No session"),c(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null)}d(!1)}catch(s){if(!e)return;console.error("[AuthContext] Error initializing auth:",s),c(null),d(!1)}})();let{data:{subscription:t}}=n.auth.onAuthStateChange(async(s,t)=>{var r;e&&(console.log("[AuthContext] Auth state changed:",s,t?"User: ".concat(t.user.email):"No session"),c(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),d(!1))});return s=t,()=>{e=!1,s&&s.unsubscribe()}},[]);let u=async()=>{i()&&await n.auth.signOut(),c(null)};return(0,r.jsx)(l.Provider,{value:{user:t,loading:o,signOut:u},children:s})}function o(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9997:function(e,s,t){"use strict";t.d(s,{B:function(){return i}});var r=t(4033);let a="https://vabikejehdmpfcyqrgrs.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!a||!n){let e=[];throw a||e.push("NEXT_PUBLIC_SUPABASE_URL"),n||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Missing required Supabase environment variables: ".concat(e.join(", "),". ")+"These must be set in Vercel environment variables and available at build time.")}if(a.includes("placeholder")||n.includes("placeholder")){let e=[];throw a.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_URL"),n.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables. "+"Found placeholder in: ".concat(e.join(" and ")))}if(a.length<10||n.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function i(){return(0,r.createBrowserClient)(a,n)}},9376:function(e,s,t){"use strict";var r=t(5475);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[4033,2971,2117,1744],function(){return e(e.s=9450)}),_N_E=e.O()}]);