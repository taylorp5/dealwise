(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[179,116],{7455:function(e,t,s){Promise.resolve().then(s.bind(s,8394))},8394:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),r=s(2265),i=s(9376),l=s(9178),n=s(4226),o=s(6281),c=s(911),d=s(7116);function u(){var e,t;let u=(0,i.useRouter)(),{user:m,loading:x}=(0,o.a)(),{ownedPacks:h}=function(){let[e,t]=(0,r.useState)({ownedPacks:[],allAccess:!1});return(0,r.useEffect)(()=>{t((0,d.HF)());let e=e=>{"dealership_copilot_owned_packs"===e.key&&t((0,d.HF)())};window.addEventListener("storage",e);let s=()=>{t((0,d.HF)())};return window.addEventListener("packEntitlementsChanged",s),()=>{window.removeEventListener("storage",e),window.removeEventListener("packEntitlementsChanged",s)}},[]),{...e,refresh:()=>{t((0,d.HF)()),window.dispatchEvent(new Event("packEntitlementsChanged"))}}}(),g=(0,d.wT)("in_person")||(0,d.UW)(),p=(0,d.wT)("first_time")||(0,d.UW)(),[b,f]=(0,r.useState)("basics"),[y,j]=(0,r.useState)(""),[v,N]=(0,r.useState)(""),[w,F]=(0,r.useState)(""),[S,k]=(0,r.useState)("used"),[C,D]=(0,r.useState)("dealer"),[_,T]=(0,r.useState)(""),[I,O]=(0,r.useState)(!1),[A,R]=(0,r.useState)(null),[P,L]=(0,r.useState)(!1),[E,M]=(0,r.useState)(""),[$,Z]=(0,r.useState)(""),[B,z]=(0,r.useState)(""),[V,Y]=(0,r.useState)(""),[U,J]=(0,r.useState)([]),[q,X]=(0,r.useState)(""),[W,H]=(0,r.useState)(""),[G,K]=(0,r.useState)(""),[Q,ee]=(0,r.useState)([]),[et,es]=(0,r.useState)([]),[ea,er]=(0,r.useState)(0),[ei,el]=(0,r.useState)(0),[en,eo]=(0,r.useState)(0),[ec,ed]=(0,r.useState)(!1),[eu,em]=(0,r.useState)(!1),[ex,eh]=(0,r.useState)(""),[eg,ep]=(0,r.useState)(""),[eb,ef]=(0,r.useState)(""),[ey,ej]=(0,r.useState)("");(0,r.useEffect)(()=>{{let e=localStorage.getItem("otd_builder_price"),t=localStorage.getItem("otd_builder_state"),s=localStorage.getItem("otd_builder_tax_rate");if(e&&(F(e),console.log("OTD Builder: Loaded price from localStorage:",e)),t&&(j(t),console.log("OTD Builder: Loaded state from localStorage:",t)),s&&(T(s),O(!0),console.log("OTD Builder: Loaded tax rate from localStorage:",s)),(e||t||s)&&(localStorage.removeItem("otd_builder_price"),localStorage.removeItem("otd_builder_state"),localStorage.removeItem("otd_builder_tax_rate")),g){let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.targetOTD&&ep(t.targetOTD),t.walkAwayOTD&&ef(t.walkAwayOTD)}catch(e){console.error("Failed to parse Prepare Me state:",e)}let t=localStorage.getItem("in_person_dealer_current_otd"),s=localStorage.getItem("in_person_target_otd"),a=localStorage.getItem("in_person_walkaway_ceiling");t&&eh(t),s&&!eg&&ep(s),a&&!eb&&ef(a)}if(p){let e=localStorage.getItem("first_time_dealer_quoted_otd");e&&ej(e)}}},[]),(0,r.useEffect)(()=>{if(g){if(ex&&localStorage.setItem("in_person_dealer_current_otd",ex),eg){localStorage.setItem("in_person_target_otd",eg);let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.targetOTD=eg,localStorage.setItem("copilot_in_person_prepare_state",JSON.stringify(t))}catch(e){}}if(eb){localStorage.setItem("in_person_walkaway_ceiling",eb);let e=localStorage.getItem("copilot_in_person_prepare_state");if(e)try{let t=JSON.parse(e);t.walkAwayOTD=eb,localStorage.setItem("copilot_in_person_prepare_state",JSON.stringify(t))}catch(e){}}}},[ex,eg,eb,g]),(0,r.useEffect)(()=>{p&&(ey?localStorage.setItem("first_time_dealer_quoted_otd",ey):localStorage.removeItem("first_time_dealer_quoted_otd"))},[ey,p]),(0,r.useEffect)(()=>{if(y&&!I){L(!0);let e=new URLSearchParams({state:y});v&&e.append("zip",v),fetch("/api/tax-lookup?".concat(e.toString())).then(e=>e.json()).then(e=>{if(e.success&&e.data){let t=e.data;R(t),void 0!==t.combinedRate?T(t.combinedRate.toFixed(2)):t.combinedRateRange?T(((t.combinedRateRange.low+t.combinedRateRange.high)/2).toFixed(2)):T(t.stateBaseRate.toFixed(2))}else throw Error(e.error||"Tax lookup failed");L(!1)}).catch(e=>{console.warn("Tax rate lookup failed:",e);let t=(0,c.R4)(y);null!==t?(T(t.toFixed(2)),R({stateBaseRate:t,combinedRateRange:{low:t,high:t+2.5},confidence:"low",source:"state_table",provider:"fallback",disclaimer:"Tax rate lookup failed. Using state base rate estimate."})):(T(""),R(null)),L(!1)})}else y||(R(null),T(""),L(!1))},[y,v,I]);let ev={docFee:{normal:150,high:500,inflated:800},titleFee:{normal:20,high:100,inflated:200},registrationFee:{normal:50,high:200,inflated:400}},eN=e=>{J(U.filter(t=>t.id!==e))},ew=()=>{if(!G.trim())return;let e=G.split("\n").filter(e=>e.trim()),t=[];e.forEach(e=>{let s=e.match(/\$?([\d,]+\.?\d*)/),a=s?parseFloat(s[1].replace(/,/g,"")):0,r=e.replace(/\$?[\d,]+\.?\d*/g,"").trim();if(r&&a>0){let e="normal",s=r.toLowerCase();s.includes("nitrogen")||s.includes("paint protection")||s.includes("fabric protection")||s.includes("vin etching")||s.includes("warranty")&&a>2e3||a>1e3?e="inflated":(s.includes("gap")||s.includes("extended warranty")||a>500)&&(e="maybe"),t.push({name:r,price:a,classification:e})}}),ee(t)},eF=()=>{let{parseMoney:e,parsePercentToDecimal:t,calculateOTD:a,calculateOTDRange:r}=s(6137),i=e(w),l=t(_),n=e(E),o=e($),c=e(B),d=e(V),u=U.reduce((t,s)=>t+e(s.amount),0),m=Q.reduce((t,s)=>t+e(s.price),0),x=a({vehiclePrice:i,taxRateDecimal:l,docFee:n,titleFee:o,registrationFee:c,otherFees:d+u,addOns:m}),h=r({vehiclePrice:i,taxRateDecimal:l,docFee:{low:ev.docFee.normal,high:ev.docFee.high},titleFee:{low:ev.titleFee.normal,high:ev.titleFee.high},registrationFee:{low:ev.registrationFee.normal,high:ev.registrationFee.high},otherFees:d+u,addOns:m});er(h.low),el(x.otd),eo(h.high);let g=[...x.issues,...h.issues];if(n>ev.docFee.inflated?g.push("Documentation fee of $".concat(n," is unusually high. Typical range is $").concat(ev.docFee.normal,"-").concat(ev.docFee.high,". Consider negotiating this down.")):n>ev.docFee.high&&g.push("Documentation fee of $".concat(n," is on the high side. Average is around $").concat(ev.docFee.normal,"-").concat(ev.docFee.high,".")),Q.some(e=>"inflated"===e.classification)){let e=Q.filter(e=>"inflated"===e.classification);g.push("".concat(e.length," add-on(s) appear inflated and may be optional: ").concat(e.map(e=>e.name).join(", ")))}Q.some(e=>"maybe"===e.classification)&&g.push("Some add-ons may be optional. Ask the dealer which are required vs. optional."),0==100*l&&y&&g.push("Tax rate is 0%. Please verify this is correct for your state."),es(g),f("results")};if(x)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})});if(!m)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Please sign in to use this feature"}),(0,a.jsx)("a",{href:"/login",className:"text-blue-600 hover:text-blue-700",children:"Sign In"})]})});let eS="basics"===b?33:"fees"===b?66:"addons"===b?90:100;return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Smart OTD Builder"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Build your out-the-door price with guided steps and smart defaults"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,a.jsxs)("span",{children:["Step ","basics"===b?1:"fees"===b?2:"addons"===b?3:4," of 4"]}),(0,a.jsxs)("span",{children:[eS,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(eS,"%")}})})]}),(0,a.jsxs)(l.Z,{className:"p-6 lg:p-8",children:["basics"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Step 1: ",p?"Verify Your Location & Price":"Basics"]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-5 w-5 text-blue-600 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsxs)("div",{className:"ml-3 flex-1",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-900",children:"Registration Location"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 mt-1",children:"Tax is calculated based on where you'll register the vehicle. ZIP code provides more accurate rates (includes local taxes)."})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["State ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:y,onChange:e=>{j(e.target.value.toUpperCase().slice(0,2)),O(!1)},placeholder:"CA, TX, NY",maxLength:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 uppercase",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["ZIP Code ",(0,a.jsx)("span",{className:"text-blue-600 text-xs",children:"(Recommended)"})]}),(0,a.jsx)("input",{type:"text",value:v,onChange:e=>{N(e.target.value.replace(/[^0-9-]/g,"").slice(0,10)),O(!1)},placeholder:"90210",maxLength:10,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"ZIP code provides more accurate tax rates"})]})]}),A&&!P&&(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2 mt-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"State Base Rate:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[A.stateBaseRate.toFixed(2),"%"]})]}),void 0!==A.estimatedLocalAddOn&&A.estimatedLocalAddOn>0&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Estimated Local Add-on:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["+",A.estimatedLocalAddOn.toFixed(2),"%"]})]}),void 0!==A.combinedRate?(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Combined Rate:"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[A.combinedRate.toFixed(2),"%"]})]}):A.combinedRateRange&&(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Combined Rate Range:"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[A.combinedRateRange.low.toFixed(2),"% - ",A.combinedRateRange.high.toFixed(2),"%"]})]}),A.confidence&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Confidence:"}),(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded ".concat("high"===A.confidence?"bg-green-100 text-green-700":"medium"===A.confidence?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:A.confidence.toUpperCase()})]}),A.source&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Source:"}),(0,a.jsx)("span",{className:"text-xs text-gray-500 capitalize",children:A.source.replace(/_/g," ")})]}),A.disclaimer&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[(0,a.jsx)("strong",{children:"Note:"})," ",A.disclaimer]}),(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[(0,a.jsx)("strong",{children:"⚠️ Validation Required:"})," Tax rates are estimates only. Vehicle tax rules vary by state and locality, and may differ from general sales tax. ZIP-based estimates can be imperfect. Always verify the actual tax rate with your dealer or state DMV before finalizing your purchase."]})]}),P&&(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mt-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"inline-block w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Looking up tax rate..."})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Listed Price ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",value:w,onChange:e=>F(e.target.value),placeholder:"25000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Type"}),(0,a.jsxs)("select",{value:S,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"used",children:"Used"}),(0,a.jsx)("option",{value:"new",children:"New"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Seller Type"}),(0,a.jsxs)("select",{value:C,onChange:e=>D(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"dealer",children:"Dealer"}),(0,a.jsx)("option",{value:"private",children:"Private Party"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Tax Rate (%) ",(0,a.jsx)("span",{className:"text-red-500",children:"*"}),!p&&!I&&(0,a.jsx)("button",{type:"button",onClick:()=>O(!0),className:"ml-2 text-xs text-blue-600 hover:text-blue-700",children:"Override"})]}),(0,a.jsx)("input",{type:"number",step:"0.01",value:_,onChange:e=>{T(e.target.value),O(null!=A&&!!A.combinedRateRange)},placeholder:(null==A?void 0:null===(e=A.combinedRate)||void 0===e?void 0:e.toFixed(2))||((null==A?void 0:A.combinedRateRange)?"".concat(A.combinedRateRange.low.toFixed(2),"-").concat(A.combinedRateRange.high.toFixed(2)):(null===(t=(0,c.R4)(y))||void 0===t?void 0:t.toFixed(2))||"6.25"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,disabled:P||p,readOnly:p}),_&&!I&&A&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[A.combinedRate?"Auto-filled from ".concat(A.confidence," confidence lookup."):"Auto-filled from state base rate + local estimate.",!p&&' Click "Override" to manually adjust.']}),_&&!I&&!A&&(0,a.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"⚠️ Please verify this tax rate is correct for your state and locality"}),_&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[(0,a.jsx)("strong",{children:"⚠️ Validation Required:"})," Tax rates are estimates only. Vehicle tax rules vary by state and locality, and may differ from general sales tax. Always verify the actual tax rate with your dealer or state DMV before finalizing your purchase."]})]})]}),"fees"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Step 2: ",p?"Common Fees to Expect":"Fees"]}),p&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,a.jsx)("p",{className:"text-xs text-blue-800",children:"If the dealer hasn't provided a fee in writing, don't assume it applies. Ask for an itemized OTD worksheet."})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Documentation Fee",(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(Typical: $",ev.docFee.normal,"-$",ev.docFee.high,")"]})]}),(0,a.jsx)("input",{type:"number",value:E,onChange:e=>M(e.target.value),placeholder:ev.docFee.normal.toString(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title Fee",(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(Typical: $$",ev.titleFee.normal,"-$",ev.titleFee.high,")"]})]}),(0,a.jsx)("input",{type:"number",value:$,onChange:e=>Z(e.target.value),placeholder:ev.titleFee.normal.toString(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Registration Fee",(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(Typical: $$",ev.registrationFee.normal,"-$",ev.registrationFee.high,")"]})]}),(0,a.jsx)("input",{type:"number",value:B,onChange:e=>z(e.target.value),placeholder:ev.registrationFee.normal.toString(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),!p||eu?(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Dealer Fees (optional)"}),(0,a.jsx)("input",{type:"number",value:V,onChange:e=>Y(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}):(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"button",onClick:()=>em(!0),className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Add other dealer fees (optional)"})})]}),!p||ec?(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Custom Fees (from dealer worksheet)"}),(0,a.jsxs)("div",{className:"space-y-2",children:[U.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:[e.name,": $",e.amount.toLocaleString()]}),(0,a.jsx)("button",{type:"button",onClick:()=>eN(e.id),className:"text-red-600 hover:text-red-700 text-sm",children:"Remove"})]},e.id)),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:q,onChange:e=>X(e.target.value),placeholder:"Fee name",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("input",{type:"number",value:W,onChange:e=>H(e.target.value),placeholder:"Amount",className:"w-24 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)(n.Z,{type:"button",size:"sm",onClick:()=>{q&&W&&(J([...U,{id:Date.now().toString(),name:q,amount:parseFloat(W)||0,isCustom:!0}]),X(""),H(""))},children:"Add"})]})]})]}):(0,a.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,a.jsx)("button",{type:"button",onClick:()=>ed(!0),className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Add fees from dealer worksheet (optional)"})})]}),"addons"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Step 3: ",p?"Identify Optional Add-Ons":"Add-on Detector"]}),p&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,a.jsx)("p",{className:"text-xs text-blue-800",children:"Most add-ons are optional. Paste the worksheet line items to identify what can be removed before agreeing to OTD."})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:'Paste line items from the dealer worksheet (e.g., "Nitrogen $299, Paint protection $899")'}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add-on Items"}),(0,a.jsx)("textarea",{value:G,onChange:e=>K(e.target.value),onBlur:ew,placeholder:"Nitrogen $299 Paint protection $899 Extended warranty $1,299",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[150px]"}),(0,a.jsx)(n.Z,{type:"button",variant:"secondary",size:"sm",onClick:ew,className:"mt-2",children:"Classify Add-ons"})]}),Q.length>0&&(0,a.jsx)("div",{className:"space-y-2",children:Q.map((e,t)=>(0,a.jsxs)("div",{className:"p-3 rounded-lg border ".concat("inflated"===e.classification?"bg-red-50 border-red-200":"maybe"===e.classification?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("span",{className:"text-gray-600 ml-2",children:["$",e.price.toLocaleString()]})]}),(0,a.jsx)("span",{className:"text-xs font-semibold px-2 py-1 rounded ".concat("inflated"===e.classification?"bg-red-100 text-red-700":"maybe"===e.classification?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:"inflated"===e.classification?"Inflated":"maybe"===e.classification?"Maybe":"Normal"})]}),"inflated"===e.classification&&g&&(0,a.jsxs)("p",{className:"text-xs text-red-700 mt-2",children:[(0,a.jsx)("strong",{children:"Pushback:"})," \"I'm not interested in ",e.name.toLowerCase(),'. Can we remove it from the quote?"']})]},t))})]}),"results"===b&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:p?"OTD Reality Check":"Your OTD Estimate"}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Out-the-Door Price Range"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Low Estimate:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",ea.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Expected (with your inputs):"}),(0,a.jsxs)("span",{className:"font-semibold text-blue-600",children:["$",ei.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"High Estimate:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",en.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[(0,a.jsx)("strong",{children:"⚠️ Validation Required:"})," This estimate includes tax based on the rate you provided. Tax rates are estimates only and may vary by state, locality, and vehicle type. Always verify the actual tax rate and final OTD price with your dealer before finalizing your purchase."]})]}),p&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dealer-Quoted OTD (optional)"}),(0,a.jsx)("input",{type:"number",value:ey,onChange:e=>ej(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Paste the OTD the dealer sent you (from email or worksheet)."})]}),ey&&parseFloat(ey)>0&&(()=>{let e=parseFloat(ey),t=null;return t=e<=en?{icon:"✅",color:"green",title:"Within expected range",nextStep:"Confirm everything in writing before agreeing."}:e>en&&e<=1.05*en?{icon:"⚠️",color:"yellow",title:"Slightly high — ask for itemized breakdown",nextStep:"Request a written itemized OTD breakdown and clarify optional add-ons."}:{icon:"❌",color:"red",title:"Inflated — add-ons/fees likely",nextStep:"Request a written itemized OTD breakdown and clarify optional add-ons."},(0,a.jsxs)("div",{className:"bg-white border-2 rounded-lg p-4 ".concat("green"===t.color?"border-green-300":"yellow"===t.color?"border-yellow-300":"border-red-300"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-xl",children:t.icon}),(0,a.jsx)("h4",{className:"font-semibold ".concat("green"===t.color?"text-green-900":"yellow"===t.color?"text-yellow-900":"text-red-900"),children:t.title})]}),(0,a.jsx)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Next step:"})," ",t.nextStep]})})]})})()]}),g&&(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Dealer vs Target"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dealer Current OTD"}),(0,a.jsx)("input",{type:"number",value:ex,onChange:e=>eh(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Target OTD"}),(0,a.jsx)("input",{type:"number",value:eg,onChange:e=>ep(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Walk-Away Ceiling"}),(0,a.jsx)("input",{type:"number",value:eb,onChange:e=>ef(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"})]})]}),(0,a.jsx)("div",{className:"bg-white border border-orange-300 rounded-lg p-4 mb-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Gap to Target:"}),(0,a.jsx)("span",{className:"ml-2 font-semibold text-gray-900",children:ex&&eg?(()=>{let e=parseFloat(ex)-parseFloat(eg);return e>=0?"+$".concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})):"-$".concat(Math.abs(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))})():"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Gap to Ceiling:"}),(0,a.jsx)("span",{className:"ml-2 font-semibold text-gray-900",children:ex&&eb?(()=>{let e=parseFloat(ex)-parseFloat(eb);return e>=0?"+$".concat(e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})):"-$".concat(Math.abs(e).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))})():"—"})]})]})}),ex&&eg&&(0,a.jsx)("div",{className:"bg-white border border-orange-300 rounded-lg p-3 mb-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-700",children:parseFloat(ex)-parseFloat(eg)>0?"You're above target. Don't agree until OTD is at or below your number.":"You're at/under target. Confirm the written OTD breakdown before signing."})}),(0,a.jsx)(n.Z,{type:"button",variant:"secondary",onClick:()=>u.push("/copilot/in-person/live"),className:"w-full",children:"Open Deal Decision Advisor"})]}),et.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"⚠️ Warnings"}),et.map((e,t)=>(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:e})},t))]}),p&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"\uD83D\uDCA1 First-Time Buyer Breakdown"}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"OTD Confidence"}),(()=>{let e=!!_&&parseFloat(_)>0,t=!!E&&!!$&&!!B,s=!!w&&parseFloat(w)>0,r=(null==A?void 0:A.confidence)||"low",i="Low",l="red",n="";return s&&e&&t&&"high"===r?(i="High",l="green",n="You have all the key inputs and a high-confidence tax rate. This OTD estimate is reliable for planning."):s&&e&&(t||"medium"===r)?(i="Medium",l="yellow",n="Most inputs are provided, but some fees may be estimates. Verify with the dealer for accuracy."):(i="Low",l="red",n="Some key inputs are missing or estimated. Get a written breakdown from the dealer to confirm."),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("span",{className:"text-lg font-bold ".concat("green"===l?"text-green-600":"yellow"===l?"text-yellow-600":"text-red-600"),children:"High"===i?"✓":"Medium"===i?"⚠":"✗"}),(0,a.jsx)("span",{className:"text-base font-semibold ".concat("green"===l?"text-green-700":"yellow"===l?"text-yellow-700":"text-red-700"),children:i})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:n})]})})()]}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"What Could Change This OTD"}),(0,a.jsx)("ul",{className:"space-y-1 text-sm text-gray-700",children:(()=>{let e=[];return A&&"high"===A.confidence||e.push("Tax rate may vary based on your exact registration location (ZIP code provides more accuracy)"),E&&$&&B||e.push("Actual dealer fees may differ from estimates (doc fee, title fee, registration fee)"),0===Q.length&&e.push("Dealer may add optional add-ons during negotiations (extended warranty, protection packages, etc.)"),0!==U.length||V||e.push("Additional dealer fees not yet disclosed (processing fees, dealer prep, etc.)"),0===e.length&&e.push("Dealer may adjust fees or add-ons during final negotiations"),e.slice(0,4).map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start",children:[(0,a.jsx)("span",{className:"text-yellow-600 mr-2",children:"•"}),(0,a.jsx)("span",{children:e})]},t))})()})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"One-Time Costs (Included in OTD)"}),(0,a.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[(0,a.jsx)("li",{children:"• Vehicle sale price"}),(0,a.jsx)("li",{children:"• Sales tax"}),(0,a.jsx)("li",{children:"• Documentation fee"}),(0,a.jsx)("li",{children:"• Title fee"}),(0,a.jsx)("li",{children:"• Initial registration"}),(0,a.jsx)("li",{children:"• Dealer add-ons (if any)"})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Recurring/Annual Costs (NOT in OTD)"}),(0,a.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[(0,a.jsx)("li",{children:"• Annual registration renewal"}),(0,a.jsx)("li",{children:"• City sticker (if applicable)"}),(0,a.jsx)("li",{children:"• County wheel tax (if applicable)"}),(0,a.jsx)("li",{children:"• Insurance (ongoing)"}),(0,a.jsx)("li",{children:"• Maintenance & repairs"})]})]})]}),y&&(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Location-Specific Reminders"}),(0,a.jsxs)("ul",{className:"space-y-1 text-sm text-gray-700",children:[["IL","NY","CA"].includes(y)&&(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"City sticker required:"})," Many cities in ",y," require an annual vehicle sticker ($50-$200/year). This is separate from state registration."]}),["WI","IL","IN"].includes(y)&&(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"County wheel tax:"})," Some counties charge an annual wheel tax ($20-$100/year). Check with your county clerk."]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Registration renewal:"})," You'll need to renew your registration annually (typically $50-$150/year depending on state)."]})]})]}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"OTD Sanity Check"}),(()=>{let e=parseFloat(w)||0,t=e>0?(ei-e)/e*100:0;return t<=8?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-green-700 font-medium mb-1",children:"✓ Aggressive but reasonable"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["Your OTD is ",t.toFixed(1),"% above the listed price, which is typical for taxes and fees. This looks realistic."]})]}):t<=15?(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-yellow-700 font-medium mb-1",children:"⚠️ Likely missing some costs"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["Your OTD is ",t.toFixed(1),"% above listed price. This might be missing dealer add-ons, higher fees, or local taxes. Ask the dealer for a complete breakdown."]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-red-700 font-medium mb-1",children:"⚠️ Significantly higher than listed"}),(0,a.jsxs)("p",{className:"text-xs text-gray-600",children:["Your OTD is ",t.toFixed(1),"% above listed price. This suggests inflated fees, add-ons, or missing information. Request a detailed itemization from the dealer."]})]})})()]}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Why Dealers Omit Certain Costs"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:"Dealers often advertise lower prices to attract buyers, then add costs later. This is normal, but as a first-time buyer, it's important to understand:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-xs text-gray-600",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Taxes:"})," Dealers can't include your exact tax rate until they know your registration location"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Fees:"})," Documentation and title fees vary by dealer and state - they're not included in the listed price"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Add-ons:"})," Extended warranties, protection packages, etc. are optional but often pushed during negotiations"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Local costs:"})," City stickers, county taxes, and other local fees are your responsibility, not the dealer's"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"What to Ask Dealer"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-start gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5"}),(0,a.jsx)("span",{children:"Request an itemized breakdown of all fees"})]}),(0,a.jsxs)("label",{className:"flex items-start gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5"}),(0,a.jsx)("span",{children:"Ask which add-ons are required vs. optional"})]}),(0,a.jsxs)("label",{className:"flex items-start gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5"}),(0,a.jsx)("span",{children:"Verify the tax rate matches your state and locality"})]}),(0,a.jsxs)("label",{className:"flex items-start gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5"}),(0,a.jsx)("span",{children:"Get the final OTD price in writing before committing"})]}),Q.some(e=>"inflated"===e.classification)&&(0,a.jsxs)("label",{className:"flex items-start gap-2 text-sm text-gray-700 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",className:"mt-0.5"}),(0,a.jsxs)("span",{children:["Negotiate removal of inflated add-ons: ",Q.filter(e=>"inflated"===e.classification).map(e=>e.name).join(", ")]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between mt-6 pt-6 border-t border-gray-200",children:[(0,a.jsx)(n.Z,{type:"button",variant:"secondary",onClick:()=>{"fees"===b?f("basics"):"addons"===b?f("fees"):"results"===b&&f("addons")},disabled:"basics"===b,children:"Back"}),"results"!==b?(0,a.jsx)(n.Z,{type:"button",onClick:()=>{if("basics"===b){if(!y||!w||!_){alert("Please fill in all required fields");return}f("fees")}else"fees"===b?f("addons"):"addons"===b&&eF()},children:"Next"}):(0,a.jsx)(n.Z,{type:"button",onClick:()=>f("basics"),children:"Start Over"})]})]})]})})}},4226:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{variant:t="primary",size:s="md",className:r="",children:i,...l}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500"}[t]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[s]," ").concat(r),...l,children:i})}s(2265)},9178:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(7437);function r(e){let{children:t,className:s=""}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 ".concat(s),children:t})}s(2265)},6281:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return o},a:function(){return c}});var a=s(7437),r=s(2265);let i=(0,s(9997).B)(),l=()=>{{let e="https://vabikejehdmpfcyqrgrs.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";return!!(e&&t&&e.length>10&&t.length>10&&!e.includes("placeholder"))}},n=(0,r.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!l()){console.warn("Supabase not configured. Running in unauthenticated mode."),o(null),d(!1);return}let e=!0,t=null;(async()=>{try{let{data:{session:s},error:a}=await i.auth.getSession();if(!e)return;if(a)console.error("[AuthContext] Error getting initial session:",a),o(null);else{var t;console.log("[AuthContext] Initial session:",s?"User: ".concat(s.user.email):"No session"),o(null!==(t=null==s?void 0:s.user)&&void 0!==t?t:null)}d(!1)}catch(t){if(!e)return;console.error("[AuthContext] Error initializing auth:",t),o(null),d(!1)}})();let{data:{subscription:s}}=i.auth.onAuthStateChange(async(t,s)=>{var a;e&&(console.log("[AuthContext] Auth state changed:",t,s?"User: ".concat(s.user.email):"No session"),o(null!==(a=null==s?void 0:s.user)&&void 0!==a?a:null),d(!1))});return t=s,()=>{e=!1,t&&t.unsubscribe()}},[]);let u=async()=>{l()&&await i.auth.signOut(),o(null)};return(0,a.jsx)(n.Provider,{value:{user:s,loading:c,signOut:u},children:t})}function c(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7116:function(e,t,s){"use strict";s.d(t,{HF:function(){return o},UW:function(){return l},addPack:function(){return n},wT:function(){return i}});let a="dealership_copilot_owned_packs";function r(){try{let e=localStorage.getItem(a);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t.ownedPacks)?t.ownedPacks:[]}catch(e){return[]}}function i(e){return r().includes(e)||l()}function l(){try{let e=localStorage.getItem(a);if(!e)return!1;let t=JSON.parse(e);return!0===t.allAccess}catch(e){return!1}}function n(e){try{let t=r();t.includes(e)||(t.push(e),localStorage.setItem(a,JSON.stringify({ownedPacks:t,allAccess:!1})))}catch(e){console.error("Error adding pack:",e)}}function o(){return{ownedPacks:r(),allAccess:l()}}},9997:function(e,t,s){"use strict";s.d(t,{B:function(){return l}});var a=s(4033);let r="https://vabikejehdmpfcyqrgrs.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!r||!i){let e=[];throw r||e.push("NEXT_PUBLIC_SUPABASE_URL"),i||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Missing required Supabase environment variables: ".concat(e.join(", "),". ")+"These must be set in Vercel environment variables and available at build time.")}if(r.includes("placeholder")||i.includes("placeholder")){let e=[];throw r.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_URL"),i.includes("placeholder")&&e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables. "+"Found placeholder in: ".concat(e.join(" and ")))}if(r.length<10||i.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function l(){return(0,a.createBrowserClient)(r,i)}},6137:function(e,t,s){"use strict";function a(e){if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:Math.abs(e);if("string"==typeof e){let t=parseFloat(e.replace(/[$,\s]/g,""));return isNaN(t)||!isFinite(t)?0:Math.abs(t)}return 0}function r(e,t){var s,a;let r=null!==(s=null==t?void 0:t.maxPercent)&&void 0!==s?s:15,i=null!==(a=null==t?void 0:t.minPercent)&&void 0!==a?a:0;if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:e>1?Math.max(i/100,Math.min(r/100,e/100)):Math.max(i/100,Math.min(r/100,Math.abs(e)));if("string"==typeof e){let t=parseFloat(e.trim().replace(/%/g,""));return isNaN(t)||!isFinite(t)?0:e.includes("%")||t>1?Math.max(i/100,Math.min(r/100,t/100)):Math.max(i/100,Math.min(r/100,Math.abs(t)))}return 0}function i(e){var t,s,i,l,n;let o=[],c=a(e.vehiclePrice),d=r(e.taxRateDecimal),u=a(null!==(t=e.docFee)&&void 0!==t?t:0),m=a(null!==(s=e.registrationFee)&&void 0!==s?s:0),x=a(null!==(i=e.titleFee)&&void 0!==i?i:0),h=a(null!==(l=e.otherFees)&&void 0!==l?l:0),g=a(null!==(n=e.addOns)&&void 0!==n?n:0);c<=0&&o.push("Vehicle price must be greater than 0"),c>1e6&&o.push("Vehicle price seems unusually high (>$1M). Please verify."),(d<0||d>.15)&&o.push("Tax rate ".concat((100*d).toFixed(2),"% is outside normal range (0-15%). Please verify."));let p=c*d,b=u+m+x+h,f=c+p+b+g;return f>1.5*c&&o.push("OTD ($".concat(f.toLocaleString(),") is more than 50% above vehicle price ($").concat(c.toLocaleString(),"). Please check fees and tax rate.")),f<c&&o.push("OTD ($".concat(f.toLocaleString(),") is less than vehicle price ($").concat(c.toLocaleString(),"). This is unusual.")),(isNaN(f)||!isFinite(f))&&o.push("OTD calculation resulted in invalid number. Please check all inputs."),{vehiclePrice:c,taxRateDecimal:d,taxAmount:p,fees:b,addOns:g,otd:Math.round(100*f)/100,issues:o}}function l(e){var t,s,a,r,l,n,o,c,d,u,m,x,h,g,p,b,f,y;let j=[],v=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:null!==(o=null===(t=e.docFee)||void 0===t?void 0:t.low)&&void 0!==o?o:0,registrationFee:null!==(c=null===(s=e.registrationFee)||void 0===s?void 0:s.low)&&void 0!==c?c:0,titleFee:null!==(d=null===(a=e.titleFee)||void 0===a?void 0:a.low)&&void 0!==d?d:0,otherFees:null!==(u=e.otherFees)&&void 0!==u?u:0,addOns:null!==(m=e.addOns)&&void 0!==m?m:0}),N=e.docFee?(e.docFee.low+e.docFee.high)/2:0,w=e.registrationFee?(e.registrationFee.low+e.registrationFee.high)/2:0,F=e.titleFee?(e.titleFee.low+e.titleFee.high)/2:0,S=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:N,registrationFee:w,titleFee:F,otherFees:null!==(x=e.otherFees)&&void 0!==x?x:0,addOns:null!==(h=e.addOns)&&void 0!==h?h:0}),k=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:null!==(g=null===(r=e.docFee)||void 0===r?void 0:r.high)&&void 0!==g?g:0,registrationFee:null!==(p=null===(l=e.registrationFee)||void 0===l?void 0:l.high)&&void 0!==p?p:0,titleFee:null!==(b=null===(n=e.titleFee)||void 0===n?void 0:n.high)&&void 0!==b?b:0,otherFees:null!==(f=e.otherFees)&&void 0!==f?f:0,addOns:null!==(y=e.addOns)&&void 0!==y?y:0});return j.push(...v.issues,...S.issues,...k.issues),k.otd<v.otd&&j.push("High OTD estimate is less than low estimate. Please check fee ranges."),(S.otd<v.otd||S.otd>k.otd)&&j.push("Expected OTD is outside the low-high range. Please check calculations."),S.otd,S.otd,{low:v.otd,expected:S.otd,high:k.otd,issues:[...new Set(j)]}}s.r(t),s.d(t,{calculateOTD:function(){return i},calculateOTDRange:function(){return l},parseMoney:function(){return a},parsePercentToDecimal:function(){return r}})},911:function(e,t,s){"use strict";s.d(t,{R4:function(){return r}});let a={AL:2,AK:0,AZ:5.6,AR:6.5,CA:7.25,CO:2.9,CT:6.35,DE:0,FL:6,GA:4,HI:4.17,ID:6,IL:6.25,IN:7,IA:6,KS:6.5,KY:6,LA:4.45,ME:5.5,MD:6,MA:6.25,MI:6,MN:6.875,MS:5,MO:4.225,MT:0,NE:5.5,NV:6.85,NH:0,NJ:6.625,NM:5.125,NY:4,NC:4.75,ND:5,OH:5.75,OK:4.5,OR:0,PA:6,RI:7,SC:6,SD:4.5,TN:7,TX:6.25,UT:4.85,VT:6,VA:4.3,WA:6.5,WV:6,WI:5,WY:4,DC:6};function r(e){var t;return null!==(t=a[e.toUpperCase().trim()])&&void 0!==t?t:null}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[33,971,117,744],function(){return e(e.s=7455)}),_N_E=e.O()}]);