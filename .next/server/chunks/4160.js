"use strict";exports.id=4160,exports.ids=[4160,8798],exports.modules={84160:(e,t,s)=>{s.d(t,{Z:()=>C});var a=s(10326),r=s(17577),i=s(35047),l=s(33136),n=s(8903),o=s(3679),d=s(21021),c=s(17129),m=s(36283),h=s(61584),x=s(78798),u=s(87466);function g({packId:e,children:t,fallback:s,showUpgrade:r=!0}){let l=(0,i.useRouter)(),n=u.l[e];return(0,x.wT)(e)||(0,x.UW)()?a.jsx(a.Fragment,{children:t}):s?a.jsx(a.Fragment,{children:s}):a.jsx(d.Z,{className:"p-6 border-2 border-gray-300 bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"mb-4",children:a.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:[n?.name||"Premium Feature"," Locked"]}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:n?.description||"This feature requires a pack to unlock."}),n?.features&&(0,a.jsxs)("div",{className:"mb-4 text-left",children:[a.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"This pack includes:"}),a.jsx("ul",{className:"list-disc list-inside space-y-1 text-xs text-gray-600",children:n.features.slice(0,3).map((e,t)=>a.jsx("li",{children:e},t))})]}),r&&(0,a.jsxs)(o.Z,{onClick:()=>l.push("/packs"),className:"w-full",children:["Unlock ",n?.name||"Pack"]})]})})}var p=s(64777),b=s(58690),y=s(77506),f=s(69436);let v=["What does APR actually mean?","What's included in OTD?","Can dealers remove add-ons?","Is this a good deal for me?","Should I finance or pay cash?","Which fees are negotiable?"];function j({listingUrl:e,context:t}){let[s,i]=(0,r.useState)([]),[l,n]=(0,r.useState)(""),[c,m]=(0,r.useState)(!1),[h,x]=(0,r.useState)(null),u=(0,r.useRef)(null),g=(0,r.useRef)(null),p=async e=>{let a=e||l.trim();if(!a||c)return;let r={role:"user",content:a,timestamp:Date.now()};i(e=>[...e,r]),n(""),x(null),m(!0),setTimeout(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},50);let o=Date.now();i(e=>[...e,{role:"assistant",content:"",timestamp:o}]);try{let e=await fetch("/api/advisor/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...s,r].map(e=>({role:e.role,content:e.content})),context:t,mode:"first_time_listing"})});if(!e.ok)throw Error(`Failed: ${e.status}`);let a=e.body?.getReader(),l=new TextDecoder;if(!a)throw Error("No response body");let n="",o="";for(;;){let{done:e,value:t}=await a.read();if(e)break;let s=(o+=l.decode(t,{stream:!0})).split("\n");for(let e of(o=s.pop()||"",s))if(""!==e.trim()&&e.startsWith("data: ")){let t=e.slice(6).trim();if("[DONE]"===t)continue;try{let e=JSON.parse(t);e.content&&(n+=e.content,i(e=>{let t=[...e],s=t.length-1;return t[s]?.role==="assistant"&&(t[s]={...t[s],content:n}),t}),g.current&&(g.current.scrollTop=g.current.scrollHeight))}catch(e){}}}if(o.trim()){let e=o.replace("data: ","").trim();if(e&&"[DONE]"!==e)try{let t=JSON.parse(e);t.content&&(n+=t.content)}catch(e){}}i(e=>{let t=[...e],s=t.length-1;return t[s]?.role==="assistant"&&(t[s]={...t[s],content:n}),t})}catch(e){x(e.message||"Failed to get response"),i(e=>e.slice(0,-1))}finally{m(!1)}},b=e=>{n(e),p(e)};return(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-blue-50 border-blue-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"First-Time Buyer Advisor"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-4",children:["Ask me anything about this car deal.",a.jsx("br",{}),"I'll explain fees, financing, and dealer tactics — including the things salespeople usually don't say out loud."]}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("p",{className:"text-xs text-gray-600 mb-2 font-medium",children:"Popular questions to get started:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(e=>a.jsx("button",{onClick:()=>b(e),disabled:c,className:"px-3 py-1.5 text-xs bg-white border border-gray-300 hover:bg-gray-50 hover:border-primary rounded-full text-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e},e))})]}),a.jsx("div",{ref:g,className:"bg-white rounded-lg border border-gray-200 p-4 mb-4 h-96 overflow-y-auto scroll-smooth",style:{scrollBehavior:"smooth"},children:0===s.length?a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:a.jsx("p",{className:"text-gray-500 mb-4",children:"Start a conversation by asking a question or clicking one above"})}):(0,a.jsxs)("div",{className:"space-y-4",children:[s.map((e,t)=>"user"===e.role&&e.content?a.jsx("div",{className:"flex justify-end",children:a.jsx("div",{className:"max-w-[80%] rounded-lg p-3 text-white",style:{backgroundColor:"#2563EB"},children:a.jsx("p",{className:"text-sm whitespace-pre-wrap text-white",children:e.content})})},`${e.timestamp}-${t}`):"assistant"===e.role&&e.content?a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"max-w-[80%] rounded-lg p-3 bg-gray-100 text-gray-900",children:a.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.content})})},`${e.timestamp}-${t}`):null),c&&s.length>0&&s[s.length-1]?.content===""&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"bg-gray-100 rounded-lg p-3",children:a.jsx(y.Z,{className:"w-4 h-4 animate-spin text-gray-500"})})}),a.jsx("div",{ref:u})]})}),h&&a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:a.jsx("p",{className:"text-sm text-red-700",children:h})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("textarea",{value:l,onChange:e=>n(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),p())},placeholder:"Ask a question...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none",rows:2,disabled:c}),a.jsx(o.Z,{onClick:()=>p(),disabled:c||!l.trim(),className:"px-6",children:c?a.jsx(y.Z,{className:"w-4 h-4 animate-spin"}):a.jsx(f.Z,{className:"w-4 h-4"})})]})]})}function N({dealPlan:e,listingUrl:t,onAddToComparison:l,diagnostics:n,variant:c="free"}){let m=(0,i.useRouter)(),[h,u]=(0,r.useState)(!1),[y,f]=(0,r.useState)(e.otdEstimate.assumptions),[v,N]=(0,r.useState)(e.otdEstimate.expectedOTD),[w,k]=(0,r.useState)(!1),[C,T]=(0,r.useState)(""),[D,P]=(0,r.useState)(""),[S,$]=(0,r.useState)(""),[F,O]=(0,r.useState)(""),[A,R]=(0,r.useState)(null),L=e=>{navigator.clipboard.writeText(e)},_=t=>{let s=e.nextMoves.copilotLink,a=(0,b.M)("first_time"===c?"first_time":"in_person"===c?"in_person":null,M,I),r="free"===c?"_free":"first_time"===c?"_first_time":"_in_person",i=null!==A?A.toString():s.desiredOTD;localStorage.setItem(`copilot_vehicle_price${r}`,s.vehiclePrice),localStorage.setItem(`copilot_desired_otd${r}`,i),localStorage.setItem(`copilot_car_context${r}`,s.carContext);let l=e.otdEstimate?.assumptions?.registrationState||e.nextMoves.otdBuilderLink?.state;l&&(localStorage.setItem(`copilot_state${r}`,l),console.log("Copilot: Setting state:",l)),t&&localStorage.setItem(`copilot_prefilled_message${r}`,t),m.push(`${a}?stage=${s.stage}&goal=${s.goal}`)},{hasFirstTime:I,hasInPerson:M}=(0,p.m)();return(0,x.wT)("cash")||(0,x.UW)(),(0,x.wT)("financing")||(0,x.UW)(),(0,a.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,a.jsxs)("div",{children:["first_time"===c?(0,a.jsxs)(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Deal Readiness Assessment"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Expert review before you contact the dealer."}),(()=>{let t=!!e.otdEstimate?.expectedOTD,s=e.otdEstimate?.assumptions?.docFee?.value!==void 0,r=(e.targets.askingPrice-e.targets.estimatedFairPrice)/e.targets.estimatedFairPrice*100,i=e.leverage.points.some(e=>"low"===e.strength&&e.score<30),l=e.otdEstimate?.assumptions?.taxRate?.confidence!=="high",n="ready";!t||r>20?n="not-ready":(!s||l||r>10||i)&&(n="caution");let o={ready:{icon:"✅",title:"Ready to proceed (in writing)",bgColor:"bg-green-50",borderColor:"border-green-300",textColor:"text-green-900",iconColor:"text-green-600"},caution:{icon:"⚠️",title:"Proceed with caution",bgColor:"bg-amber-50",borderColor:"border-amber-300",textColor:"text-amber-900",iconColor:"text-amber-600"},"not-ready":{icon:"❌",title:"Not ready — missing critical info",bgColor:"bg-red-50",borderColor:"border-red-300",textColor:"text-red-900",iconColor:"text-red-600"}}[n];return a.jsx("div",{className:`${o.bgColor} ${o.borderColor} border-2 rounded-lg p-4 mb-6 shadow-sm`,children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:`text-2xl ${o.iconColor}`,children:o.icon}),a.jsx("h3",{className:`text-lg font-bold ${o.textColor}`,children:o.title})]})})})(),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-blue-50 border-blue-200","data-templates-section":!0,children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"If you proceed, send this (written only)"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Request written OTD breakdown"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[a.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap mb-3",children:"Hi — I'm interested in this vehicle. Before discussing next steps, can you email me the full out-the-door price breakdown including sale price, taxes, doc fee, title/registration, and any add-ons? I want to review the complete OTD in writing."}),a.jsx("button",{onClick:()=>{L("Hi — I'm interested in this vehicle. Before discussing next steps, can you email me the full out-the-door price breakdown including sale price, taxes, doc fee, title/registration, and any add-ons? I want to review the complete OTD in writing.")},className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"\uD83D\uDCCB Copy"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Clarify add-ons (optional vs mandatory)"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[a.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap mb-3",children:"Thanks. Can you confirm which line items are optional vs required by law? If any add-ons are dealer policy, please itemize them and send an updated out-the-door breakdown in writing without optional items so I can compare."}),a.jsx("button",{onClick:()=>{L("Thanks. Can you confirm which line items are optional vs required by law? If any add-ons are dealer policy, please itemize them and send an updated out-the-door breakdown in writing without optional items so I can compare.")},className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"\uD83D\uDCCB Copy"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Pause to review"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[a.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap mb-3",children:"Appreciate it — I'm going to review the written out-the-door breakdown and compare options. I'll follow up once I've looked everything over."}),a.jsx("button",{onClick:()=>{L("Appreciate it — I'm going to review the written out-the-door breakdown and compare options. I'll follow up once I've looked everything over.")},className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"\uD83D\uDCCB Copy"})]})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Deal Plan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Your complete negotiation strategy for this listing"})]}),"in_person"===c&&M&&(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-300 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("svg",{className:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Dealer Leverage Snapshot"}),a.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold text-orange-700 bg-orange-200 border border-orange-300 rounded-md",children:"In-Person Pack"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide",children:"Likely Dealer Moves"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-orange-600 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Payment push:"})," Redirect to monthly payments to hide total cost"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-orange-600 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Add-ons:"}),' Frame extras as "mandatory" or "recommended"']})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-orange-600 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Urgency:"}),' "Someone else is interested" or "Price goes up tomorrow"']})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-orange-600 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Delay OTD:"})," Avoid giving written breakdown until you're committed"]})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide",children:"Where You Have Leverage"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[e.targets.askingPrice>e.targets.estimatedFairPrice&&(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"✓"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Price vs market:"})," Asking $",e.targets.askingPrice.toLocaleString()," vs fair $",e.targets.estimatedFairPrice.toLocaleString()," ($",(e.targets.askingPrice-e.targets.estimatedFairPrice).toLocaleString()," above)"]})]}),e.leverage.points.some(e=>"high"===e.strength)&&(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"✓"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Comparable vehicles:"})," Use market data to anchor your offer"]})]}),e.leverage.marketCondition&&(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"✓"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Market conditions:"})," ",e.leverage.marketCondition]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"✓"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Time on lot:"})," Longer = more negotiating room (if available)"]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2 text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"✓"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Inventory signals:"})," High inventory = dealer needs to move units"]})]})]})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-orange-200",children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wide",children:"Walk-In Plan"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"OTD-First Rules"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Only discuss total out-the-door price. No monthly payment talk."})]}),(0,a.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Silence Tactic"}),a.jsx("p",{className:"text-xs text-gray-600",children:"After stating your number, pause. Let them respond first."})]}),(0,a.jsxs)("div",{className:"bg-white border border-orange-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:"Request in Writing"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Get full OTD breakdown in writing before negotiating further."})]})]})]})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"1. Bottom-Line Targets"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Asking Price"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["$",e.targets.askingPrice.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Estimated Fair Price ",a.jsx("span",{className:"text-xs",children:"(est.)"})]}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["$",e.targets.estimatedFairPrice.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Strong Opening Offer"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",e.targets.strongOpeningOffer.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:'"Acceptable Deal" Price'}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-indigo-600",children:["$",e.targets.acceptableDealPrice.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Walk-Away OTD Ceiling"}),(0,a.jsxs)("p",{className:"text-xl font-semibold text-red-600",children:["$",e.targets.walkAwayOTDCeiling.toLocaleString()]})]})]}),e.targets.percentRange&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-3",children:["Range: ",e.targets.percentRange,e.targets.estimationMethod&&a.jsx("span",{className:"ml-2",title:e.targets.estimationMethod,children:"ℹ️"})]})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"2. Dealer Leverage Assessment"}),a.jsx("div",{className:"space-y-3 mb-4",children:e.leverage.points.map((e,t)=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[a.jsx("p",{className:"font-medium text-gray-900",children:e.factor}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:`h-2 rounded-full ${e.score>=70?"bg-green-500":e.score>=40?"bg-yellow-500":"bg-gray-400"}`,style:{width:`${e.score}%`}})}),(0,a.jsxs)("span",{className:"text-xs font-semibold text-gray-600 w-8",children:[e.score,"/100"]}),a.jsx("span",{className:`text-xs font-semibold px-2 py-1 rounded ${"high"===e.strength?"bg-green-100 text-green-700":"medium"===e.strength?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:e.strength.toUpperCase()})]})]}),a.jsx("p",{className:"text-sm text-gray-600",children:e.explanation})]},t))}),e.leverage.bestAngles&&e.leverage.bestAngles.length>0&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Best leverage angles:"}),a.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-blue-700",children:e.leverage.bestAngles.map((e,t)=>a.jsx("li",{children:e},t))})]})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"3. Expected OTD Reality Check"}),(0,a.jsxs)(o.Z,{size:"sm",variant:"secondary",onClick:()=>u(!h),children:[h?"Hide":"Edit"," Assumptions"]})]}),h&&a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4 space-y-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tax Rate Information"}),(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[void 0!==y.taxRate.stateBaseRate&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"State Base Rate:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[y.taxRate.stateBaseRate.toFixed(2),"%"]})]}),void 0!==y.taxRate.estimatedLocalAddOn&&y.taxRate.estimatedLocalAddOn>0&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Estimated Local Add-on:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["+",y.taxRate.estimatedLocalAddOn.toFixed(2),"%"]})]}),void 0!==y.taxRate.combinedRate?(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Combined Rate:"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[y.taxRate.combinedRate.toFixed(2),"%"]})]}):y.taxRate.combinedRateRange&&(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-200",children:[a.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Combined Rate Range:"}),(0,a.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[y.taxRate.combinedRateRange.low.toFixed(2),"% - ",y.taxRate.combinedRateRange.high.toFixed(2),"%"]})]}),y.taxRate.confidence&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Confidence:"}),a.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${"high"===y.taxRate.confidence?"bg-green-100 text-green-700":"medium"===y.taxRate.confidence?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:y.taxRate.confidence.toUpperCase()})]}),y.taxRate.source&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Source:"}),a.jsx("span",{className:"text-xs text-gray-500 capitalize",children:y.taxRate.source.replace(/_/g," ")})]})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Override Tax Rate (%) ",a.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"(optional)"})]}),a.jsx("input",{type:"number",step:"0.01",value:y.taxRate.value||"",onChange:e=>f({...y,taxRate:{...y.taxRate,value:e.target.value?parseFloat(e.target.value):void 0}}),placeholder:y.taxRate.combinedRate?.toFixed(2)||`${y.taxRate.range.low.toFixed(2)}-${y.taxRate.range.high.toFixed(2)}`,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"})]}),y.taxRate.disclaimer&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[a.jsx("strong",{children:"Note:"})," ",y.taxRate.disclaimer]}),(0,a.jsxs)("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[a.jsx("strong",{children:"⚠️ Validation Required:"})," Tax rates are estimates only. Vehicle tax rules vary by state and locality, and may differ from general sales tax. ZIP-based estimates can be imperfect. Always verify the actual tax rate with your dealer or state DMV before finalizing your purchase."]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Doc Fee ($) ",y.docFee.value?"":`($${y.docFee.range.low}-$${y.docFee.range.high} range)`]}),a.jsx("input",{type:"number",value:y.docFee.value||"",onChange:e=>f({...y,docFee:{...y.docFee,value:e.target.value?parseFloat(e.target.value):void 0}}),placeholder:y.docFee.range.low.toString(),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Registration/Title ($) ",y.registrationTitle.value?"":`($${y.registrationTitle.range.low}-$${y.registrationTitle.range.high} range)`]}),a.jsx("input",{type:"number",value:y.registrationTitle.value||"",onChange:e=>f({...y,registrationTitle:{...y.registrationTitle,value:e.target.value?parseFloat(e.target.value):void 0}}),placeholder:y.registrationTitle.range.low.toString(),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Dealer Add-Ons ($) ",y.dealerAddOns.value?"":`($${y.dealerAddOns.riskBand.low}-$${y.dealerAddOns.riskBand.high} risk band)`]}),a.jsx("input",{type:"number",value:y.dealerAddOns.value,onChange:e=>f({...y,dealerAddOns:{...y.dealerAddOns,value:parseFloat(e.target.value)||0}}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Low Estimate"}),(0,a.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["$",v.low.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border-2 border-blue-300",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Expected OTD"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:["$",v.expected.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"High Estimate"}),(0,a.jsxs)("p",{className:"text-xl font-semibold text-gray-900",children:["$",v.high.toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:[a.jsx("strong",{children:"⚠️ Validation Required:"})," This OTD estimate includes tax based on estimated rates. Tax rates are estimates only and may vary by state, locality, and vehicle type. Always verify the actual tax rate and final OTD price with your dealer before finalizing your purchase."]}),(()=>{let{parseMoney:t}=s(19926),r=t(e.otdEstimate.expectedOTD.expected),i=t(e.otdEstimate.warningThreshold);return i>=.7*r&&i<=1.3*r?a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:(0,a.jsxs)("p",{className:"text-sm font-medium text-yellow-800 mb-1",children:["⚠️ OTD Warning Threshold: If OTD > $",i.toLocaleString(),", fees/add-ons are inflated"]})}):a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3",children:a.jsx("p",{className:"text-sm text-yellow-800",children:"⚠️ Warning threshold seems inconsistent with OTD estimate. Please check assumptions."})})})(),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Checklist:"}),a.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700",children:e.otdEstimate.checklist.map((e,t)=>a.jsx("li",{children:e},t))})]})]}),"first_time"===c&&I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-yellow-50 border-yellow-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCA1 First-Time Buyer Guide"}),(0,a.jsxs)("div",{className:"mb-4",children:[a.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"Hidden Costs to Expect"}),a.jsx("div",{className:"space-y-2",children:(()=>{let t=e.otdEstimate?.assumptions?.registrationState||"",s=[];return["IL","NY","CA"].includes(t)&&s.push({name:"City Sticker / Vehicle Registration Sticker",amount:"$50-$200",explanation:"Many cities require an annual vehicle sticker. This is separate from state registration and often surprises first-time buyers."}),["WI","IL","IN"].includes(t)&&s.push({name:"County Wheel Tax",amount:"$20-$100",explanation:"Some counties charge an annual wheel tax per vehicle. This is a recurring cost, not a one-time fee."}),s.push({name:"Registration & Plate Fees",amount:"$50-$300",explanation:"State registration and plate fees vary. Some states charge based on vehicle value, others have flat fees. First-time buyers often don't realize this is separate from the sale price."}),s.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[a.jsx("span",{className:"font-medium text-gray-900",children:e.name}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:e.amount})]}),a.jsx("p",{className:"text-xs text-gray-600 italic",children:e.explanation})]},t))})()})]}),(0,a.jsxs)("div",{className:"bg-white border border-yellow-300 rounded-lg p-4 mb-4",children:[a.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:"What This Price Likely Excludes"}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:["The listed price typically does ",a.jsx("strong",{children:"not"})," include:"]}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700 mb-3",children:[(0,a.jsxs)("li",{children:[a.jsx("strong",{children:"Documentation fees"})," ($150-$500) - Dealers charge this for processing paperwork"]}),(0,a.jsxs)("li",{children:[a.jsx("strong",{children:"Dealer add-ons"})," - Extended warranties, paint protection, fabric protection, etc. (often $1,000-$3,000+)"]}),(0,a.jsxs)("li",{children:[a.jsx("strong",{children:"Taxes"})," - Sales tax based on your registration location (typically 6-10% of sale price)"]}),(0,a.jsxs)("li",{children:[a.jsx("strong",{children:"Title & registration fees"})," - State and local fees ($50-$300)"]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 italic",children:["\uD83D\uDCA1 ",a.jsx("strong",{children:"Why dealers do this:"}),' Lower advertised prices attract more buyers. They\'ll add these costs later during negotiations. Always ask for a written "Out-the-Door" (OTD) price that includes everything.']})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-300 rounded-lg p-4 mb-4",children:[a.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"First-Time Buyer Education"}),a.jsx("p",{className:"text-xs text-gray-600 mb-3 italic",children:"These concepts are explained contextually as you use the Advisor and OTD Builder—learn as you go!"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-white border border-blue-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-1 text-sm",children:"OTD vs Monthly Payment"}),(0,a.jsxs)("p",{className:"text-xs text-gray-700",children:[a.jsx("strong",{children:"OTD (Out-the-Door)"})," is your total cost including all fees, taxes, and add-ons. ",a.jsx("strong",{children:"Monthly payment"})," only shows your loan payment, which dealers can manipulate by extending the loan term. Always negotiate OTD first—it's the only number that matters for comparing deals."]})]}),(0,a.jsxs)("div",{className:"bg-white border border-blue-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-1 text-sm",children:"APR & Loan Term"}),(0,a.jsxs)("p",{className:"text-xs text-gray-700",children:[a.jsx("strong",{children:"APR (Annual Percentage Rate)"})," is your interest rate. ",a.jsx("strong",{children:"Loan term"})," is how long you'll pay (36, 48, 60 months, etc.). A lower monthly payment from a longer term costs more in total interest. Always compare total cost, not just monthly payment."]})]})]})]}),(0,a.jsxs)("div",{className:"bg-slate-50 border border-slate-300 rounded-lg p-4",children:[a.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:"\uD83D\uDEE1 Insurance — What First-Time Buyers Should Know"}),(0,a.jsxs)("div",{className:"space-y-3 mb-4",children:[a.jsx("p",{className:"text-sm text-gray-700",children:"Most dealerships require proof of active insurance before you can drive the vehicle off the lot. This is standard practice, not a negotiation tactic. Getting an insurance quote before visiting helps you understand the full cost of ownership and prevents last-minute surprises."}),a.jsx("p",{className:"text-sm text-gray-700",children:"Many dealer-offered protection products overlap with what your insurance may already cover. For example, tire and wheel protection, windshield coverage, and some extended warranties may duplicate coverage you already have. Always ask what's included, compare it to your existing insurance, and verify before agreeing to add-ons."}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Common Dealer Add-Ons (Often Optional)"}),(0,a.jsxs)("ul",{className:"space-y-1.5 text-sm text-gray-700",children:[(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-slate-600 mr-2 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"GAP insurance"})," — Covers the difference if your car is totaled and worth less than you owe. Check if your insurance or loan already includes this."]})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-slate-600 mr-2 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Tire & wheel protection"})," — May overlap with your insurance's comprehensive coverage. Ask what's covered and compare."]})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-slate-600 mr-2 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Windshield protection"})," — Many insurance policies already cover windshield replacement. Verify your coverage first."]})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-slate-600 mr-2 mt-0.5",children:"•"}),(0,a.jsxs)("span",{children:[a.jsx("strong",{children:"Extended warranties"})," — Optional service contracts. Review what's covered, compare to manufacturer warranty, and consider your repair comfort level."]})]})]})]}),(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs font-semibold text-green-900 mb-1",children:"\uD83D\uDCA1 Smart First-Time Buyer Tip"}),a.jsx("p",{className:"text-xs text-green-800",children:'Get an insurance quote before visiting the dealership. This helps you budget for the full cost of ownership and gives you leverage when dealers offer protection products. You can always say, "I already have coverage for that" if your insurance overlaps.'})]}),(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-3",children:[a.jsx("h5",{className:"font-semibold text-gray-900 mb-2 text-sm",children:"Before You Visit — Insurance Checklist"}),(0,a.jsxs)("ul",{className:"space-y-1.5 text-sm text-gray-700",children:[(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-green-600 mr-2 mt-0.5",children:"✓"}),a.jsx("span",{children:"Get an insurance quote for the specific vehicle (VIN helps)"})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-green-600 mr-2 mt-0.5",children:"✓"}),a.jsx("span",{children:"Review your current policy to see what's already covered"})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-green-600 mr-2 mt-0.5",children:"✓"}),a.jsx("span",{children:"Ask dealers which add-ons are optional vs mandatory"})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-green-600 mr-2 mt-0.5",children:"✓"}),a.jsx("span",{children:"Compare dealer protection products to your insurance coverage"})]}),(0,a.jsxs)("li",{className:"flex items-start",children:[a.jsx("span",{className:"text-green-600 mr-2 mt-0.5",children:"✓"}),a.jsx("span",{children:"Verify the final OTD price includes only what you want"})]})]})]})]}),a.jsx("p",{className:"text-xs text-gray-600 italic border-t border-slate-200 pt-3 mt-3",children:"Remember: Ask, compare, verify. Understanding your insurance coverage helps you make informed decisions about dealer add-ons and reinforces the importance of getting a clear OTD price before finalizing."})]})]}),"first_time"===c&&(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-red-50 border-red-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"⚠️ Common First-Time Buyer Mistakes"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Mistakes that cost first-time buyers money on deals like this one:"}),a.jsx("div",{className:"space-y-3",children:(()=>{let t=[],s=!!e.otdEstimate?.expectedOTD,r=e.targets.askingPrice-e.targets.estimatedFairPrice;return e.otdEstimate?.assumptions?.registrationState,s||t.push({mistake:"Negotiating without a written Out-the-Door (OTD) price",why:"First-time buyers focus on the monthly payment or sale price, not realizing dealers add thousands in fees later.",cost:"$500-$2,000+ in surprise fees",fix:"Always ask for a written itemized OTD quote before negotiating further."}),t.push({mistake:"Negotiating based on monthly payment instead of total cost",why:"Dealers can make any monthly payment work by extending the loan term, which costs you more in total interest.",cost:"$1,000-$3,000+ in extra interest over the loan term",fix:"Negotiate the total OTD price first, then discuss financing separately."}),t.push({mistake:'Accepting "mandatory" dealer add-ons without questioning',why:"First-time buyers assume everything the dealer says is required, but many add-ons are optional or negotiable.",cost:"$1,000-$3,000+ in unnecessary add-ons",fix:"Ask which add-ons are truly mandatory by law vs. dealer policy, and negotiate to remove optional ones."}),r>1e3&&t.push({mistake:`Paying ${Math.round(r/e.targets.estimatedFairPrice*100)}% above estimated fair market value`,why:'First-time buyers don\'t research comparable prices and accept the first "good deal" they see.',cost:`$${r.toLocaleString()}+ over fair value`,fix:`Use the estimated fair price ($${e.targets.estimatedFairPrice.toLocaleString()}) as your negotiation anchor, not the asking price.`}),t.push({mistake:"Not verifying tax rate and registration fees before finalizing",why:"First-time buyers assume the dealer calculates taxes correctly, but mistakes happen and you pay for them.",cost:"$200-$800+ in overcharged taxes or fees",fix:"Verify your state and local tax rate independently, and ask for a breakdown of all registration fees."}),t.push({mistake:'Feeling pressured by "today only" pricing and rushing the decision',why:'First-time buyers fear missing out on a "deal" and skip due diligence like getting a second opinion or sleeping on it.',cost:"$500-$2,000+ in missed negotiation leverage and buyer's remorse",fix:"Take time to review the written OTD, compare with other dealers, and never let urgency override careful decision-making."}),t.slice(0,6).map((e,t)=>(0,a.jsxs)("div",{className:"bg-white border border-red-300 rounded-lg p-4",children:[a.jsx("h5",{className:"font-semibold text-red-900 mb-2",children:e.mistake}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[a.jsx("strong",{className:"text-gray-900",children:"Why first-time buyers make it:"})," ",e.why]}),(0,a.jsxs)("p",{className:"text-red-700",children:[a.jsx("strong",{className:"text-red-900",children:"What it usually costs:"})," ",e.cost]}),(0,a.jsxs)("p",{className:"text-green-700",children:[a.jsx("strong",{className:"text-green-900",children:"What to do instead:"})," ",e.fix]})]})]},t))})()})]}),(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Deal Confidence Meter"}),(()=>{let t=!!e.otdEstimate?.expectedOTD,s=e.otdEstimate?.assumptions?.docFee?.value!==void 0,r=(e.targets.askingPrice-e.targets.estimatedFairPrice)/e.targets.estimatedFairPrice*100,i=e.leverage.points.some(e=>"low"===e.strength&&e.score<30),l="high",n="High Confidence",o="",d="",c="",m=null,h=[];t||(h.push("No written OTD provided"),l="risk"),s||(h.push("Fee breakdown unclear"),"risk"===l||(l="caution")),r>10&&(h.push(`Price ${Math.round(r)}% above estimated fair value`),"high"===l&&(l="caution"),r>20&&(l="risk")),i&&(h.push("Dealer behavior signals raise concerns"),"high"===l&&(l="caution")),"high"===l?(n="High Confidence",o="You have the transparency and pricing clarity needed to make an informed decision.",d="You can proceed with confidence, but still verify the final OTD matches your expectations.",c="See what to verify before proceeding",m=()=>{let e=document.getElementById("first-time-verification-checklist");e?.scrollIntoView({behavior:"smooth",block:"start"})}):"caution"===l?(n="Proceed with Caution",o="Some important details are unclear, which could lead to surprise costs or unfavorable terms.",d="Get clarification on the unclear items before moving forward with negotiations.",c="Ask the Advisor what to clarify",m=()=>{let e=document.getElementById("first-time-buyer-advisor");e?.scrollIntoView({behavior:"smooth",block:"start"})}):(n="High Risk",o="Multiple red flags suggest this deal needs significant clarification before proceeding.",d="Address the critical issues before engaging further, or consider alternative options.",c="Ask the Advisor what to clarify",m=()=>{let e=document.getElementById("first-time-buyer-advisor");e?.scrollIntoView({behavior:"smooth",block:"start"})});let x="high"===l?"bg-green-50 border-green-300":"caution"===l?"bg-amber-50 border-amber-300":"bg-red-50 border-red-300",u="high"===l?"text-green-900":"caution"===l?"text-amber-900":"text-red-900",g="high"===l?"text-green-600":"caution"===l?"text-amber-600":"text-red-600",p="high"===l?"border-l-green-500":"caution"===l?"border-l-amber-500":"border-l-red-500";return a.jsx("div",{className:`border-l-4 ${p} ${x} border rounded-lg shadow-sm`,children:a.jsx("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:`text-4xl font-bold ${g} flex-shrink-0`,children:"high"===l?"✓":"caution"===l?"⚠":"✗"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:`text-xl font-bold ${u} mb-2`,children:n}),(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Why this matters: ",o]}),a.jsx("p",{className:"text-sm text-gray-700 mb-3",children:d}),m&&(0,a.jsxs)("button",{onClick:m,className:`text-sm font-semibold ${"high"===l?"text-green-700 hover:text-green-900":"caution"===l?"text-amber-700 hover:text-amber-900":"text-red-700 hover:text-red-900"} underline`,children:[c," →"]})]})]})})})})()]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-green-50 border-green-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"✅ Before You Proceed, Verify These"}),a.jsx("div",{className:"space-y-3",children:[{item:"Written Out-the-Door (OTD) price",why:"This is your total cost including all fees, taxes, and add-ons. Without it, you can't compare deals accurately."},{item:"Add-ons: optional vs mandatory",why:'Many "mandatory" add-ons are actually optional dealer policies. Know which ones you can remove to save money.'},{item:"Warranty / return policy details",why:"Understand what's covered, for how long, and what voids the warranty. Some dealers offer short return windows."},{item:"Financing incentives and terms",why:"If financing, verify the APR, loan term, and any special incentives. Compare with your own pre-approval."},{item:"Registration and local fees breakdown",why:"State and local fees vary. Get an itemized list so you know exactly what you're paying and why."},{item:"Vehicle history and condition report",why:"For used cars, verify the Carfax or similar report. Check for accidents, title issues, or maintenance gaps."},{item:"Final paperwork review before signing",why:"Read all documents carefully. Ensure the final price matches your agreed OTD, and understand all terms."}].map((e,t)=>a.jsx("div",{className:"bg-white border border-green-300 rounded-lg p-3",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-green-600 font-bold mt-0.5",children:"□"}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900 mb-1",children:e.item}),a.jsx("p",{className:"text-xs text-gray-600 italic",children:e.why})]})]})},t))})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-purple-50 border-purple-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dealer Behavior Decoder"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"What common dealer statements usually mean:"}),a.jsx("div",{className:"space-y-3",children:[{statement:'"Come in to talk numbers"',meaning:"They want you in the showroom where pressure tactics work better. They'll likely avoid giving you a written OTD quote until you're there."},{statement:'"This price is only good today"',meaning:"This is a pressure tactic. If the price is truly competitive, it will still be there tomorrow. Take time to compare and think."},{statement:'"We can make any monthly payment work"',meaning:"They'll extend the loan term or add fees to hit your target payment, which costs you more overall. Focus on total OTD price instead."},{statement:'"These add-ons are mandatory"',meaning:"Many are actually optional dealer policies, not legal requirements. Ask which are required by law vs. dealer policy."},{statement:'"We\'re losing money on this deal"',meaning:"This is almost never true. Dealers don't sell at a loss. It's a negotiation tactic to make you feel like you're getting a great deal."},{statement:'"Let me check with my manager"',meaning:"This is often a scripted delay tactic to make you wait and feel invested. They may already know the answer but want to create urgency."}].map((e,t)=>(0,a.jsxs)("div",{className:"bg-white border border-purple-300 rounded-lg p-3",children:[(0,a.jsxs)("p",{className:"font-medium text-purple-900 mb-1",children:['"',e.statement,'"']}),a.jsx("p",{className:"text-sm text-gray-700",children:e.meaning})]},t))})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-orange-50 border-orange-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCCD Location-Specific Surprise Costs"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"First-time buyer surprises specific to your location:"}),a.jsx("div",{className:"space-y-2",children:(()=>{let t=e.otdEstimate?.assumptions?.registrationState||"",s=[];return["IL","NY","CA"].includes(t)&&s.push({name:"City Sticker / Vehicle Registration Sticker",amount:"$50-$200",explanation:"Many cities require an annual vehicle sticker. This is separate from state registration and often surprises first-time buyers who think registration covers everything.",frequency:"Annual"}),["WI","IL","IN"].includes(t)&&s.push({name:"County Wheel Tax",amount:"$20-$100",explanation:"Some counties charge an annual wheel tax per vehicle. This is a recurring cost, not a one-time fee, and varies by county.",frequency:"Annual"}),["CA","FL","TX"].includes(t)&&s.push({name:"State Registration Fee (value-based)",amount:"$200-$500+",explanation:`${t} charges registration fees based on vehicle value, not a flat rate. First-time buyers often underestimate this cost.`,frequency:"Annual"}),["CA","NY","CO","AZ"].includes(t)&&s.push({name:"Emissions Testing / Smog Check",amount:"$20-$50",explanation:"Required before registration in some states. Must be done at certified stations, and older vehicles may need repairs to pass.",frequency:"Biennial or as needed"}),s.push({name:"Registration & Plate Fees",amount:"$50-$300",explanation:"State registration and plate fees vary. Some states charge based on vehicle value, others have flat fees. First-time buyers often don't realize this is separate from the sale price and may be higher than expected.",frequency:"One-time (plus annual renewal)"}),s.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white border border-orange-300 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",e.frequency,")"]})]}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:e.amount})]}),a.jsx("p",{className:"text-xs text-gray-600 italic",children:e.explanation})]},t))})()}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-3 italic",children:["\uD83D\uDCA1 ",a.jsx("strong",{children:"First-time buyer tip:"})," These costs are often not included in dealer quotes. Ask specifically about local fees, city stickers, and county taxes for your registration address."]})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-gradient-to-br from-indigo-50 to-blue-50 border-indigo-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Confidence Recap"}),(()=>{let t=!!e.otdEstimate?.expectedOTD,s=(e.targets.askingPrice-e.targets.estimatedFairPrice)/e.targets.estimatedFairPrice*100,r=e.leverage.points.some(e=>"high"===e.strength),i=[],l=[];return t?i.push("You have a clear OTD target to negotiate toward"):l.push("Get a written itemized OTD quote before proceeding"),s<=5?i.push("The asking price is close to estimated fair market value"):s>20&&l.push("Negotiate toward the estimated fair price as your anchor"),r&&i.push("You have identified leverage points to use in negotiation"),0===i.length&&l.push("Review the checklist above and gather missing information"),"first_time"===c?l.push("Use the written-only templates above to request a written OTD breakdown."):l.push("Use the Negotiation Copilot to craft your first message"),(0,a.jsxs)("div",{children:[i.length>0&&(0,a.jsxs)("div",{className:"bg-white border border-indigo-300 rounded-lg p-4 mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-indigo-900 mb-2",children:"Your current position:"}),a.jsx("ul",{className:"space-y-1",children:i.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start text-sm text-gray-700",children:[a.jsx("span",{className:"text-green-600 mr-2",children:"✓"}),a.jsx("span",{children:e})]},t))})]}),(0,a.jsxs)("div",{className:"bg-white border border-indigo-300 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm font-medium text-indigo-900 mb-2",children:"Your next steps:"}),a.jsx("ul",{className:"space-y-1",children:l.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start text-sm text-gray-700",children:[a.jsx("span",{className:"text-blue-600 mr-2",children:"→"}),a.jsx("span",{children:e})]},t))})]}),a.jsx("p",{className:"text-sm text-gray-700 mt-4 italic",children:"You're prepared with the information and guardrails needed to make a confident decision. Take your time, verify everything, and don't let pressure override careful consideration."})]})})()]}),"first_time"===c&&a.jsx("div",{id:"first-time-buyer-advisor",children:a.jsx(j,{listingUrl:t,context:{state:e.otdEstimate?.assumptions?.registrationState||"",vehiclePrice:e.targets.askingPrice,estimatedFairPrice:e.targets.estimatedFairPrice,vehicleType:e.vehicleInfo?.condition||"used",hasOTD:!!e.otdEstimate?.expectedOTD,dealerName:e.vehicleInfo?.dealerName,dealerState:e.otdEstimate?.assumptions?.registrationState,trim:e.vehicleInfo?.trim}})})]}),"in_person"===c&&M&&(0,a.jsxs)(d.Z,{className:"p-6 mb-6 bg-orange-50 border-orange-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"What You Can Say In Person"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Convert your analysis into short, spoken leverage lines. Use these phrases during in-person negotiations:"}),a.jsx("div",{className:"space-y-3",children:(()=>{let t=[],s=(e.targets.askingPrice-e.targets.estimatedFairPrice)/e.targets.estimatedFairPrice*100,r=!!e.otdEstimate?.expectedOTD,i=e.leverage.points.some(e=>"high"===e.strength);if(s>5&&t.push({situation:"When they quote the asking price",phrase:`"I've seen similar vehicles priced around $${e.targets.estimatedFairPrice.toLocaleString()}. Can you help me understand the difference?"`,why:"Anchors to fair market value without being confrontational"}),r&&e.otdEstimate.expectedOTD){let s="number"==typeof e.otdEstimate.expectedOTD?e.otdEstimate.expectedOTD:e.otdEstimate.expectedOTD.expected;t.push({situation:"When they avoid giving OTD price",phrase:`"I need to see the full out-the-door price, including all fees and taxes. My target is $${s.toLocaleString()} OTD."`,why:"Direct, firm, and sets clear expectation"})}else t.push({situation:"When they avoid giving OTD price",phrase:'"I need the full out-the-door price in writing, including all fees and taxes."',why:"Gets everything in writing before negotiating further"});if(i){let s=e.leverage.points.find(e=>"high"===e.strength);s&&t.push({situation:"When they push back on price",phrase:`"${s.factor}"`,why:"Uses your strongest leverage point"})}return e.leverage.marketCondition&&t.push({situation:"When they claim urgency",phrase:"\"I'm comparing a few options. What's your best OTD price?\"",why:"Signals you have alternatives without being aggressive"}),t.push({situation:"When they add unexpected fees",phrase:'"Can you show me which of these fees are required by law versus dealer policy?"',why:"Separates mandatory from negotiable fees"}),t.map((e,t)=>(0,a.jsxs)("div",{className:"bg-white border border-orange-300 rounded-lg p-4",children:[(0,a.jsxs)("p",{className:"text-sm font-semibold text-gray-900 mb-2",children:[e.situation,":"]}),a.jsx("p",{className:"text-sm font-medium text-orange-800 bg-orange-50 rounded p-2 mb-2 border border-orange-200",children:e.phrase}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 italic",children:["\uD83D\uDCA1 ",e.why]})]},t))})()}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-4 italic",children:["\uD83D\uDCA1 ",a.jsx("strong",{children:"In-person tip:"})," Keep these phrases short (1-2 sentences). Say them calmly, then wait for their response. Don't over-explain."]})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"4. Likely Dealer Tactics + Counters"}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'"If they say X → say Y"'}),a.jsx("div",{className:"space-y-4",children:e.tactics.map((e,t)=>{let s=e.pack&&!(0,x.wT)(e.pack)&&!(0,x.UW)(),r=(0,a.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("p",{className:"font-medium text-gray-900",children:e.tactic}),(0,a.jsxs)("span",{className:`text-xs font-semibold px-2 py-1 rounded ${"high"===e.likelihood?"bg-red-100 text-red-700":"medium"===e.likelihood?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:[e.likelihood.toUpperCase()," Likelihood"]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[a.jsx("strong",{children:"Counter:"})," ",e.counter]})]});return s?a.jsx(g,{packId:e.pack,fallback:r,children:r},t):a.jsx("div",{children:r},t)})})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"5. Ready-to-Send Scripts"}),a.jsx("div",{className:"space-y-4",children:e.scripts.map((e,t)=>{let s=e.pack&&!(0,x.wT)(e.pack)&&!(0,x.UW)(),r=(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:e.title}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[a.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap",children:e.text}),a.jsx("button",{onClick:()=>L(e.text),className:"mt-2 text-xs text-blue-600 hover:text-blue-700",children:"\uD83D\uDCCB Copy"})]})]});return s?a.jsx(g,{packId:e.pack,fallback:r,children:r},t):a.jsx("div",{children:r},t)})})]}),(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:["Calculate Desired OTD",a.jsx("span",{className:"text-blue-600 cursor-help text-base",title:"OTD (Out-the-Door): Your total cost including sale price, all fees, taxes, and add-ons. This is the only number that matters for comparing deals—always negotiate OTD first, not monthly payment.",children:"ⓘ"})]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Input fees to calculate your desired Out-the-Door price for negotiations"})]}),a.jsx(o.Z,{size:"sm",variant:"secondary",onClick:()=>k(!w),children:w?"Hide":"Calculate"})]}),w&&(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Documentation Fee",(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(Typical: $",y.docFee.range.low,"-$",y.docFee.range.high,")"]})]}),a.jsx("input",{type:"number",value:C,onChange:e=>T(e.target.value),placeholder:y.docFee.value?.toString()||y.docFee.range.low.toString(),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title Fee",a.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Typical: $20-100)"})]}),a.jsx("input",{type:"number",value:D,onChange:e=>P(e.target.value),placeholder:"20",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Registration Fee",a.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Typical: $50-200)"})]}),a.jsx("input",{type:"number",value:S,onChange:e=>$(e.target.value),placeholder:"50",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Other Dealer Fees (optional)"}),a.jsx("input",{type:"number",value:F,onChange:e=>O(e.target.value),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 pt-2 border-t border-gray-200",children:[a.jsx(o.Z,{onClick:()=>{let{parseMoney:t,parsePercentToDecimal:a,calculateOTD:r}=s(19926),i=t(e.targets.estimatedFairPrice);if(!i||i<=0){alert("Invalid vehicle price");return}let l=a(y.taxRate.value||(y.taxRate.range.low+y.taxRate.range.high)/2),n=t(C)||y.docFee.value||y.docFee.range.low;R(Math.round(r({vehiclePrice:i,taxRateDecimal:l,docFee:n,titleFee:t(D)||0,registrationFee:t(S)||0,otherFees:t(F)||0,addOns:y.dealerAddOns.value||0}))),k(!1)},children:"Calculate Desired OTD"}),null!==A&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Desired OTD:"}),(0,a.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:["$",A.toLocaleString()]}),a.jsx("span",{className:"text-xs text-gray-500",children:"first_time"===c?"(Saved for your reference)":"(This will be used when opening Copilot)"})]})]})]}),null!==A&&!w&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Your Desired OTD"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:["$",A.toLocaleString()]})]}),a.jsx(o.Z,{size:"sm",variant:"secondary",onClick:()=>{R(null),T(""),P(""),$(""),O("")},children:"Clear"})]}),a.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"first_time"===c?"This OTD includes vehicle price, tax, and all fees. Use this as your target when requesting a written breakdown.":"This OTD includes vehicle price, tax, and all fees. It will be used when you open Copilot."})]})]}),(0,a.jsxs)(d.Z,{className:"p-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"6. Next Best Move"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:["first_time"===c?a.jsx(o.Z,{onClick:()=>{let e=document.querySelector("[data-templates-section]");e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),e.classList.add("ring-4","ring-blue-400","ring-opacity-75","transition-all","duration-300"),setTimeout(()=>{e.classList.remove("ring-4","ring-blue-400","ring-opacity-75")},2e3))},className:"bg-white !text-black hover:bg-gray-100",children:"Use the safe written templates above"}):a.jsx(o.Z,{onClick:()=>_(),className:"bg-white !text-black hover:bg-gray-100",children:"Generate Best Reply in Copilot"}),a.jsx(o.Z,{onClick:()=>{let t=e.nextMoves.otdBuilderLink,s=e.targets.askingPrice||e.targets.estimatedFairPrice;s?(localStorage.setItem("otd_builder_price",s.toString()),console.log("OTD Builder: Setting price:",s)):console.warn("OTD Builder: No price found in dealPlan.targets");let a=e.otdEstimate?.assumptions?.registrationState||t?.state;a?(localStorage.setItem("otd_builder_state",a),console.log("OTD Builder: Setting state:",a)):console.warn("OTD Builder: No state found in dealPlan.otdEstimate.assumptions.registrationState or link.state",{assumptionsState:e.otdEstimate?.assumptions?.registrationState,linkState:t?.state,assumptions:e.otdEstimate?.assumptions});let r=e.otdEstimate?.assumptions?.taxRate?.value,i=r?r.toString():((e.otdEstimate.assumptions.taxRate.range.low+e.otdEstimate.assumptions.taxRate.range.high)/2).toFixed(2);i?(localStorage.setItem("otd_builder_tax_rate",i),console.log("OTD Builder: Setting tax rate:",i)):console.warn("OTD Builder: No tax rate found"),m.push("first_time"===c?"/calculator/first-time":"in_person"===c?"/calculator/in-person":"/calculator/free")},className:"bg-white !text-black hover:bg-gray-100",children:"Build OTD"}),a.jsx(o.Z,{onClick:()=>{let t=e.nextMoves.comparisonLink;localStorage.setItem("comparison_prefill",JSON.stringify(t)),m.push("/research?tab=compare")},className:"bg-white !text-black hover:bg-gray-100",children:"Compare Similar Offers"})]})]}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsx(o.Z,{onClick:l,variant:"secondary",children:"Add to Comparison"})})]}),n&&!1]})}function w({listingData:e,onConfirm:t,onCancel:i,blocked:l}){let[n,c]=(0,r.useState)(e),[m,h]=(0,r.useState)(!1),[x,u]=(0,r.useState)([]),[g,p]=(0,r.useState)([]),b=(e,t)=>{c(s=>({...s,[e]:t}))},y=e.confidence??0,f=y<.75,v=e.issues?.some(e=>e.includes("price conflict")||e.includes("Multiple price")),j=e.blocked||l,N=e.fetchInfo||{},w=N.fetchStatus??-1,k=(N.errorType,N.errorMessage,N.blockReason);(()=>{if(j){if(-1!==w)return 403===w||429===w?"rate_limited"===k?"rate limited":"cloudflare"===k?"blocked by Cloudflare":"captcha"===k?"captcha required":"blocked":void 0}})();let C=l||f||v||"other"===e.sourceSite;return(0,a.jsxs)(d.Z,{className:"p-6 mb-6",children:[l&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[a.jsx("p",{className:"text-base font-semibold text-blue-900 mb-2",children:"\uD83D\uDCCB Copy from Listing Page"}),a.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"This dealer site can't be read automatically. No worries — just copy the listing details from the page and paste them below."}),(0,a.jsxs)("div",{className:"bg-white border border-blue-200 rounded p-3 text-sm text-blue-900",children:[a.jsx("p",{className:"font-medium mb-1",children:"How to copy:"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside space-y-1 ml-2",children:[a.jsx("li",{children:"Go to the dealer listing page"}),a.jsx("li",{children:"Select all (Ctrl+A / Cmd+A) or highlight the listing details"}),a.jsx("li",{children:"Copy (Ctrl+C / Cmd+C)"}),a.jsx("li",{children:"Paste into the box below"})]})]})]}),C&&!l&&(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-yellow-800 mb-2",children:["⚠️ Please Confirm Listing Details",f&&` (Confidence: ${(100*y).toFixed(0)}%)`,v&&" - Price conflict detected","other"===e.sourceSite&&" - Non-Cars.com source"]}),a.jsx("p",{className:"text-sm text-yellow-700",children:"We extracted the following information, but please verify all fields are correct before continuing."})]}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:j?"Enter Listing Details":"Review Extracted Listing Data"}),j&&(0,a.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsx("p",{className:"text-base font-semibold text-blue-900 mb-2",children:"This dealer site can't be read automatically."}),a.jsx("p",{className:"text-sm text-blue-800",children:"No worries — paste the listing details or enter the basics and we'll build your deal plan."})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[e.raw?.priceCandidates&&e.raw.priceCandidates.length>1&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"Price Candidates (click to select):"}),a.jsx("div",{className:"space-y-2",children:e.raw.priceCandidates.slice(0,3).map((e,t)=>a.jsx("button",{onClick:()=>b("price",e.value),className:`w-full text-left p-3 rounded-lg border-2 transition-colors ${n.price===e.value?"border-blue-500 bg-blue-100":"border-gray-200 bg-white hover:border-blue-300"}`,children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900",children:["$",e.value.toLocaleString()]}),a.jsx("p",{className:"text-xs text-gray-600",children:e.label}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:['"',e.context.substring(0,60),'..."']})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-xs font-medium text-gray-700",children:["Score: ",e.score.toFixed(0)]}),e.isLikelyMonthlyPayment&&a.jsx("span",{className:"text-xs text-red-600",children:"⚠️ Monthly"}),e.isLikelyMsrp&&a.jsx("span",{className:"text-xs text-yellow-600",children:"MSRP"})]})]})},t))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Price ($) ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"number",value:n.price||"",onChange:e=>b("price",e.target.value?parseFloat(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 23450",min:"2000",max:"250000",required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the sale price (not monthly payment, MSRP, or down payment)"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),a.jsx("input",{type:"number",value:n.year||"",onChange:e=>b("year",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Make"}),a.jsx("input",{type:"text",value:n.make||"",onChange:e=>b("make",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Model"}),a.jsx("input",{type:"text",value:n.model||"",onChange:e=>b("model",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Trim"}),a.jsx("input",{type:"text",value:n.trim||"",onChange:e=>b("trim",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mileage"}),a.jsx("input",{type:"number",value:n.mileage||"",onChange:e=>b("mileage",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Condition ",a.jsx("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:n.vehicleCondition||"unknown",onChange:e=>b("vehicleCondition",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[a.jsx("option",{value:"unknown",children:"Unknown"}),a.jsx("option",{value:"new",children:"New"}),a.jsx("option",{value:"used",children:"Used"}),a.jsx("option",{value:"cpo",children:"Certified Pre-Owned"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"VIN"}),a.jsx("input",{type:"text",value:n.vin||"",onChange:e=>b("vin",e.target.value.toUpperCase()||void 0),maxLength:17,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dealer Name"}),a.jsx("input",{type:"text",value:n.dealerName||"",onChange:e=>b("dealerName",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Victory Toyota Midtown"}),x.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Detected:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:x.slice(0,3).map((e,t)=>a.jsx("button",{type:"button",onClick:()=>b("dealerName",e.name),className:`text-xs px-2 py-1 rounded border ${n.dealerName===e.name?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:e.name},t))})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),a.jsx("input",{type:"text",value:n.dealerCity||"",onChange:e=>b("dealerCity",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Atlanta"}),g.length>0&&g.some(e=>e.city)&&(0,a.jsxs)("div",{className:"mt-2",children:[a.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Detected:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.filter(e=>e.city).slice(0,3).map((e,t)=>(0,a.jsxs)("button",{type:"button",onClick:()=>{b("dealerCity",e.city),e.state&&b("dealerState",e.state),e.zip&&b("zip",e.zip)},className:`text-xs px-2 py-1 rounded border ${n.dealerCity===e.city?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-700 hover:bg-gray-100"}`,children:[e.city,e.state?`, ${e.state}`:"",e.zip?` ${e.zip}`:""]},t))})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),a.jsx("input",{type:"text",value:n.dealerState||"",onChange:e=>b("dealerState",e.target.value.toUpperCase()||void 0),maxLength:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 uppercase",placeholder:"e.g., GA"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP"}),a.jsx("input",{type:"text",value:n.zip||"",onChange:e=>b("zip",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 30309"})]})]}),(0,a.jsxs)("div",{className:j?"mb-6 border-2 border-blue-300 rounded-lg p-4 bg-blue-50":"mb-6",children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:j?(0,a.jsxs)(a.Fragment,{children:["\uD83D\uDCCB Paste Listing Details Here",a.jsx("span",{className:"ml-2 text-xs font-normal text-gray-600",children:"(Required when blocked)"})]}):"Or Paste Listing Text / HTML (fallback)"}),a.jsx("textarea",{placeholder:j?"Paste the listing page content here (Ctrl+V / Cmd+V). We'll extract price, mileage, year, make, model, condition, VIN, dealer name, and location automatically...":"Paste listing details or page source here (price, mileage, year, make, model, dealer, location, etc.)...",className:`w-full px-3 py-2 border ${j?"border-blue-400 bg-white":"border-gray-300"} rounded-lg focus:ring-2 focus:ring-blue-500 min-h-[180px] font-mono text-sm`,id:"paste-textarea"}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-3",children:[a.jsx(o.Z,{type:"button",variant:j?"primary":"secondary",onClick:()=>{let t=document.getElementById("paste-textarea"),a=t?.value;if(a)try{let{parseListingText:t}=s(16597),r=t(a);console.log("PASTE_PARSE_RESULT",r);let{confidence:i,issues:l,raw:n,...o}=r;if(n?.dealerNameCandidates&&u(n.dealerNameCandidates.map(e=>({name:e.name,score:e.score}))),n?.locationCandidates&&p(n.locationCandidates.map(e=>({city:e.city,state:e.state,zip:e.zip,score:e.score}))),!o.dealerName&&e.sourceUrl)try{let t=new URL(e.sourceUrl).hostname.replace(/^www\./,"").replace(/\.(com|net|org|us)$/,"").replace(/([a-z])([A-Z])/g,"$1 $2").split(/[-_]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");t.length>3&&(o.dealerName=t,u(e=>[{name:t,score:5},...e.slice(0,4)]))}catch(e){}let d=Object.keys(o).filter(e=>void 0!==o[e]),m=d.length;if(0===m){alert("Could not extract any data from the pasted text. Please fill in the fields manually.");return}c(e=>{let t={...e,dealerName:o.dealerName??e.dealerName,dealerCity:o.dealerCity??e.dealerCity,dealerState:o.dealerState??e.dealerState,zip:o.zip??e.zip,year:o.year??e.year,make:o.make??e.make,model:o.model??e.model,trim:o.trim??e.trim,price:o.price??e.price,mileage:o.mileage??e.mileage,vehicleCondition:o.vehicleCondition??e.vehicleCondition,vin:o.vin??e.vin};return console.log("FORM_STATE_AFTER_AUTOFILL",t),t});let h=`✅ Extracted ${m} field${m>1?"s":""}: ${d.join(", ")}`;o.price&&(h+=`
💰 Price: $${o.price.toLocaleString()}`),o.dealerName&&(h+=`
🏢 Dealer: ${o.dealerName}`),(o.dealerCity||o.dealerState)&&(h+=`
📍 Location: ${[o.dealerCity,o.dealerState].filter(Boolean).join(", ")}`),l&&l.length>0&&(h+=`

⚠️ Notes: ${l.join("; ")}`),void 0!==i&&(h+=`

Confidence: ${(100*i).toFixed(0)}%`),h+="\n\nPlease review and edit the fields above before continuing.",alert(h)}catch(e){console.warn("Failed to parse listing text:",e),alert("Could not automatically parse the text. Please fill in the fields manually.")}else alert("Please paste some text first.")},children:j?"\uD83D\uDD0D Extract & Auto-fill":"Auto-fill from Pasted Text"}),j&&a.jsx("p",{className:"text-xs text-gray-600",children:"We'll intelligently extract price (ignoring monthly payments), mileage, year/make/model, condition, VIN, dealer name, and location."})]})]}),e.issues&&e.issues.length>0&&(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Issues Detected:"}),a.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-700",children:e.issues.map((e,t)=>a.jsx("li",{children:e},t))})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx(o.Z,{variant:"primary",onClick:()=>{if(!n.price||n.price<2e3||n.price>25e4){alert("Please enter a valid price between $2,000 and $250,000");return}if(!n.vehicleCondition||"unknown"===n.vehicleCondition){alert("Please select the vehicle condition (New, Used, or CPO)");return}if(("used"===n.vehicleCondition||"cpo"===n.vehicleCondition)&&(!n.mileage||n.mileage<0)){alert("Mileage is required for used or CPO vehicles");return}t(n)},disabled:C&&!n.price,children:j?"✅ Confirm & Generate Deal Plan":C?"Confirm & Generate Deal Plan":"Generate Deal Plan"}),a.jsx(o.Z,{variant:"secondary",onClick:i,children:"Cancel"})]}),C&&!n.price&&a.jsx("p",{className:"text-sm text-red-600 mt-2",children:"⚠️ Price is required to continue"}),(0,a.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,a.jsxs)("button",{onClick:()=>h(!m),className:"text-xs text-gray-500 hover:text-gray-700",children:[m?"▼":"▶"," Debug Info"]}),m&&(0,a.jsxs)("div",{className:"mt-2 bg-gray-50 rounded-lg p-3 text-xs space-y-2",children:[a.jsx("p",{className:"font-medium mb-2",children:"Extraction Details:"}),(0,a.jsxs)("p",{children:["Confidence: ",(100*y).toFixed(0),"%"]}),e.fetchInfo&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Fetch Info:"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Final URL: ",e.fetchInfo.finalUrl||e.sourceUrl]}),e.fetchInfo.pageTitle&&(0,a.jsxs)("p",{className:"text-gray-600",children:['Page Title: "',e.fetchInfo.pageTitle,'"']}),e.fetchInfo.pagePreview&&(0,a.jsxs)("p",{className:"text-gray-600",children:['Preview: "',e.fetchInfo.pagePreview,'..."']})]}),e.raw?.platform&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Platform:"}),a.jsx("p",{className:"text-gray-600",children:e.raw.platform})]}),e.raw?.strategies&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Strategies Used:"}),a.jsx("p",{className:"text-gray-600",children:e.raw.strategies.join(" → ")}),(0,a.jsxs)("p",{className:"text-gray-500 mt-1",children:["Winner: ",a.jsx("strong",{children:e.raw.strategies[0]||"none"})]})]}),e.raw?.priceCandidates&&e.raw.priceCandidates.length>0&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Price Candidates (Ranked):"}),a.jsx("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:e.raw.priceCandidates.map((e,t)=>(0,a.jsxs)("li",{className:0===t?"font-semibold":"",children:["$",e.value.toLocaleString()," (",e.label,") - Score: ",e.score.toFixed(0),e.isLikelyMonthlyPayment&&a.jsx("span",{className:"text-red-600 ml-1",children:"⚠️ Monthly"}),e.isLikelyMsrp&&a.jsx("span",{className:"text-yellow-600 ml-1",children:"MSRP"}),e.isLikelyConditional&&a.jsx("span",{className:"text-orange-600 ml-1",children:"Conditional"}),a.jsx("br",{}),(0,a.jsxs)("span",{className:"text-gray-500 text-xs ml-4",children:['"',e.context.substring(0,60),'..."']})]},t))})]}),e.raw?.mileageCandidates&&e.raw.mileageCandidates.length>0&&(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:"Mileage Candidates:"}),a.jsx("ul",{className:"list-disc list-inside text-gray-600 space-y-1",children:e.raw.mileageCandidates.map((e,t)=>(0,a.jsxs)("li",{children:[e.value.toLocaleString()," mi (",e.label,") - Score: ",e.score.toFixed(0),a.jsx("br",{}),(0,a.jsxs)("span",{className:"text-gray-500 text-xs ml-4",children:['"',e.context.substring(0,50),'..."']})]},t))})]}),(0,a.jsxs)("details",{className:"mt-2",children:[a.jsx("summary",{className:"cursor-pointer text-gray-600 hover:text-gray-800",children:"Full Raw Data"}),a.jsx("pre",{className:"mt-2 text-xs overflow-auto max-h-40 bg-white p-2 rounded border",children:JSON.stringify(e.raw,null,2)})]})]})]})]})]})}(0,n.B)();let k=(0,n.B)();function C({mode:e="free"}){let{user:t}=(0,l.a)();(0,i.useSearchParams)();let[s,n]=(0,r.useState)("url"),[x,u]=(0,r.useState)(""),[g,p]=(0,r.useState)(""),[b,y]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),[j,C]=(0,r.useState)(null),[T,D]=(0,r.useState)(!1),[P,S]=(0,r.useState)(null),[$,F]=(0,r.useState)(!1),[O,A]=(0,r.useState)(null),R=async t=>{t&&t.preventDefault(),y(!0),C(null),D(!1),S(null);try{let{data:{session:t}}=await k.auth.getSession(),a={"Content-Type":"application/json"};t?.access_token&&(a.Authorization=`Bearer ${t.access_token}`);let r={packVariant:"first-time"===e?"first_time":"in-person"===e?"in_person":"free"};if("url"===s){if(!x.trim()){C("Please enter a listing URL"),y(!1);return}r.listingUrl=x.trim()}else if("paste"===s){if(!g.trim()){C("Please paste listing details"),y(!1);return}r.listingUrl=g.trim()}else"manual"===s&&(r.listingUrl="manual://entry",r.confirmedData={});let i=await fetch("/api/analyze-listing",{method:"POST",headers:a,body:JSON.stringify(r)});if(!i.ok){let e=await i.text().catch(()=>"");throw Error(`Analysis failed: HTTP ${i.status}. ${e.slice(0,300)}`)}let l=await i.json();if(!l?.success){if(l?.requiresUserInput&&l?.extractedListing){S(l.extractedListing),F(l.extractedListing.blocked||!1),D(!0),A(l.diagnostics),y(!1);return}throw Error(l?.error||"Failed to analyze listing")}l.data?.dealPlan?(v(l.data.dealPlan),A(l.data.diagnostics)):l.dealPlan?(v(l.dealPlan),A(l.diagnostics)):v(l.data||l),y(!1)}catch(e){C(e.message||"Failed to analyze listing"),y(!1)}},L=async t=>{D(!1),y(!0),C(null);try{let{data:{session:s}}=await k.auth.getSession(),a={"Content-Type":"application/json"};s?.access_token&&(a.Authorization=`Bearer ${s.access_token}`);let r=await fetch("/api/analyze-listing",{method:"POST",headers:a,body:JSON.stringify({listingUrl:x||g||"manual://entry",packVariant:"first-time"===e?"first_time":"in-person"===e?"in_person":"free",confirmedData:t})});if(!r.ok){let e=await r.text().catch(()=>"");throw Error(`Analysis failed: HTTP ${r.status}. ${e.slice(0,300)}`)}let i=await r.json();if(!i?.success)throw Error(i?.error||"Failed to analyze listing");i.data?.dealPlan?(v(i.data.dealPlan),A(i.data.diagnostics)):i.dealPlan?(v(i.dealPlan),A(i.diagnostics)):v(i.data||i),y(!1)}catch(e){C(e.message||"Failed to analyze listing"),y(!1)}};return a.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:["first-time"===e?(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Deal Readiness Assessment"}),a.jsx("p",{className:"text-lg text-gray-600",children:"Expert review before you contact the dealer"})]}):"in-person"===e?(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Listing Analyzer"}),a.jsx("p",{className:"text-lg text-gray-600",children:"Analyze vehicle listings and prepare for in-person negotiation"})]}):(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Listing Analyzer"}),a.jsx("p",{className:"text-lg text-gray-600",children:"Analyze vehicle listings and get deal insights"})]}),!f&&!T&&(0,a.jsxs)(d.Z,{className:"mb-8 p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Choose how to enter listing"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>n("url"),className:`p-4 rounded-lg border-2 transition-all ${"url"===s?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[a.jsx(c.Z,{className:`w-6 h-6 mb-2 ${"url"===s?"text-blue-600":"text-gray-400"}`}),a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Paste Listing URL"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Paste the URL from the dealer listing page"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>n("paste"),className:`p-4 rounded-lg border-2 transition-all ${"paste"===s?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[a.jsx(m.Z,{className:`w-6 h-6 mb-2 ${"paste"===s?"text-blue-600":"text-gray-400"}`}),a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Copy from Listing Page"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Copy and paste listing details from the page"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>n("manual"),className:`p-4 rounded-lg border-2 transition-all ${"manual"===s?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[a.jsx(h.Z,{className:`w-6 h-6 mb-2 ${"manual"===s?"text-blue-600":"text-gray-400"}`}),a.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:"Manual Entry"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Enter vehicle details manually"})]})]})]}),(0,a.jsxs)("form",{onSubmit:R,className:"space-y-4",children:["url"===s&&(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"listing-url",className:"block text-sm font-medium text-gray-700 mb-2",children:"Listing URL"}),a.jsx("input",{id:"listing-url",type:"url",value:x,onChange:e=>u(e.target.value),placeholder:"Paste vehicle listing URL here...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:!0})]}),"paste"===s&&(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"paste-text",className:"block text-sm font-medium text-gray-700 mb-2",children:"Paste Listing Details"}),a.jsx("textarea",{id:"paste-text",value:g,onChange:e=>p(e.target.value),placeholder:"Paste listing details here (price, year, make, model, mileage, dealer, location, etc.)...",rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",required:!0}),a.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Tip: Select all (Ctrl+A / Cmd+A) on the listing page, then copy and paste here"})]}),"manual"===s&&a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:a.jsx("p",{className:"text-sm text-blue-800 mb-2",children:'Click "Analyze Listing" to start manual entry. You\'ll be able to enter vehicle details in the next step.'})}),a.jsx(o.Z,{type:"submit",disabled:b||"url"===s&&!x.trim()||"paste"===s&&!g.trim(),children:b?"Analyzing...":"Analyze Listing"})]})]}),T&&P&&a.jsx(w,{listingData:P,onConfirm:L,onCancel:()=>{D(!1),S(null),F(!1)},blocked:$}),j&&a.jsx(d.Z,{className:"mb-8 p-6 bg-red-50 border-red-200",children:a.jsx("p",{className:"text-red-800",children:j})}),f&&!T&&a.jsx(N,{dealPlan:f,listingUrl:x||g||"manual://entry",onAddToComparison:()=>{if(f&&x){let e=f.vehicleInfo||{},t={url:x,price:f.targets?.askingPrice||0,vehicle:`${e.year||""} ${e.make||""} ${e.model||""}`.trim()};localStorage.setItem("comparison_prefill",JSON.stringify(t)),window.location.href="/research?tab=compare"}},diagnostics:O,variant:"first-time"===e?"first_time":"in-person"===e?"in_person":"free"})]})})}},21021:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(10326);function r({children:e,className:t=""}){return a.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 ${t}`,children:e})}s(17577)},64777:(e,t,s)=>{s.d(t,{m:()=>i});var a=s(17577);let r=(0,s(8903).B)();function i(){let[e,t]=(0,a.useState)(!0),[s,i]=(0,a.useState)({first_time:!1,in_person:!1,bundle:!1}),l=(0,a.useCallback)(async()=>{try{t(!0);let{data:{user:e}}=await r.auth.getUser();if(!e){i({first_time:!1,in_person:!1,bundle:!1}),t(!1);return}let{data:s,error:a}=await r.from("user_entitlements").select("first_time, in_person, bundle").eq("user_id",e.id).single();a?"PGRST116"===a.code?i({first_time:!1,in_person:!1,bundle:!1}):console.error("[useEntitlements] Error fetching entitlements:",a):i({first_time:s?.first_time||!1,in_person:s?.in_person||!1,bundle:s?.bundle||!1})}catch(e){console.error("[useEntitlements] Error:",e)}finally{t(!1)}},[]),n=s.first_time||s.bundle,o=s.in_person||s.bundle,d=s.bundle;return{loading:e,entitlements:s,hasFirstTime:n,hasInPerson:o,hasBundle:d,refreshEntitlements:l}}},16597:(e,t,s)=>{s.r(t),s.d(t,{extractCarsCom:()=>d,normalizeCondition:()=>l,parseListingText:()=>c,parseMileage:()=>i,parseUsd:()=>r,titleToYMMT:()=>n});var a=s(71551);function r(e){if(!e)return;let t=parseFloat(e.replace(/[$,]/g,""));if(!isNaN(t)&&!(t<500)&&!(t>2e5))return Math.round(t)}function i(e){if(!e)return;let t=e.match(/(\d{1,3}(?:[,\s]\d{3})*)\s*(?:mi|miles?|k\s*mi)/i);if(t){let e=parseInt(t[1].replace(/[,\s]/g,""));if(!isNaN(e)&&e>=0&&e<=5e5)return e}let s=e.match(/(\d+(?:\.\d+)?)\s*k\b/i);if(s){let e=1e3*parseFloat(s[1]);if(!isNaN(e)&&e>=0&&e<=5e5)return Math.round(e)}}function l(e){if(!e)return"unknown";let t=e.toLowerCase();return t.includes("new")?"new":t.includes("certified")||t.includes("cpo")?"cpo":t.includes("used")||t.includes("pre-owned")?"used":"unknown"}function n(e){if(!e)return{};let t={},s=e.match(/\b(19|20)\d{2}\b/);if(s){let e=parseInt(s[0]);e>=1990&&e<=new Date().getFullYear()+1&&(t.year=e)}for(let s of["Toyota","Honda","Ford","Chevrolet","Chevy","Nissan","BMW","Mercedes-Benz","Mercedes","Audi","Lexus","Acura","Infiniti","Cadillac","Lincoln","Jeep","Ram","Dodge","Chrysler","GMC","Buick","Hyundai","Kia","Mazda","Subaru","Volkswagen","VW","Volvo","Porsche","Tesla","Genesis","Alfa Romeo","Jaguar","Land Rover","Mini","Mitsubishi","Fiat"])if(RegExp(`\\b${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(e)){t.make="Chevy"===s?"Chevrolet":"VW"===s?"Volkswagen":s;break}if(t.make){let s=e.toLowerCase().indexOf(t.make.toLowerCase());if(-1!==s){let a=e.substring(s+t.make.length).trim().match(/^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)/);if(a){let e=a[1].trim();["New","Used","Certified","CPO","Pre-Owned"].includes(e)||(t.model=e)}}}let a=e.match(/(?:\(([^)]+)\)|(?:Trim|Package):\s*([^,]+))/i);return a&&(t.trim=(a[1]||a[2]).trim()),t}function o(e,t){for(let s of t){let t=e(s).first();if(t.length){let e=t.text().trim();if(e)return e}}return null}async function d(e,t){let s={sourceUrl:e,sourceSite:"cars.com"},d=[];if(!t)return{...s,confidence:0,issues:["HTML content not provided"]};let c=function(e){let t={},s=e.match(/<script[^>]*type=["']application\/ld\+json["'][^>]*>([\s\S]*?)<\/script>/gi);if(!s)return t;for(let e of s)try{let s=e.replace(/<script[^>]*>/,"").replace(/<\/script>/,""),a=JSON.parse(s);if(!(Array.isArray(a["@type"])?a["@type"]:[a["@type"]]).some(e=>e.includes("Vehicle")||e.includes("Product")))continue;if(a.offers){for(let e of Array.isArray(a.offers)?a.offers:[a.offers])if(e.price&&!t.price){let s="string"==typeof e.price?r(e.price):e.price;s&&(t.price=s)}}if(a.brand&&!t.make&&(t.make="string"==typeof a.brand?a.brand:a.brand.name),a.name&&!t.title&&(t.title=a.name),a.vehicleIdentificationNumber&&!t.vin&&(t.vin=a.vehicleIdentificationNumber),a.mileageFromOdometer&&!t.mileage){let e="object"==typeof a.mileageFromOdometer?a.mileageFromOdometer.value:a.mileageFromOdometer;e&&(t.mileage=i(String(e)))}a.itemCondition&&!t.vehicleCondition&&(t.vehicleCondition=l(a.itemCondition))}catch(e){continue}return t}(t);Object.keys(c).length>0&&(Object.assign(s,c),d.push("json-ld"));let m=function(e){let t={};for(let s of[/window\.__NEXT_DATA__\s*=\s*({[\s\S]+?});/,/window\.__PRELOADED_STATE__\s*=\s*({[\s\S]+?});/,/__INITIAL_STATE__\s*=\s*({[\s\S]+?});/,/<script[^>]*id=["']__NEXT_DATA__["'][^>]*>([\s\S]+?)<\/script>/]){let a=e.match(s);if(a)try{let e=a[1],s=JSON.parse(e),n=(e,t)=>{if(0===t.length)return e;if(!e||"object"!=typeof e)return;let[s,...a]=t;if(Array.isArray(e))for(let s of e){let e=n(s,t);if(void 0!==e)return e}return n(e[s],a)};for(let e of[["props","pageProps","vehicle","price"],["props","pageProps","listing","price"],["vehicle","price"],["listing","price"],["price"]]){let a=n(s,e);if(a&&!t.price){let e="string"==typeof a?r(a):a;e&&(t.price=e)}}for(let e of[["props","pageProps","vehicle"],["props","pageProps","listing"],["vehicle"],["listing"]]){let a=n(s,e);if(a&&"object"==typeof a){if(a.price&&!t.price){let e="string"==typeof a.price?r(a.price):a.price;e&&(t.price=e)}if(a.year&&!t.year&&(t.year=a.year),a.make&&!t.make&&(t.make=a.make),a.model&&!t.model&&(t.model=a.model),a.trim&&!t.trim&&(t.trim=a.trim),a.mileage&&!t.mileage&&(t.mileage=i(String(a.mileage))),a.vin&&!t.vin&&(t.vin=a.vin),a.stockNumber&&!t.stockNumber&&(t.stockNumber=a.stockNumber),a.condition&&!t.vehicleCondition&&(t.vehicleCondition=l(a.condition)),a.dealer&&!t.dealerName&&(t.dealerName="string"==typeof a.dealer?a.dealer:a.dealer.name),a.location&&!t.dealerCity){if("string"==typeof a.location){let e=a.location.split(",");e[0]&&(t.dealerCity=e[0].trim()),e[1]&&(t.dealerState=e[1].trim())}else a.location.city&&(t.dealerCity=a.location.city),a.location.state&&(t.dealerState=a.location.state),a.location.zip&&(t.zip=a.location.zip)}}}}catch(e){continue}}return t}(t);if(Object.keys(m).length>0){for(let[e,t]of Object.entries(m))t&&!s[e]&&(s[e]=t);d.push("embedded-json")}let h=function(e){let t=a.zD(e),s={},d=o(t,['[data-testid="price"]',".price",".vehicle-price",'[class*="price"]',"[data-price]",'span[class*="Price"]']);d&&!s.price&&(s.price=r(d));let c=o(t,["h1",'[data-testid="title"]',".vehicle-title",'[class*="title"]',"title"]);if(c&&!s.title){s.title=c;let e=n(c);e.year&&!s.year&&(s.year=e.year),e.make&&!s.make&&(s.make=e.make),e.model&&!s.model&&(s.model=e.model),e.trim&&!s.trim&&(s.trim=e.trim)}let m=o(t,['[data-testid="mileage"]','[class*="mileage"]','[class*="odometer"]','span:contains("mi")']);m&&!s.mileage&&(s.mileage=i(m));let h=o(t,['[data-testid="condition"]','[class*="condition"]','[class*="badge"]','span:contains("New"), span:contains("Used"), span:contains("Certified")']);h&&!s.vehicleCondition&&(s.vehicleCondition=l(h));let x=o(t,['[data-testid="dealer"]','[class*="dealer"]','[class*="seller"]',".dealer-name"]);for(let e of(x&&!s.dealerName&&(s.dealerName=x),['[data-testid="location"]','[data-testid="address"]','[class*="location"]','[class*="address"]','[class*="contact"]',"footer"])){let a=o(t,[e]);if(a){let e=a.match(/\b(\d{5}(?:-\d{4})?)\b/);e&&!s.zip&&(s.zip=e[1]);let t=a.match(/([A-Za-z .'-]+),\s*([A-Z]{2})\b/);if(t&&(s.dealerCity||(s.dealerCity=t[1].trim()),s.dealerState||(s.dealerState=t[2].toUpperCase())),s.dealerCity&&s.dealerState)break}}let u=o(t,['[data-testid="vin"]','[class*="vin"]','span:contains("VIN")']);if(u&&!s.vin){let e=u.match(/\b([A-HJ-NPR-Z0-9]{17})\b/);e&&(s.vin=e[1])}return s}(t);for(let[e,t]of Object.entries(h))t&&!s[e]&&(s[e]=t);Object.keys(h).length>0&&d.push("dom");let x=function(e){let t={};if(!t.price){let s=e.match(/\$([0-9][0-9,]+)/g);if(s){let e=s.map(e=>r(e)).filter(e=>void 0!==e);e.length>0&&(t.price=Math.max(...e))}}if(!t.mileage){let s=e.match(/([0-9][0-9,]+)\s*mi\b/i);s&&(t.mileage=i(s[0]))}if(!t.vin){let s=e.match(/\b([A-HJ-NPR-Z0-9]{17})\b/);s&&(t.vin=s[1])}return t}(t);for(let[e,t]of Object.entries(x))t&&!s[e]&&(s[e]=t);Object.keys(x).length>0&&d.push("regex");let{confidence:u,issues:g}=function(e,t){let s=0,a=[];return e.price?e.price>=500&&e.price<=2e5?s+=.25:a.push("Price out of reasonable bounds"):a.push("Price missing"),e.year&&e.make&&e.model?s+=.2:(e.year||a.push("Year missing"),e.make||a.push("Make missing"),e.model||a.push("Model missing")),"used"===e.vehicleCondition||"cpo"===e.vehicleCondition?e.mileage?s+=.15:a.push("Mileage missing for used vehicle"):e.mileage&&(s+=.1),e.vehicleCondition&&"unknown"!==e.vehicleCondition?s+=.1:a.push("Condition unknown"),(e.dealerName||e.dealerCity||e.dealerState)&&(s+=.1),t.includes("json-ld")||t.includes("embedded-json")?s+=.2:t.includes("dom")&&(s+=.1),{confidence:s=Math.min(s,1),issues:a}}(s,d);return{...s,confidence:u,issues:g,raw:{strategies:d,jsonLdData:c,embeddedData:m,domData:h,regexData:x}}}function c(e){let t={raw:{}},s=[],a=0;if(!e||e.trim().length<10)return{confidence:0,issues:["Text too short or empty"]};let n=e.replace(/<[^>]+>/g," ").replace(/\s+/g," "),o=e.split(/\n/).map(e=>e.trim().replace(/\s+/g," ")).filter(e=>e.length>0),d=[];for(let e of[/\$([1-9]\d{2,3}(?:,\d{3})*)/g,/price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi,/internet\s+price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi,/sale\s+price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi,/our\s+price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi])for(let t of[...n.matchAll(e)]){let e=r(t[0]);if(!e)continue;let s=n.substring(Math.max(0,t.index-100),t.index+t[0].length+100).toLowerCase();if(s.includes("/mo")||s.includes("monthly")||s.includes("lease")||s.includes("apr")||s.includes("down payment")||s.includes("starting at")||s.includes("est.")||s.includes("calculator"))continue;let a=50;(s.includes("internet price")||s.includes("sale price")||s.includes("our price"))&&(a+=30),(s.includes("msrp")||s.includes("sticker"))&&(a-=20),e<2e3||e>25e4||d.push({price:e,context:s,score:a})}if(d.length>0){let e=d.sort((e,t)=>10>Math.abs(e.score-t.score)?t.price-e.price:t.score-e.score);t.price=e[0].price,a+=30}else s.push("Could not find a valid price (ignored monthly payments, lease terms, etc.)");t.mileage=i(n),t.mileage&&(a+=20);let c=n.match(/\b([A-HJ-NPR-Z0-9]{17})\b/);c&&(t.vin=c[1].toUpperCase(),a+=10);let m=["Toyota","Honda","Ford","Chevrolet","Chevy","Nissan","BMW","Mercedes-Benz","Mercedes","Audi","Lexus","Acura","Infiniti","Cadillac","Lincoln","Jeep","Ram","Dodge","Chrysler","GMC","Buick","Hyundai","Kia","Mazda","Subaru","Volkswagen","VW","Volvo","Porsche","Tesla","Genesis","Alfa Romeo","Jaguar","Land Rover","Mini","Mitsubishi","Fiat"],h=["home","inventory","search","specials","finance","service","parts","contact","directions","hours","login","sign in","shop","build","accessories","new","used","certified","cpo","pre-owned","about","trade","special"],x=[];for(let e of o){let t=e.toLowerCase(),s=0;e.match(/\b(19\d{2}|20\d{2})\b/)&&(s+=50),m.some(t=>RegExp(`\\b${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(e))&&(s+=30),e.split(/\s+/).some(e=>e.length>=3&&/^[A-Za-z]+$/.test(e)&&!h.includes(e.toLowerCase()))&&(s+=20),h.some(e=>t.includes(e))&&(s-=50),s>0&&x.push({line:e,score:s})}let u=null;if(x.length>0&&(u=x.sort((e,t)=>t.score-e.score)[0].line),u){let e=u.match(/\b(19\d{2}|20\d{2})\b/);if(e){let s=parseInt(e[0]);s>=1990&&s<=new Date().getFullYear()+1&&(t.year=s,a+=15)}}if(u){for(let e of m)if(RegExp(`\\b${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"i").test(u)){t.make="Chevy"===e?"Chevrolet":"VW"===e?"Volkswagen":e,a+=15;let s=u.toLowerCase().indexOf(e.toLowerCase());if(-1!==s){let r=u.substring(s+e.length).trim(),i=["4wd","awd","hybrid","i-force","crewmax","trd","limited","xle","xse","le","se","sport","touring","platinum","sr5","sr","ltd","rwd","fwd","turbo","supercharged","v6","v8","ecoboost"],l=[],n=r.split(/\s+/);for(let s of n){let a=s.toLowerCase().replace(/[^\w]/g,"");if(i.includes(a)){let e=n.indexOf(s);e>0&&(t.trim=n.slice(e).join(" "));break}/^\d{4}$/.test(s)||a===e.toLowerCase()||l.push(s)}l.length>0&&(t.model=l.join(" "),a+=15)}break}}t.raw.titleCandidates=x.slice(0,5),u&&(t.raw.vehicleTitleCandidate=u),t.year&&t.make&&t.model||s.push("Could not extract complete year/make/model from text"),t.vehicleCondition=l(n),"unknown"!==t.vehicleCondition&&(a+=10);let g=[],p=["home","inventory","search","specials","finance","service","parts","contact","directions","hours","login","sign in","shop","build","accessories","new","used","certified","cpo","pre-owned","about","trade","special"],b=/(Toyota|Honda|Ford|Chevrolet|Chevy|Nissan|Kia|Hyundai|BMW|Mercedes|Audi|Volkswagen|VW|Volvo|Porsche|Tesla|Lexus|Acura|Infiniti|Cadillac|Lincoln|Jeep|Ram|Dodge|Chrysler|GMC|Buick|Mazda|Subaru|Genesis).*(Toyota|Motors|Auto|Automotive|Dealership|of)/i,y=null;for(let e of o){let t=e.toLowerCase(),s=e.split(/\s+/).length;if(b.test(e)&&!p.some(e=>t.includes(e))&&s>=3&&s<=8){let t=e.trim();if((t=(t=t.replace(/\s+(dealer|dealership|auto|automotive|motors|sales|service|parts)$/i,"")).replace(/^[^\w]+|[^\w]+$/g,"")).length>=3&&t.length<=100){y=t;break}}}if(!y){let e=["toyota","honda","ford","chevrolet","chevy","nissan","hyundai","kia","mazda","subaru","jeep","ram","dodge","chrysler","gmc","buick","cadillac","lexus","acura","infiniti","bmw","mercedes","audi","volkswagen","vw","volvo","porsche","tesla"];for(let t=0;t<o.length;t++){let s=o[t],a=s.toLowerCase(),r=t>0?o[t-1].toLowerCase():"",i=t<o.length-1?o[t+1].toLowerCase():"",l=`${r} ${a} ${i}`.toLowerCase();if(s.split(/\s+/).length<=2&&!e.some(e=>a.includes(e))||a.includes("toyota certified")||a.includes("toyota financial")||a.includes("build & price")||a.includes("build and price")||p.some(e=>a===e||a.startsWith(e+" ")||a.endsWith(" "+e)))continue;let n=0;(a.includes("dealer")||a.includes("dealership"))&&(n+=40);let d=e.some(e=>a.includes(e));if(d&&(n+=30),(a.includes("auto")||a.includes("automotive")||a.includes("motors"))&&(n+=20),(l.includes("sales")||l.includes("service")||l.includes("parts"))&&s.match(/^[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*/)&&(n+=25),(l.includes("contact")||l.includes("directions")||l.includes("hours")||l.includes("address")||l.includes("location"))&&(n+=15),s.split(/\s+/).length<=2&&!d&&(n-=20),n>0){let e=s.trim();(e=(e=e.replace(/\s+(dealer|dealership|auto|automotive|motors|sales|service|parts)$/i,"")).replace(/^[^\w]+|[^\w]+$/g,"")).length>=3&&e.length<=100&&g.push({name:e,score:n,context:s.substring(0,100)})}}}if(y)t.dealerName=y,a+=15,t.raw.dealerNameCandidates=[{name:y,score:100,context:"Direct match"}];else if(g.length>0){let e=new Map;for(let t of g){let s=t.name.toLowerCase();(!e.has(s)||e.get(s).score<t.score)&&e.set(s,t)}let s=Array.from(e.values()).sort((e,t)=>t.score-e.score);t.dealerName=s[0].name,a+=10,t.raw.dealerNameCandidates=s.slice(0,5)}let f=[],v=[...n.matchAll(/\b(\d{5}(?:-\d{4})?)\b/g)],j=[...n.matchAll(/([A-Za-z .'-]+),\s*([A-Z]{2})\b/g)];for(let e=0;e<o.length;e++){let t=o[e];t.toLowerCase();let s=`${o[Math.max(0,e-1)]} ${t} ${o[Math.min(o.length-1,e+1)]}`.toLowerCase(),a=s.includes("address")||s.includes("location")||s.includes("directions")||s.includes("contact")||s.includes("hours")?30:10,r=v.find(e=>{let s=n.indexOf(e[0]),a=n.indexOf(t),r=a+t.length;return s>=a&&s<=r}),i=j.find(e=>{let s=n.indexOf(e[0]),a=n.indexOf(t),r=a+t.length;return s>=a&&s<=r});if(r||i){let e={score:a,context:t.substring(0,100)};r&&(e.zip=r[1],a+=20),i&&(e.city=i[1].trim(),e.state=i[2].toUpperCase(),a+=30),e.score=a,(e.city||e.zip)&&f.push(e)}}if(f.length>0){let e=f.sort((e,t)=>t.score-e.score),s=e[0];s.city&&(t.dealerCity=s.city),s.state&&(t.dealerState=s.state),s.zip&&(t.zip=s.zip),(s.city||s.state||s.zip)&&(a+=10),t.raw.locationCandidates=e.slice(0,5)}return a=Math.min(100,a)/100,{...t,confidence:a,issues:s}}},87466:(e,t,s)=>{s.d(t,{Z:()=>r,l:()=>a});let a={first_time:{id:"first_time",name:"First-Time Buyer Pack",description:"Guidance for first-time buyers: financing basics, affordability, clarity.",features:["Budget & credit band questions","APR & term definitions","OTD vs monthly education","First-time friendly scripts"],education:["OTD includes taxes, fees, and registration - focus on OTD, not monthly.","APR is the annualized cost of borrowing - compare against pre-approval if you have one.","Longer terms lower monthly payment but increase total interest paid."],questions:[{id:"budget",label:"Max OTD budget",type:"number",required:!0,placeholder:"e.g., 25000"},{id:"credit_band",label:"Credit range (approx)",type:"select",required:!1,options:[{value:"excellent",label:"Excellent (760+)"},{value:"good",label:"Good (700-759)"},{value:"fair",label:"Fair (640-699)"},{value:"new",label:"Limited/First-time"}]},{id:"down_payment_est",label:"Down payment estimate",type:"number",required:!1,placeholder:"e.g., 4000"},{id:"driving_needs",label:"Primary driving needs",type:"text",required:!1,placeholder:"e.g., commute 40 miles daily"}]},cash:{id:"cash",name:"Cash Buyer Pack",description:"Cash-specific tactics and proof-of-funds handling.",features:["Cash disclosure timing","Proof-of-funds guidance","OTD and fees focus","No monthly payment talk"],education:["Delay disclosing cash until you have negotiated price.","Have proof of funds ready, but share only when it helps close at your price.","Cash can justify lower price: simpler deal, no financing reserve for dealer."],questions:[{id:"proof_of_funds",label:"Do you have proof of funds?",type:"boolean",required:!1},{id:"disclose_cash",label:"When do you want to disclose cash?",type:"select",required:!1,options:[{value:"late",label:"Only after price is agreed"},{value:"mid",label:"After initial counter"},{value:"early",label:"I prefer to disclose early"}]},{id:"open_to_finance",label:"Open to financing if it reduces price?",type:"boolean",required:!1}],comingSoon:!0},financing:{id:"financing",name:"Financing Buyer Pack",description:"Financing coaching: APR, term, pre-approval leverage.",features:["Max monthly & OTD focus","Pre-approval leverage","APR/term questions","Payment anchoring avoidance"],education:["Negotiate OTD first, financing second - do not anchor on monthly payment.","Compare dealer APR against your pre-approval; ask if low APR is contingent on add-ons.","Shorter terms cost more monthly but less interest overall."],questions:[{id:"target_monthly",label:"Target monthly (optional)",type:"number",required:!1,placeholder:"e.g., 400"},{id:"max_otd",label:"Max OTD",type:"number",required:!0,placeholder:"e.g., 25000"},{id:"preferred_term",label:"Preferred term",type:"select",required:!1,options:[{value:"36",label:"36 mo"},{value:"48",label:"48 mo"},{value:"60",label:"60 mo"},{value:"72",label:"72 mo"}]},{id:"pre_approved",label:"Do you have pre-approval?",type:"boolean",required:!1},{id:"pre_approval_rate",label:"Pre-approval APR",type:"number",required:!1,placeholder:"e.g., 5.5"}],comingSoon:!0},in_person:{id:"in_person",name:"In-Person Negotiation Pack",description:"Dealership talk tracks and pressure handling.",features:["Short talk tracks","Manager/pressure tactics","If they say X → say Y","Closing script for OTD"],education:["Practice your talk track - don't rely on recording; use written notes instead.",'If "manager" pressure starts, slow down: ask for written OTD before deciding.',"Have 2-3 calm phrases ready for add-on upsells."],questions:[{id:"comfort_firm",label:"Comfort being firm?",type:"select",required:!1,options:[{value:"low",label:"Prefer soft approach"},{value:"medium",label:"Comfortable pushing back politely"},{value:"high",label:"Very firm when needed"}]},{id:"expected_objections",label:"Objections you expect",type:"textarea",required:!1,placeholder:'e.g., "Price is already low", "Manager approval needed".'},{id:"has_trade_in",label:"Trade-in?",type:"boolean",required:!1}]},bundle:{id:"bundle",name:"Complete Bundle",description:"Get both packs at a discounted price: First-Time Buyer Pack + In-Person Negotiation Pack.",features:["Everything in First-Time Buyer Pack","Everything in In-Person Negotiation Pack","Best value for comprehensive coverage","Unlock both packs with one purchase"],education:["The bundle includes all features from both individual packs.","Perfect if you want complete guidance from first contact through in-person negotiation.","Save money compared to buying packs separately."],questions:[]}};function r(e){return a[e]||a.first_time}},78798:(e,t,s)=>{function a(e){return!1}function r(){return!1}function i(e){}s.d(t,{UW:()=>r,addPack:()=>i,wT:()=>a})},58690:(e,t,s)=>{function a(e){if(!e)return"/copilot/free";switch(e){case"first_time":return"/copilot/first-time";case"in_person":return"/copilot/in-person";default:return"/copilot/free"}}function r(e,t,s){return e?a(e):"/copilot/free"}s.d(t,{M:()=>r,d:()=>a})},19926:(e,t,s)=>{function a(e){if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:Math.abs(e);if("string"==typeof e){let t=parseFloat(e.replace(/[$,\s]/g,""));return isNaN(t)||!isFinite(t)?0:Math.abs(t)}return 0}function r(e,t){let s=t?.maxPercent??15,a=t?.minPercent??0;if("number"==typeof e)return isNaN(e)||!isFinite(e)?0:e>1?Math.max(a/100,Math.min(s/100,e/100)):Math.max(a/100,Math.min(s/100,Math.abs(e)));if("string"==typeof e){let t=parseFloat(e.trim().replace(/%/g,""));return isNaN(t)||!isFinite(t)?0:e.includes("%")||t>1?Math.max(a/100,Math.min(s/100,t/100)):Math.max(a/100,Math.min(s/100,Math.abs(t)))}return 0}function i(e){let t=[],s=a(e.vehiclePrice),i=r(e.taxRateDecimal),l=a(e.docFee??0),n=a(e.registrationFee??0),o=a(e.titleFee??0),d=a(e.otherFees??0),c=a(e.addOns??0);s<=0&&t.push("Vehicle price must be greater than 0"),s>1e6&&t.push("Vehicle price seems unusually high (>$1M). Please verify."),(i<0||i>.15)&&t.push(`Tax rate ${(100*i).toFixed(2)}% is outside normal range (0-15%). Please verify.`);let m=s*i,h=l+n+o+d,x=s+m+h+c;return x>1.5*s&&t.push(`OTD ($${x.toLocaleString()}) is more than 50% above vehicle price ($${s.toLocaleString()}). Please check fees and tax rate.`),x<s&&t.push(`OTD ($${x.toLocaleString()}) is less than vehicle price ($${s.toLocaleString()}). This is unusual.`),(isNaN(x)||!isFinite(x))&&t.push("OTD calculation resulted in invalid number. Please check all inputs."),{vehiclePrice:s,taxRateDecimal:i,taxAmount:m,fees:h,addOns:c,otd:Math.round(100*x)/100,issues:t}}function l(e){let t=[],s=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:e.docFee?.low??0,registrationFee:e.registrationFee?.low??0,titleFee:e.titleFee?.low??0,otherFees:e.otherFees??0,addOns:e.addOns??0}),a=e.docFee?(e.docFee.low+e.docFee.high)/2:0,r=e.registrationFee?(e.registrationFee.low+e.registrationFee.high)/2:0,l=e.titleFee?(e.titleFee.low+e.titleFee.high)/2:0,n=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:a,registrationFee:r,titleFee:l,otherFees:e.otherFees??0,addOns:e.addOns??0}),o=i({vehiclePrice:e.vehiclePrice,taxRateDecimal:e.taxRateDecimal,docFee:e.docFee?.high??0,registrationFee:e.registrationFee?.high??0,titleFee:e.titleFee?.high??0,otherFees:e.otherFees??0,addOns:e.addOns??0});return t.push(...s.issues,...n.issues,...o.issues),o.otd<s.otd&&t.push("High OTD estimate is less than low estimate. Please check fee ranges."),(n.otd<s.otd||n.otd>o.otd)&&t.push("Expected OTD is outside the low-high range. Please check calculations."),n.otd,n.otd,{low:s.otd,expected:n.otd,high:o.otd,issues:[...new Set(t)]}}s.r(t),s.d(t,{calculateOTD:()=>i,calculateOTDRange:()=>l,parseMoney:()=>a,parsePercentToDecimal:()=>r})}};