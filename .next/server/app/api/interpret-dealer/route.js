"use strict";(()=>{var e={};e.id=123,e.ids=[123],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},15746:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>u});var n=r(49303),i=r(88716),a=r(60670),o=r(87070),p=r(19692),l=r(8563);async function u(e){try{let t=await (0,p.f)(),{data:{session:r}}=await t.auth.getSession();if(!r?.user)return o.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let{dealerMessage:s}=await e.json();if(!s||!s.trim())return o.NextResponse.json({success:!1,error:"Missing dealerMessage"},{status:400});let n=(0,l.$)(),i=`You are an expert car buying negotiation coach. Your job is to help users understand what car dealers are really saying in their messages and provide the best response.

CRITICAL RULES:
1. Decode dealer tactics and hidden meanings
2. Identify what information is missing or unclear
3. Provide a single, best response (not multiple options)
4. Be educational, not prescriptive - explain tactics, not guarantee outcomes
5. Focus on what the user should do next
6. Keep responses clear and actionable

Your response must be a JSON object with this exact structure:
{
  "interpretation": "<plain-language explanation of what the dealer is really saying, what tactics they're using, and what's missing>",
  "keyPoints": ["<key point 1>", "<key point 2>", "<key point 3>"],
  "suggestedResponse": "<the single best response the user should send, ready to copy/paste>",
  "whatsMissing": ["<missing info 1>", "<missing info 2>"],
  "redFlags": ["<red flag 1>", "<red flag 2>"],
  "nextSteps": ["<next step 1>", "<next step 2>"]
}`,a=`Analyze this dealer message and provide interpretation and best response:

Dealer Message:
${s}

Provide a clear interpretation, identify what's missing, and give the single best response the user should send.`,u=await n.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:i},{role:"user",content:a}],response_format:{type:"json_object"},temperature:.7}),c=JSON.parse(u.choices[0].message.content||"{}");if(!c.interpretation&&!c.explanation)throw Error("Invalid response format from AI");let d={success:!0,data:{explanation:c.interpretation||c.explanation,keyPoints:c.keyPoints||[],recommendedResponse:c.suggestedResponse||c.recommendedResponse||"",redFlags:c.redFlags||[],nextSteps:c.nextSteps||[]}};return d.data.whatsMissing=c.whatsMissing||[],o.NextResponse.json(d)}catch(e){return console.error("Error interpreting dealer message:",e),o.NextResponse.json({success:!1,error:e.message||"Failed to interpret message"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/interpret-dealer/route",pathname:"/api/interpret-dealer",filename:"route",bundlePath:"app/api/interpret-dealer/route"},resolvedPagePath:"C:\\dev\\Dealership Copilot\\app\\api\\interpret-dealer\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=c,g="/api/interpret-dealer/route";function x(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},8563:(e,t,r)=>{r.d(t,{$:()=>i});var s=r(54214);let n=null;function i(){if(!n){let e=process.env.OPENAI_API_KEY;if(!e)throw Error("OPENAI_API_KEY is not set");n=new s.ZP({apiKey:e})}return n}},19692:(e,t,r)=>{r.d(t,{$:()=>o,f:()=>p});var s=r(67721),n=r(71615);let i="https://vabikejehdmpfcyqrgrs.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!i||!a){let e=[];throw i||e.push("NEXT_PUBLIC_SUPABASE_URL"),a||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error(`[CRITICAL] Missing required Supabase environment variables: ${e.join(", ")}. These must be set in Vercel environment variables.`)}if(i.includes("placeholder")||a.includes("placeholder"))throw Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables.");if(i.length<10||a.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function o(){let e=(0,n.cookies)();return(0,s.createServerClient)("https://vabikejehdmpfcyqrgrs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:s})=>{e.set(t,r,s)})}catch(e){}}}})}let p=o}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,7857,9702,4214],()=>r(15746));module.exports=s})();