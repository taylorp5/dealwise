"use strict";(()=>{var e={};e.id=888,e.ids=[888],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51794:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>I,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var i=t(49303),o=t(88716),n=t(60670),a=t(87070),p=t(19692),u=t(37857);async function l(e){try{let{email:r,topic:t,message:s,pageUrl:i}=await e.json();if(!r||"string"!=typeof r||!r.includes("@"))return a.NextResponse.json({error:"Valid email is required"},{status:400});if(!t||"string"!=typeof t)return a.NextResponse.json({error:"Topic is required"},{status:400});if(!s||"string"!=typeof s||0===s.trim().length)return a.NextResponse.json({error:"Message is required"},{status:400});let o=(0,p.f)(),{data:{user:n}}=await o.auth.getUser(),l=n?.id||null,c=function(){let e="https://vabikejehdmpfcyqrgrs.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Missing Supabase configuration for support tickets");return(0,u.createClient)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1}})}(),{data:d,error:m}=await c.from("support_tickets").insert({email:r.trim(),topic:t.trim(),message:s.trim(),page_url:i?.trim()||null,user_id:l}).select().single();if(m){console.error("[Support] Error inserting ticket:",{message:m.message,code:m.code,details:m.details,hint:m.hint,fullError:JSON.stringify(m,null,2)});let e=m.message||"",r=m.code||"";if(e.includes("does not exist")||e.includes("schema cache")||"42P01"===r||"PGRST116"===r)return a.NextResponse.json({error:"Support system not configured. Please contact the administrator.",details:"Table support_tickets does not exist. Run migration: supabase/migrations/002_support_tickets.sql"},{status:500});if("42501"===r||e.includes("permission denied")||e.includes("policy violation"))return console.error("[Support] RLS policy issue detected"),a.NextResponse.json({error:"Permission denied. Please ensure RLS policies are configured correctly."},{status:500});return a.NextResponse.json({error:"Failed to submit message. Please try again."},{status:500})}return a.NextResponse.json({success:!0,id:d.id})}catch(e){return console.error("[Support] Error:",e),a.NextResponse.json({error:"An error occurred. Please try again."},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/support/route",pathname:"/api/support",filename:"route",bundlePath:"app/api/support/route"},resolvedPagePath:"C:\\dev\\Dealership Copilot\\app\\api\\support\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=c,g="/api/support/route";function I(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},19692:(e,r,t)=>{t.d(r,{$:()=>a,f:()=>p});var s=t(67721),i=t(71615);let o="https://vabikejehdmpfcyqrgrs.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q";if(!o||!n){let e=[];throw o||e.push("NEXT_PUBLIC_SUPABASE_URL"),n||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error(`[CRITICAL] Missing required Supabase environment variables: ${e.join(", ")}. These must be set in Vercel environment variables.`)}if(o.includes("placeholder")||n.includes("placeholder"))throw Error("[CRITICAL] Supabase environment variables contain placeholder values. Please set real values in Vercel environment variables.");if(o.length<10||n.length<10)throw Error("[CRITICAL] Supabase environment variables appear to be invalid (too short). Please verify they are set correctly in Vercel.");function a(){let e=(0,i.cookies)();return(0,s.createServerClient)("https://vabikejehdmpfcyqrgrs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhYmlrZWplaGRtcGZjeXFyZ3JzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0NzAzNDAsImV4cCI6MjA4MTA0NjM0MH0.X_Z7szu62swGviqYgtI2mxV3F1vX4UBYpuZYV2n7h4Q",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>{e.set(r,t,s)})}catch(e){}}}})}let p=a}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,7857,9702],()=>t(51794));module.exports=s})();