"use strict";(()=>{var e={};e.id=127,e.ids=[127],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},23532:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d});var r={};n.r(r),n.d(r,{GET:()=>a});var o=n(49303),s=n(88716),i=n(60670),l=n(87070);async function a(e){let t=e.nextUrl.searchParams.get("url");try{let e,n;if(!t)return l.NextResponse.json({success:!1,finalUrl:"",fetchStatus:400,blocked:!1,errorType:"invalid_request",errorMessage:"Missing url parameter",pageTitle:null});try{e=new URL(t)}catch(e){return l.NextResponse.json({success:!1,finalUrl:t,fetchStatus:400,blocked:!1,errorType:"invalid_request",errorMessage:"Invalid URL",pageTitle:null})}let r=e.hostname.toLowerCase();if(["google.com","facebook.com","twitter.com","youtube.com"].some(e=>r.includes(e)))return l.NextResponse.json({success:!1,finalUrl:t,fetchStatus:400,blocked:!1,errorType:"invalid_request",errorMessage:"Domain not allowed",pageTitle:null});let o=null,s=t,i=-1,a="unknown",c="Unknown error";try{let t=new AbortController,n=setTimeout(()=>t.abort(),12e3);o=await fetch(e.toString(),{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Referer:"https://www.google.com/","Cache-Control":"no-cache",Pragma:"no-cache"},redirect:"follow",signal:t.signal}),clearTimeout(n),s=o.url,i=o.status}catch(r){let e=String(r?.message||r||"Unknown error").toLowerCase(),t=String(r?.code||"").toUpperCase();r?.name==="AbortError"||e.includes("aborted")||e.includes("timeout")?(a="timeout",c="Request timed out after 12 seconds"):t.includes("ENOTFOUND")||t.includes("EAI_AGAIN")||e.includes("dns")||e.includes("not found")?(a="dns",c="DNS lookup failed - domain not found"):t.includes("ECONNREFUSED")||e.includes("connection refused")||e.includes("conn_refused")?(a="conn_refused",c="Connection refused by server"):t.includes("ETIMEDOUT")||e.includes("timed out")?(a="timeout",c="Connection timed out"):t.includes("CERT")||t.includes("TLS")||e.includes("certificate")||e.includes("tls")||e.includes("ssl")?(a="tls",c="TLS/SSL certificate error"):e.includes("aborted")?(a="aborted",c="Request was aborted"):(a="unknown",c=r?.message||String(r)||"Network error");let n={success:!1,finalUrl:s,fetchStatus:-1,blocked:!0,errorType:a,errorMessage:c,pageTitle:null,blockReason:"network_error"};return l.NextResponse.json(n,{status:200})}let u=o.headers.get("content-type")||"",d=o.headers.get("content-length");if(!o.ok){let e;let t=!1;(403===i||429===i)&&(t=!0,e=429===i?"rate_limited":"access_denied");let n="",r=null;try{let s=(n=await o.text()).match(/<title[^>]*>(.*?)<\/title>/i);r=s?s[1].substring(0,200):null;let i=n.toLowerCase();i.includes("cloudflare")?(e="cloudflare",t=!0):i.includes("captcha")||i.includes("challenge")?(e="captcha",t=!0):i.includes("cookie")&&i.includes("enable")&&(e="cookie_required",t=!0)}catch(e){}return l.NextResponse.json({success:!1,blocked:t,fetchStatus:i,finalUrl:s,pageTitle:r,errorMessage:`HTTP ${i}`,contentType:u,contentLength:d?parseInt(d):void 0,blockReason:e||"unknown"})}let p=await o.text(),g=p.toLowerCase(),h=p.match(/<title[^>]*>(.*?)<\/title>/i),m=h?h[1].substring(0,200):null,f=m?.toLowerCase()||"",k=!1;return(["access denied","attention required","robot","captcha","pardon our interruption","verify you are human","enable cookies"].some(e=>f.includes(e))||["cloudflare","captcha","enable cookies","verify you are human","challenge"].some(e=>g.includes(e)))&&(k=!0,n=g.includes("cloudflare")?"cloudflare":g.includes("captcha")||g.includes("challenge")?"captcha":g.includes("cookie")&&g.includes("enable")?"cookie_required":"unknown"),l.NextResponse.json({success:!k,html:k?void 0:p,finalUrl:s,fetchStatus:i,contentType:u,contentLength:d?parseInt(d):void 0,blocked:k,pageTitle:m,pagePreview:p.substring(0,200),blockReason:n,status:i})}catch(e){return console.error("Fetch listing error:",e),l.NextResponse.json({success:!1,blocked:!0,fetchStatus:-1,finalUrl:t||"",pageTitle:null,errorMessage:e.message||"Failed to fetch listing",errorType:"unknown",blockReason:"unknown"})}}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/fetch-listing/route",pathname:"/api/fetch-listing",filename:"route",bundlePath:"app/api/fetch-listing/route"},resolvedPagePath:"C:\\dev\\Dealership Copilot\\app\\api\\fetch-listing\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:p}=c,g="/api/fetch-listing/route";function h(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972],()=>n(23532));module.exports=r})();