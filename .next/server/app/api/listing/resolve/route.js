"use strict";(()=>{var e={};e.id=4002,e.ids=[4002],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},98061:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},30604:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},93977:e=>{e.exports=require("node:fs/promises")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},87503:e=>{e.exports=require("node:net")},49411:e=>{e.exports=require("node:path")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},55467:e=>{e.exports=require("node:sqlite")},84492:e=>{e.exports=require("node:stream")},92332:e=>{e.exports=require("node:timers")},31764:e=>{e.exports=require("node:tls")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},34365:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>u});var a={};t.r(a),t.d(a,{POST:()=>c,dynamic:()=>d});var o=t(49303),i=t(88716),s=t(60670),l=t(87070),n=t(70917);let d="force-dynamic";async function c(e){try{let r,t;let{url:a}=await e.json();if(!a||"string"!=typeof a)return l.NextResponse.json({ok:!1,error:"Missing or invalid url parameter",fallbackSuggested:!0},{status:400});try{r=new URL(a)}catch(e){return l.NextResponse.json({ok:!1,error:"Invalid URL format",fallbackSuggested:!0},{status:400})}let o=r.hostname.toLowerCase();if(["google.com","facebook.com","twitter.com","youtube.com"].some(e=>o.includes(e)))return l.NextResponse.json({ok:!1,error:"Domain not allowed",fallbackSuggested:!0},{status:400});let i=a;try{let e=new AbortController,a=setTimeout(()=>e.abort(),12e3),o=await fetch(r.toString(),{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9",Referer:"https://www.google.com/","Cache-Control":"no-cache"},redirect:"follow",signal:e.signal});if(clearTimeout(a),i=o.url,o.status,!o.ok){if(403===o.status||429===o.status)return l.NextResponse.json({ok:!1,error:`Access denied (HTTP ${o.status})`,fallbackSuggested:!0});return l.NextResponse.json({ok:!1,error:`HTTP ${o.status}`,fallbackSuggested:!0})}let s=(t=await o.text()).toLowerCase();if(s.includes("cloudflare")||s.includes("captcha")||s.includes("verify you are human"))return l.NextResponse.json({ok:!1,error:"Website blocked access (captcha/cloudflare)",fallbackSuggested:!0})}catch(e){if("AbortError"===e.name)return l.NextResponse.json({ok:!1,error:"Request timed out",fallbackSuggested:!0});return l.NextResponse.json({ok:!1,error:e.message||"Failed to fetch URL",fallbackSuggested:!0})}let s=function(e){let r={},t={};try{let a=e.match(/<script[^>]*type=["']application\/ld\+json["'][^>]*>([\s\S]*?)<\/script>/gi);if(!a)return{data:{},confidence:t};for(let e of a){let a=e.match(/<script[^>]*>([\s\S]*?)<\/script>/i);if(a)try{let e=JSON.parse(a[1]),o=Array.isArray(e)?e[0]:e;if("Product"===o["@type"]||"Vehicle"===o["@type"]||"Car"===o["@type"]){if(o.offers&&Array.isArray(o.offers)){let e=o.offers[0];if(e.price){let a="string"==typeof e.price?parseFloat(e.price.replace(/[$,]/g,"")):"number"==typeof e.price?e.price:void 0;a&&a>500&&a<2e5&&(r.price=Math.round(a),t.price="high")}}else if(o.offers&&"object"==typeof o.offers&&o.offers.price){let e="string"==typeof o.offers.price?parseFloat(o.offers.price.replace(/[$,]/g,"")):"number"==typeof o.offers.price?o.offers.price:void 0;e&&e>500&&e<2e5&&(r.price=Math.round(e),t.price="high")}if(o.itemOffered){let e=o.itemOffered;if(e.name){let a=e.name.match(/\b(19|20)\d{2}\b/);if(a){let e=parseInt(a[0]);e>=1990&&e<=new Date().getFullYear()+1&&(r.year=e,t.year="high")}}e.brand?.name&&(r.make=e.brand.name,t.make="high"),e.model&&(r.model=e.model,t.model="high")}o.brand?.name&&!r.make&&(r.make=o.brand.name,t.make="high"),o.model&&!r.model&&(r.model=o.model,t.model="high")}if(("Organization"===o["@type"]||"AutoDealer"===o["@type"])&&(o.name&&(r.dealerName=o.name,t.dealer="high"),o.address)){let e="string"==typeof o.address?JSON.parse(o.address):o.address;if(e.addressLocality&&(r.dealerCity=e.addressLocality,t.city="high"),e.addressRegion&&(r.dealerState=e.addressRegion),e.postalCode){let a=e.postalCode.match(/\d{5}/)?.[0];a&&(r.zip=a,t.zip="high")}}}catch(e){continue}}}catch(e){}return{data:r,confidence:t}}(t),d=function(e){let r={},t={};try{let a=e.match(/<script[^>]*id=["']__NEXT_DATA__["'][^>]*>([\s\S]*?)<\/script>/i);if(!a)return{data:{},confidence:t};let o=JSON.parse(a[1]),i=o?.props?.pageProps||o?.props||{};if(i.vehicle){let e=i.vehicle;if(e.price){let a="number"==typeof e.price?e.price:parseFloat(String(e.price).replace(/[$,]/g,""));a>500&&a<2e5&&(r.price=Math.round(a),t.price="high")}if(e.year&&(r.year=parseInt(String(e.year)),t.year="high"),e.make&&(r.make=e.make,t.make="high"),e.model&&(r.model=e.model,t.model="high"),e.mileage){let a="number"==typeof e.mileage?e.mileage:parseInt(String(e.mileage).replace(/[,\s]/g,""));a>=0&&a<=5e5&&(r.mileage=a,t.mileage="high")}}if(i.dealer){let e=i.dealer;if(e.name&&(r.dealerName=e.name,t.dealer="high"),e.city&&(r.dealerCity=e.city,t.city="high"),e.state&&(r.dealerState=e.state),e.zip){let a=String(e.zip).match(/\d{5}/)?.[0];a&&(r.zip=a,t.zip="high")}}}catch(e){}return{data:r,confidence:t}}(t),c=function(e){let r={},t={};try{let a=n.zD(e),o=a('meta[property="og:price:amount"]').attr("content");if(o){let e=parseFloat(o.replace(/[$,]/g,""));e>500&&e<2e5&&(r.price=Math.round(e),t.price="med")}let i=a('meta[property="og:title"]').attr("content")||a("title").text();if(i){let e=i.match(/\b(19|20)\d{2}\b/);if(e&&!r.year){let a=parseInt(e[0]);a>=1990&&a<=new Date().getFullYear()+1&&(r.year=a,t.year="med")}}}catch(e){}return{data:r,confidence:t}}(t),p=function(e,r){let t={},a={},o=e.replace(/<[^>]+>/g," ").replace(/\s+/g," "),i=[];for(let e of[/\$([1-9]\d{2,3}(?:,\d{3})*)/g,/price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi,/internet\s+price[:\s]*\$?([1-9]\d{2,3}(?:,\d{3})*)/gi])for(let r of o.matchAll(e)){let e=parseFloat(r[1].replace(/,/g,""));e>500&&e<2e5&&i.push(e)}if(i.length>0){let e=new Map;i.forEach(r=>e.set(r,(e.get(r)||0)+1));let r=Array.from(e.entries()).sort((e,r)=>r[1]-e[1]);r[0]&&(t.price=Math.round(r[0][0]),a.price=r[0][1]>1?"med":"low")}let s=o.match(/\b(\d{5})\b/);s&&(t.zip=s[1],a.zip="med");let l=o.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?),\s*([A-Z]{2})\s+(\d{5})/i);for(let e of(l&&(t.dealerCity=l[1],t.dealerState=l[2].toUpperCase(),t.zip=l[3],a.city="med",a.zip="high"),[/dealer[:\s]+([A-Z][A-Za-z\s&]+)/i,/sold\s+by[:\s]+([A-Z][A-Za-z\s&]+)/i,/from[:\s]+([A-Z][A-Za-z\s&]+)/i])){let r=o.match(e);if(r&&r[1].length>2&&r[1].length<50){t.dealerName=r[1].trim(),a.dealer="low";break}}for(let e of[/(\d{1,3}(?:,\d{3})*)\s*(?:mi|miles?)/i,/mileage[:\s]*(\d{1,3}(?:,\d{3})*)/i]){let r=o.match(e);if(r){let e=parseInt(r[1].replace(/,/g,""));if(e>=0&&e<=5e5){t.mileage=e,a.mileage="med";break}}}return{data:t,confidence:a}}(t,0),m={sourceUrl:i,sourceSite:o.includes("cars.com")?"cars.com":"other",...p.data,...c.data,...d.data,...s.data},u={...p.confidence,...c.confidence,...d.confidence,...s.confidence};r.hostname.replace(/^www\./,"");let f={sourceUrl:i,sourceSite:o.includes("cars.com")?"cars.com":"other",price:m.price,year:m.year,make:m.make,model:m.model,trim:m.trim,mileage:m.mileage,dealerName:m.dealerName,dealerCity:m.dealerCity,dealerState:m.dealerState,zip:m.zip,imageUrl:m.imageUrl,vin:m.vin,confidence:Object.keys(u).length>0?.7:.5,issues:[],raw:{confidence:u,extractionMethod:"json-ld"}};return l.NextResponse.json({ok:!0,data:f,confidence:{price:u.price||"low",dealer:u.dealer||"low",city:u.city||"low",zip:u.zip||"low",mileage:u.mileage||"low",year:u.year||"low",make:u.make||"low",model:u.model||"low"}})}catch(e){return console.error("[listing/resolve] Error:",e),l.NextResponse.json({ok:!1,error:e.message||"Failed to resolve listing",fallbackSuggested:!0},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/listing/resolve/route",pathname:"/api/listing/resolve",filename:"route",bundlePath:"app/api/listing/resolve/route"},resolvedPagePath:"C:\\dev\\Dealership Copilot\\app\\api\\listing\\resolve\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:u,serverHooks:f}=p,g="/api/listing/resolve/route";function h(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:u})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,5972,917],()=>t(34365));module.exports=a})();